{"version":3,"file":"tom-select.js","sources":["../../src/tom-select.ts"],"sourcesContent":["\nimport MicroEvent from './contrib/microevent.js';\nimport MicroPlugin from './contrib/microplugin.js';\nimport Sifter from './contrib/sifter.js';\nimport { TomSettings } from './types/settings';\nimport { TomInput, TomArgObject, TomOption, TomOptions, TomCreateFilter, TomCreateCallback } from './types/index';\nimport {highlight, removeHighlight} from './contrib/highlight.js';\nimport * as constants from './constants.js';\nimport getSettings from './getSettings.js';\nimport {\n\thash_key,\n\tescape_html,\n\tdebounce_events,\n\tgetSelection,\n\tpreventDefault,\n\taddEvent,\n\tloadDebounce,\n\tisKeyDown,\n\tgetId\n} from './utils';\n\nimport {\n\tgetDom,\n\tescapeQuery,\n\ttriggerEvent,\n\tapplyCSS,\n\taddClasses,\n\tremoveClasses,\n\tparentMatch,\n\tgetTail,\n\tisEmptyObject,\n\tnodeIndex,\n\tsetAttr\n} from './vanilla';\n\nvar instance_i = 0;\n\nexport default class TomSelect extends MicroPlugin(MicroEvent){\n\n\tpublic control_input\t\t\t: HTMLInputElement;\n\tpublic wrapper\t\t\t\t\t: HTMLElement;\n\tpublic dropdown\t\t\t\t\t: HTMLElement;\n\tpublic control\t\t\t\t\t: HTMLElement;\n\tpublic dropdown_content\t\t\t: HTMLElement;\n\n\tpublic order\t\t\t\t\t: number = 0;\n\tpublic settings\t\t\t\t\t: TomSettings;\n\tpublic input\t\t\t\t\t: TomInput;\n\tpublic tabIndex\t\t\t\t\t: number;\n\tpublic is_select_tag\t\t\t: boolean;\n\tpublic rtl\t\t\t\t\t\t: boolean;\n\tprivate inputId\t\t\t\t\t: string;\n\n\tprivate _destroy\t\t\t\t: () => void;\n\tpublic sifter\t\t\t\t\t: Sifter;\n\n\n\tpublic tab_key\t\t\t\t\t: boolean = false;\n\tpublic isOpen\t\t\t\t\t: boolean = false;\n\tpublic isDisabled\t\t\t\t: boolean = false;\n\tpublic isRequired\t\t\t\t: boolean;\n\tpublic isInvalid\t\t\t\t: boolean = false;\n\tpublic isLocked\t\t\t\t\t: boolean = false;\n\tpublic isFocused\t\t\t\t: boolean = false;\n\tpublic isInputHidden\t\t\t: boolean = false;\n\tpublic isSetup\t\t\t\t\t: boolean = false;\n\tpublic ignoreFocus\t\t\t\t: boolean = false;\n\tpublic ignoreBlur\t\t\t\t: boolean = false;\n\tpublic hasOptions\t\t\t\t: boolean = false;\n\tpublic currentResults\t\t\t: ReturnType<Sifter['search']> = null;\n\tpublic lastValue\t\t\t\t: string = '';\n\tpublic caretPos\t\t\t\t\t: number = 0;\n\tpublic loading\t\t\t\t\t: number = 0;\n\tpublic loadedSearches\t\t\t: { [key: string]: boolean } = {};\n\n\tpublic activeOption\t\t\t\t: HTMLElement = null;\n\tpublic activeItems\t\t\t\t: HTMLElement[] = [];\n\n\tpublic optgroups\t\t\t\t: TomOptions = {};\n\tpublic options\t\t\t\t\t: TomOptions = {};\n\tprivate options_i\t\t\t\t: number = 0;\n\tpublic userOptions\t\t\t\t: {[key:string]:boolean} = {};\n\tpublic items\t\t\t\t\t: string[] = [];\n\tpublic renderCache\t\t\t\t: {'item':{[key:string]:HTMLElement},'option':{[key:string]:HTMLElement}} = {'item':{},'option':{}};\n\n\n\n\tconstructor( input_arg: string|TomInput, settings:TomSettings ){\n\t\tsuper();\n\n\t\tinstance_i++;\n\n\t\tvar dir;\n\t\tvar input\t\t\t\t= getDom( input_arg ) as TomInput;\n\n\t\tif( input.tomselect ){\n\t\t\tthrow new Error('Tom Select already initialized on this element');\n\t\t}\n\n\n\t\tinput.tomselect\t\t\t= this;\n\n\n\t\t// detect rtl environment\n\t\tvar computedStyle\t\t= window.getComputedStyle && window.getComputedStyle(input, null);\n\t\tdir\t\t\t\t\t\t= computedStyle.getPropertyValue('direction');\n\n\t\t// setup default state\n\t\tthis.settings\t\t\t= getSettings( input, settings );\n\t\tthis.input\t\t\t\t= input;\n\t\tthis.tabIndex\t\t\t= input.tabIndex || 0;\n\t\tthis.is_select_tag\t\t= input.tagName.toLowerCase() === 'select';\n\t\tthis.rtl\t\t\t\t= /rtl/i.test(dir);\n\t\tthis.inputId\t\t\t= getId(input, 'tomselect-'+instance_i);\n\t\tthis.isRequired\t\t\t= input.required;\n\n\n\t\t// search system\n\t\tthis.sifter = new Sifter(this.options, {diacritics: this.settings.diacritics});\n\n\t\tthis.setupOptions(this.settings.options,this.settings.optgroups);\n\t\tdelete this.settings.optgroups;\n\t\tdelete this.settings.options;\n\n\n\t\t// option-dependent defaults\n\t\tthis.settings.mode = this.settings.mode || (this.settings.maxItems === 1 ? 'single' : 'multi');\n\t\tif (typeof this.settings.hideSelected !== 'boolean') {\n\t\t\tthis.settings.hideSelected = this.settings.mode === 'multi';\n\t\t}\n\n\t\tif( typeof this.settings.hidePlaceholder !== 'boolean' ){\n\t\t\tthis.settings.hidePlaceholder = this.settings.mode !== 'multi';\n\t\t}\n\n\t\t// set up createFilter callback\n\t\tvar filter = this.settings.createFilter;\n\t\tif( typeof filter !== 'function' ){\n\n\t\t\tif( typeof filter === 'string' ){\n\t\t\t\tfilter = new RegExp(filter);\n\t\t\t}\n\n\t\t\tif( filter instanceof RegExp ){\n\t\t\t\tthis.settings.createFilter = (input) => (filter as RegExp).test(input);\n\t\t\t}else{\n\t\t\t\tthis.settings.createFilter = () => true;\n\t\t\t}\n\t\t}\n\n\n\t\tthis.initializePlugins(this.settings.plugins);\n\t\tthis.setupCallbacks();\n\t\tthis.setupTemplates();\n\t\tthis.setup();\n\t}\n\n\n\t// methods\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Creates all elements and sets up event bindings.\n\t *\n\t */\n\tsetup(){\n\n\n\t\tvar self = this;\n\t\tvar settings:TomSettings = self.settings;\n\t\tvar wrapper: HTMLElement;\n\t\tvar control: HTMLElement;\n\t\tvar control_input: HTMLInputElement;\n\t\tvar dropdown: HTMLElement;\n\t\tvar dropdown_content: HTMLElement;\n\t\tvar inputMode: string;\n\t\tvar classes;\n\t\tvar classes_plugins;\n\t\tvar input\t\t\t\t\t= self.input;\n\t\tvar control_id: string;\n\t\tconst passive_event\t\t\t= { passive: true };\n\t\tconst listboxId: string\t\t= self.inputId +'-ts-dropdown';\n\n\n\n\t\tinputMode\t\t\t= self.settings.mode;\n\t\tclasses\t\t\t\t= input.getAttribute('class') || '';\n\n\t\twrapper\t\t\t\t= getDom('<div>');\n\t\taddClasses( wrapper, settings.wrapperClass, classes, inputMode);\n\n\n\t\tcontrol\t\t\t\t= getDom('<div class=\"items\">');\n\t\taddClasses(control,settings.inputClass);\n\t\twrapper.append(control);\n\n\n\t\tdropdown\t\t\t= self.render('dropdown');\n\t\taddClasses(dropdown, settings.dropdownClass, inputMode);\n\n\t\tdropdown_content\t= getDom(`<div role=\"listbox\" id=\"${listboxId}\" tabindex=\"-1\">`);\n\t\taddClasses(dropdown_content, settings.dropdownContentClass);\n\t\tdropdown.append(dropdown_content);\n\n\t\tgetDom( settings.dropdownParent || wrapper ).appendChild( dropdown );\n\n\t\tif( settings.controlInput ){\n\t\t\tcontrol_input\t\t= getDom( settings.controlInput ) as HTMLInputElement;\n\t\t}else{\n\t\t\tcontrol_input\t\t= getDom('<input type=\"text\" autocomplete=\"off\" size=\"1\" />' ) as HTMLInputElement;\n\n\t\t\t// set attributes\n\t\t\tvar attrs = ['autocorrect','autocapitalize','autocomplete'];\n\t\t\tfor( const attr of attrs ){\n\t\t\t\tif( input.getAttribute(attr) ){\n\t\t\t\t\tsetAttr(control_input,{[attr]:input.getAttribute(attr)});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif( !settings.controlInput ){\n\t\t\tcontrol_input.tabIndex = input.disabled ? -1 : self.tabIndex;\n\t\t\tcontrol.appendChild( control_input );\n\t\t}\n\n\n\t\tsetAttr(control_input,{\n\t\t\trole:'combobox',\n\t\t\thaspopup:'listbox',\n\t\t\t'aria-expanded':'false',\n\t\t\t'aria-controls':listboxId\n\t\t});\n\n\t\tcontrol_id = getId(control_input,self.inputId + '-tomselected');\n\n\t\tlet query = \"label[for='\"+escapeQuery(self.inputId)+\"']\";\n\t\tlet label = document.querySelector(query);\n\t\tif( label ){\n\t\t\tsetAttr(label,{for:control_id});\n\t\t\tlet label_id = getId(label,self.inputId+'-ts-label');\n\t\t\tsetAttr(dropdown_content,{'aria-labelledby':label_id});\n\t\t}\n\n\n\t\tif(self.settings.copyClassesToDropdown) {\n\t\t\taddClasses( dropdown, classes);\n\t\t}\n\n\t\twrapper.style.width = input.style.width;\n\n\t\tif (self.plugins.names.length) {\n\t\t\tclasses_plugins = 'plugin-' + self.plugins.names.join(' plugin-');\n\t\t\taddClasses( [wrapper,dropdown], classes_plugins);\n\t\t}\n\n\t\tif ((settings.maxItems === null || settings.maxItems > 1) && self.is_select_tag ){\n\t\t\tsetAttr(input,{multiple:'multiple'});\n\t\t}\n\n\t\tif (self.settings.placeholder) {\n\t\t\tsetAttr(control_input,{placeholder:settings.placeholder});\n\t\t}\n\n\t\t// if splitOn was not passed in, construct it from the delimiter to allow pasting universally\n\t\tif (!self.settings.splitOn && self.settings.delimiter) {\n\t\t\tvar delimiterEscaped = self.settings.delimiter.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n\t\t\tself.settings.splitOn = new RegExp('\\\\s*' + delimiterEscaped + '+\\\\s*');\n\t\t}\n\n\t\t// debounce user defined load() if loadThrottle > 0\n\t\t// after initializePlugins() so plugins can create/modify user defined loaders\n\t\tif( this.settings.load && this.settings.loadThrottle ){\n\t\t\tthis.settings.load = loadDebounce(this.settings.load,this.settings.loadThrottle)\n\t\t}\n\n\n\t\tself.control\t\t\t= control;\n\t\tself.control_input\t\t= control_input;\n\t\tself.wrapper\t\t\t= wrapper;\n\t\tself.dropdown\t\t\t= dropdown;\n\t\tself.dropdown_content\t= dropdown_content;\n\n\t\tself.control_input.type\t= input.type;\n\n\t\taddEvent(dropdown,'mouseenter', (e) => {\n\n\t\t\tvar target_match = parentMatch(e.target as HTMLElement, '[data-selectable]', dropdown);\n\t\t\tif( target_match ){\n\t\t\t\treturn self.onOptionHover( e as MouseEvent, target_match );\n\t\t\t}\n\t\t}, {capture:true});\n\n\t\taddEvent(control,'mousedown', (evt) => {\n\n\t\t\t// retain focus by preventing native handling. if the\n\t\t\t// event target is the input it should not be modified.\n\t\t\t// otherwise, text selection within the input won't work.\n\t\t\tif (evt.target == control_input) {\n\t\t\t\tself.clearActiveItems();\n\t\t\t\tevt.stopPropagation();\n\t\t\t\tself.inputState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar target_match = parentMatch( evt.target as HTMLElement, '.'+self.settings.itemClass, control);\n\t\t\tif( target_match ){\n\t\t\t\treturn self.onItemSelect(evt as MouseEvent, target_match);\n\t\t\t}\n\t\t\treturn self.onMouseDown(evt as MouseEvent);\n\t\t});\n\n\t\taddEvent(control,'click', (e) => self.onClick(e as KeyboardEvent) );\n\n\n\t\taddEvent(control_input,'keydown',\t(e) => self.onKeyDown(e as KeyboardEvent) );\n\t\taddEvent(control_input,'keyup',\t\t(e) => self.onKeyUp(e as KeyboardEvent) );\n\t\taddEvent(control_input,'keypress',\t(e) => self.onKeyPress(e as KeyboardEvent) );\n\t\taddEvent(control_input,'resize',\t() => self.positionDropdown(), passive_event);\n\t\taddEvent(control_input,'blur',\t\t(e) => self.onBlur(e as MouseEvent) );\n\t\taddEvent(control_input,'focus',\t\t(e) => { self.ignoreBlur = false; self.onFocus(e as MouseEvent) });\n\t\taddEvent(control_input,'paste',\t\t(e) => self.onPaste(e as MouseEvent) );\n\n\n\t\t// clicking anywhere in the control should not close the dropdown\n\t\t// clicking on an option should selectit\n\t\tvar doc_mousedown = (e:MouseEvent) => {\n\n\t\t\t// if dropdownParent is set, options may not be within self.wrapper\n\t\t\tvar option = parentMatch(e.target as HTMLElement, '[data-selectable]',self.dropdown);\n\n\t\t\t// outside of this instance\n\t\t\tif( !option && !self.wrapper.contains(e.target as HTMLElement) ){\n\t\t\t\tif (self.isFocused) {\n\t\t\t\t\tself.blur();\n\t\t\t\t}\n\t\t\t\tself.inputState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpreventDefault(e,true);\n\n\t\t\tif( option ){\n\t\t\t\tself.onOptionSelect( e, option );\n\t\t\t}\n\t\t};\n\n\t\tvar win_scroll = () => {\n\t\t\tif (self.isOpen) {\n\t\t\t\tself.positionDropdown();\n\t\t\t}\n\t\t};\n\n\n\t\taddEvent(document,'mousedown',doc_mousedown);\n\t\taddEvent(window,'sroll', win_scroll, passive_event);\n\t\taddEvent(window,'resize', win_scroll, passive_event);\n\n\t\tself._destroy = () => {\n\t\t\tdocument.removeEventListener('mousedown',doc_mousedown);\n\t\t\twindow.removeEventListener('sroll',win_scroll);\n\t\t\twindow.removeEventListener('resize',win_scroll);\n\t\t};\n\n\t\t// store original html and tab index so that they can be\n\t\t// restored when the destroy() method is called.\n\t\tthis.revertSettings = {\n\t\t\tinnerHTML : input.innerHTML,\n\t\t\ttabIndex : input.tabIndex\n\t\t};\n\n\n\t\tinput.tabIndex = -1;\n\t\tsetAttr(input,{\thidden:'hidden'});\n\t\tinput.insertAdjacentElement('afterend', self.wrapper);\n\n\n\t\tself.setValue(settings.items);\n\t\tdelete settings.items;\n\n\t\taddEvent(input,'invalid', (e) => {\n\t\t\tpreventDefault(e);\n\t\t\tif( !self.isInvalid ){\n\t\t\t\tself.isInvalid = true;\n\t\t\t\tself.refreshState();\n\t\t\t}\n\t\t});\n\n\t\tself.updateOriginalInput();\n\t\tself.refreshItems();\n\t\tself.refreshState();\n\t\tself.inputState();\n\t\tself.isSetup = true;\n\n\t\tif( input.disabled ){\n\t\t\tself.disable();\n\t\t}\n\n\t\tself.on('change', this.onChange);\n\n\t\taddClasses(input,'tomselected');\n\t\tself.trigger('initialize');\n\n\t\t// preload options\n\t\tif (settings.preload === true) {\n\t\t\tself.load('');\n\t\t}\n\n\t}\n\n\n\t/**\n\t * Register options and optgroups\n\t *\n\t */\n\tsetupOptions(options:TomOption[] = [], optgroups:TomOption[] = []){\n\n\t\t// build options table\n\t\tfor( const option of options ){\n\t\t\tthis.registerOption(option);\n\t\t}\n\n\n\t\t// build optgroup table\n\t\tfor( const optgroup of optgroups ){\n\t\t\tthis.registerOptionGroup(optgroup);\n\t\t}\n\t}\n\n\t/**\n\t * Sets up default rendering functions.\n\t */\n\tsetupTemplates() {\n\t\tvar self = this;\n\t\tvar field_label = self.settings.labelField;\n\t\tvar field_optgroup = self.settings.optgroupLabelField;\n\n\t\tvar templates = {\n\t\t\t'optgroup': (data:TomOption, escape:typeof escape_html) => {\n\t\t\t\tlet optgroup = document.createElement('div');\n\t\t\t\toptgroup.className = 'optgroup';\n\t\t\t\toptgroup.appendChild(data.options);\n\t\t\t\treturn optgroup;\n\n\t\t\t},\n\t\t\t'optgroup_header': (data:TomOption, escape:typeof escape_html) => {\n\t\t\t\treturn '<div class=\"optgroup-header\">' + escape(data[field_optgroup]) + '</div>';\n\t\t\t},\n\t\t\t'option': (data:TomOption, escape:typeof escape_html) => {\n\t\t\t\treturn '<div>' + escape(data[field_label]) + '</div>';\n\t\t\t},\n\t\t\t'item': (data:TomOption, escape:typeof escape_html) => {\n\t\t\t\treturn '<div>' + escape(data[field_label]) + '</div>';\n\t\t\t},\n\t\t\t'option_create': (data:TomOption, escape:typeof escape_html) => {\n\t\t\t\treturn '<div class=\"create\">Add <strong>' + escape(data.input) + '</strong>&hellip;</div>';\n\t\t\t},\n\t\t\t'no_results':(data:TomOption,escape:typeof escape_html) => {\n\t\t\t\treturn '<div class=\"no-results\">No results found</div>';\n\t\t\t},\n\t\t\t'loading':(data:TomOption,escape:typeof escape_html) => {\n\t\t\t\treturn '<div class=\"spinner\"></div>';\n\t\t\t},\n\t\t\t'not_loading':() => {},\n\t\t\t'dropdown':() => {\n\t\t\t\treturn '<div></div>';\n\t\t\t}\n\t\t};\n\n\n\t\tself.settings.render = Object.assign({}, templates, self.settings.render);\n\t}\n\n\t/**\n\t * Maps fired events to callbacks provided\n\t * in the settings used when creating the control.\n\t */\n\tsetupCallbacks() {\n\t\tvar key, fn;\n\t\tvar callbacks:{[key:string]:string} = {\n\t\t\t'initialize'      : 'onInitialize',\n\t\t\t'change'          : 'onChange',\n\t\t\t'item_add'        : 'onItemAdd',\n\t\t\t'item_remove'     : 'onItemRemove',\n\t\t\t'clear'           : 'onClear',\n\t\t\t'option_add'      : 'onOptionAdd',\n\t\t\t'option_remove'   : 'onOptionRemove',\n\t\t\t'option_clear'    : 'onOptionClear',\n\t\t\t'optgroup_add'    : 'onOptionGroupAdd',\n\t\t\t'optgroup_remove' : 'onOptionGroupRemove',\n\t\t\t'optgroup_clear'  : 'onOptionGroupClear',\n\t\t\t'dropdown_open'   : 'onDropdownOpen',\n\t\t\t'dropdown_close'  : 'onDropdownClose',\n\t\t\t'type'            : 'onType',\n\t\t\t'load'            : 'onLoad',\n\t\t\t'focus'           : 'onFocus',\n\t\t\t'blur'            : 'onBlur'\n\t\t};\n\n\t\tfor (key in callbacks) {\n\n\t\t\tfn = this.settings[callbacks[key] as (keyof TomSettings)];\n\t\t\tif (fn) this.on(key, fn);\n\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the main control element\n\t * has a click event.\n\t *\n\t */\n\tonClick(e:MouseEvent|KeyboardEvent) {\n\t\tvar self = this;\n\n\t\t// necessary for mobile webkit devices (manual focus triggering\n\t\t// is ignored unless invoked within a click event)\n\t\t// also necessary to reopen a dropdown that has been closed by\n\t\t// closeAfterSelect\n\t\tif (!self.isFocused || !self.isOpen) {\n\t\t\tself.focus();\n\t\t\tpreventDefault(e);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the main control element\n\t * has a mouse down event.\n\t *\n\t */\n\tonMouseDown(e:MouseEvent|KeyboardEvent):boolean {\n\t\tvar self = this;\n\n\n\t\tif (self.isFocused) {\n\t\t\tif (self.settings.mode !== 'single') {\n\t\t\t\tself.setActiveItem();\n\t\t\t}\n\t\t\tself.open();\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// give control focus\n\t\t\tsetTimeout(() => self.focus(), 0);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the value of the control has been changed.\n\t * This should propagate the event to the original DOM\n\t * input / select element.\n\t */\n\tonChange() {\n\t\ttriggerEvent(this.input, 'input');\n\t\ttriggerEvent(this.input, 'change');\n\t}\n\n\t/**\n\t * Triggered on <input> paste.\n\t *\n\t */\n\tonPaste(e:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tif (self.isFull() || self.isInputHidden || self.isLocked) {\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\t// If a regex or string is included, this will split the pasted\n\t\t// input and create Items for each separate value\n\t\tif (self.settings.splitOn) {\n\n\t\t\t// Wait for pasted text to be recognized in value\n\t\t\tsetTimeout(() => {\n\t\t\t\tvar pastedText = self.inputValue();\n\t\t\t\tif(!pastedText.match(self.settings.splitOn)){ return }\n\n\t\t\t\tvar splitInput = pastedText.trim().split(self.settings.splitOn);\n\t\t\t\tfor( const piece of splitInput ){\n\t\t\t\t\tself.createItem(piece);\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keypress.\n\t *\n\t */\n\tonKeyPress(e:KeyboardEvent):void {\n\t\tvar self = this;\n\t\tif(self.isLocked){\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\t\tvar character = String.fromCharCode(e.keyCode || e.which);\n\t\tif (self.settings.create && self.settings.mode === 'multi' && character === self.settings.delimiter) {\n\t\t\tself.createItem();\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keydown.\n\t *\n\t */\n\tonKeyDown(e:KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tif (self.isLocked) {\n\t\t\tif (e.keyCode !== constants.KEY_TAB) {\n\t\t\t\tpreventDefault(e);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e.keyCode) {\n\n\t\t\t// ctrl+A: select all\n\t\t\tcase constants.KEY_A:\n\t\t\t\tif( isKeyDown(constants.KEY_SHORTCUT,e) ){\n\t\t\t\t\tself.selectAll();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// esc: close dropdown\n\t\t\tcase constants.KEY_ESC:\n\t\t\t\tif (self.isOpen) {\n\t\t\t\t\tpreventDefault(e,true);\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t\tself.clearActiveItems();\n\t\t\t\treturn;\n\n\t\t\t// down: open dropdown or move selection down\n\t\t\tcase constants.KEY_DOWN:\n\t\t\t\tif (!self.isOpen && self.hasOptions) {\n\t\t\t\t\tself.open();\n\t\t\t\t} else if (self.activeOption) {\n\t\t\t\t\tlet next = self.getAdjacent(self.activeOption, 1);\n\t\t\t\t\tif (next) self.setActiveOption(next);\n\t\t\t\t}\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\n\t\t\t// up: move selection up\n\t\t\tcase constants.KEY_UP:\n\t\t\t\tif (self.activeOption) {\n\t\t\t\t\tlet prev = self.getAdjacent(self.activeOption, -1);\n\t\t\t\t\tif (prev) self.setActiveOption(prev);\n\t\t\t\t}\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\n\t\t\t// doc_src select active option\n\t\t\tcase constants.KEY_RETURN:\n\t\t\t\tif (self.isOpen && self.activeOption) {\n\t\t\t\t\tself.onOptionSelect(e,self.activeOption);\n\t\t\t\t\tpreventDefault(e);\n\n\t\t\t\t// if the option_create=null, the dropdown might be closed\n\t\t\t\t}else if (self.settings.create && self.createItem()) {\n\t\t\t\t\tpreventDefault(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\t// left: modifiy item selection to the left\n\t\t\tcase constants.KEY_LEFT:\n\t\t\t\tself.advanceSelection(-1, e);\n\t\t\t\treturn;\n\n\t\t\t// right: modifiy item selection to the right\n\t\t\tcase constants.KEY_RIGHT:\n\t\t\t\tself.advanceSelection(1, e);\n\t\t\t\treturn;\n\n\t\t\t// tab: select active option and/or create item\n\t\t\tcase constants.KEY_TAB:\n\t\t\t\tif( self.settings.selectOnTab ){\n\t\t\t\t\tif( self.isOpen && self.activeOption) {\n\t\t\t\t\t\tself.tab_key = true;\n\t\t\t\t\t\tself.onOptionSelect(e,self.activeOption);\n\n\t\t\t\t\t\t// prevent default [tab] behaviour of jump to the next field\n\t\t\t\t\t\t// if select isFull, then the dropdown won't be open and [tab] will work normally\n\t\t\t\t\t\tpreventDefault(e);\n\t\t\t\t\t\tself.tab_key = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (self.settings.create && self.createItem()) {\n\t\t\t\t\t\tpreventDefault(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\t// delete|backspace: delete items\n\t\t\tcase constants.KEY_BACKSPACE:\n\t\t\tcase constants.KEY_DELETE:\n\t\t\t\tself.deleteSelection(e);\n\t\t\t\treturn;\n\t\t}\n\n\t\t// don't enter text in the control_input when active items are selected\n\t\tif( self.isInputHidden && !isKeyDown(constants.KEY_SHORTCUT,e) ){\n\t\t\tpreventDefault(e);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keyup.\n\t *\n\t */\n\tonKeyUp(e:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tif (self.isLocked){\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\tvar value = self.inputValue();\n\t\tif (self.lastValue !== value) {\n\t\t\tself.lastValue = value;\n\n\t\t\tif( self.settings.shouldLoad.call(self,value) ){\n\t\t\t\tself.load(value);\n\t\t\t}\n\n\t\t\tself.refreshOptions();\n\t\t\tself.trigger('type', value);\n\t\t}\n\t}\n\n\n\t/**\n\t * Triggered on <input> focus.\n\t *\n\t */\n\tonFocus(e?:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\t\tvar wasFocused = self.isFocused;\n\n\t\tif (self.isDisabled) {\n\t\t\tself.blur();\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif (self.ignoreFocus) return;\n\t\tself.isFocused = true;\n\t\tif (self.settings.preload === 'focus') self.load('');\n\n\t\tif (!wasFocused) self.trigger('focus');\n\n\t\tif (!self.activeItems.length) {\n\t\t\tself.showInput();\n\t\t\tself.setActiveItem();\n\t\t\tself.refreshOptions(!!self.settings.openOnFocus);\n\t\t}\n\n\t\tself.refreshState();\n\t}\n\n\t/**\n\t * Triggered on <input> blur.\n\t *\n\t */\n\tonBlur(e:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\t\tif (!self.isFocused) return;\n\t\tself.isFocused = false;\n\t\tself.ignoreFocus = false;\n\n\n\t\tif (!self.ignoreBlur && document.activeElement === self.dropdown_content) {\n\t\t\t// necessary to prevent IE closing the dropdown when the scrollbar is clicked\n\t\t\tself.ignoreBlur = true;\n\t\t\tself.onFocus(e);\n\t\t\treturn;\n\t\t}\n\n\t\tvar deactivate = () => {\n\t\t\tself.close();\n\t\t\tself.setActiveItem();\n\t\t\tself.setCaret(self.items.length);\n\t\t\tself.trigger('blur');\n\t\t};\n\n\t\tif (self.settings.create && self.settings.createOnBlur) {\n\t\t\tself.createItem(null, false, deactivate);\n\t\t} else {\n\t\t\tdeactivate();\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the user rolls over\n\t * an option in the autocomplete dropdown menu.\n\t * @deprecated v1.3\n\t */\n\tonOptionHover( evt:MouseEvent|KeyboardEvent, option:HTMLElement ){}\n\n\t/**\n\t * Triggered when the user clicks on an option\n\t * in the autocomplete dropdown menu.\n\t *\n\t */\n\tonOptionSelect( evt:MouseEvent|KeyboardEvent, option:HTMLElement ){\n\t\tvar value, self = this;\n\n\t\tif( !option ){\n\t\t\treturn;\n\t\t}\n\n\t\t// should not be possible to trigger a option under a disabled optgroup\n\t\tif( option.parentElement && option.parentElement.matches('[data-disabled]') ){\n\t\t\treturn;\n\t\t}\n\n\n\t\tif( option.classList.contains('create') ){\n\t\t\tself.createItem(null, true, () => {\n\t\t\t\tif (self.settings.closeAfterSelect) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvalue = option.dataset.value;\n\t\t\tif (typeof value !== 'undefined') {\n\t\t\t\tself.lastQuery = null;\n\t\t\t\tself.addItem(value);\n\t\t\t\tif (self.settings.closeAfterSelect) {\n\t\t\t\t\tself.close();\n\t\t\t\t} else if (!self.settings.hideSelected && evt.type && /mouse/.test(evt.type)) {\n\t\t\t\t\tself.setActiveOption(self.getOption(value));\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the user clicks on an item\n\t * that has been selected.\n\t *\n\t */\n\tonItemSelect( evt?:MouseEvent, item?:HTMLElement ):boolean{\n\t\tvar self = this;\n\n\t\tif (self.isLocked) return;\n\t\tif (self.settings.mode === 'multi') {\n\t\t\tpreventDefault(evt);\n\t\t\tself.setActiveItem(item, evt);\n\t\t}\n\t}\n\n\n\t/**\n\t * Invokes the user-provided option provider / loader.\n\t *\n\t */\n\tload(value:string):void {\n\n\t\tvar self = this;\n\t\tvar fn = self.settings.load;\n\t\tif (!fn) return;\n\t\tif (self.loadedSearches.hasOwnProperty(value)) return;\n\n\t\taddClasses(self.wrapper,self.settings.loadingClass);\n\t\tself.loading++;\n\n\t\tconst callback = self.loadCallback.bind(self);\n\t\tfn.call(self, value, callback);\n\t}\n\n\t/**\n\t * Invoked by the user-provided option provider\n\t *\n\t */\n\tloadCallback(options:TomOption[], optgroups:TomOption[]){\n\t\tconst self = this;\n\t\tself.loading = Math.max(self.loading - 1, 0);\n\t\tself.lastQuery = null;\n\n\t\tself.clearActiveOption(); // when new results load, focus should be on first option\n\t\tself.setupOptions(options,optgroups);\n\n\t\tself.refreshOptions(self.isFocused && !self.isInputHidden);\n\n\t\tif (!self.loading) {\n\t\t\tremoveClasses(self.wrapper,self.settings.loadingClass);\n\t\t}\n\n\t\tself.trigger('load', options, optgroups);\n\t}\n\n\t/**\n\t * @deprecated 1.1\n\t *\n\t */\n\tonSearchChange(value:string):void {\n\t\tthis.load(value);\n\t}\n\n\n\t/**\n\t * Sets the input field of the control to the specified value.\n\t *\n\t */\n\tsetTextboxValue(value:string = '') {\n\t\tvar input = this.control_input;\n\t\tvar changed = input.value !== value;\n\t\tif (changed) {\n\t\t\tinput.value = value;\n\t\t\ttriggerEvent(input,'update');\n\t\t\tthis.lastValue = value;\n\t\t}\n\t}\n\n\t/**\n\t * Returns the value of the control. If multiple items\n\t * can be selected (e.g. <select multiple>), this returns\n\t * an array. If only one item can be selected, this\n\t * returns a string.\n\t *\n\t */\n\tgetValue():string|string[] {\n\n\t\tif( this.is_select_tag && this.input.hasAttribute('multiple')) {\n\t\t\treturn this.items;\n\t\t}\n\n\t\treturn this.items.join(this.settings.delimiter);\n\t}\n\n\t/**\n\t * Resets the selected items to the given value.\n\t *\n\t */\n\tsetValue( value:string|string[], silent?:boolean ):void{\n\t\tvar events = silent ? [] : ['change'];\n\n\t\tdebounce_events(this, events,() => {\n\t\t\tthis.clear(silent);\n\t\t\tthis.addItems(value, silent);\n\t\t});\n\t}\n\n\n\t/**\n\t * Resets the number of max items to the given value\n\t *\n\t */\n\tsetMaxItems(value:number){\n\t\tif(value === 0) value = null; //reset to unlimited items.\n\t\tthis.settings.maxItems = value;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Sets the selected item.\n\t *\n\t */\n\tsetActiveItem( item?:HTMLElement, e?:MouseEvent|KeyboardEvent ){\n\t\tvar self = this;\n\t\tvar eventName;\n\t\tvar i, begin, end, swap;\n\t\tvar last;\n\n\t\tif (self.settings.mode === 'single') return;\n\n\t\t// clear the active selection\n\t\tif( !item ){\n\t\t\tself.clearActiveItems();\n\t\t\tif (self.isFocused) {\n\t\t\t\tself.showInput();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// modify selection\n\t\teventName = e && e.type.toLowerCase();\n\n\t\tif (eventName === 'mousedown' && isKeyDown('shiftKey',e) && self.activeItems.length) {\n\t\t\tlast\t= self.getLastActive();\n\t\t\tbegin\t= Array.prototype.indexOf.call(self.control.children, last);\n\t\t\tend\t\t= Array.prototype.indexOf.call(self.control.children, item);\n\n\t\t\tif (begin > end) {\n\t\t\t\tswap  = begin;\n\t\t\t\tbegin = end;\n\t\t\t\tend   = swap;\n\t\t\t}\n\t\t\tfor (i = begin; i <= end; i++) {\n\t\t\t\titem = self.control.children[i] as HTMLElement;\n\t\t\t\tif (self.activeItems.indexOf(item) === -1) {\n\t\t\t\t\tself.setActiveItemClass(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\tpreventDefault(e);\n\t\t} else if ((eventName === 'mousedown' && isKeyDown(constants.KEY_SHORTCUT,e) ) || (eventName === 'keydown' && isKeyDown('shiftKey',e))) {\n\t\t\tif( item.classList.contains('active') ){\n\t\t\t\tself.removeActiveItem( item );\n\t\t\t} else {\n\t\t\t\tself.setActiveItemClass(item);\n\t\t\t}\n\t\t} else {\n\t\t\tself.clearActiveItems();\n\t\t\tself.setActiveItemClass(item);\n\t\t}\n\n\t\t// ensure control has focus\n\t\tself.hideInput();\n\t\tif (!self.isFocused) {\n\t\t\tself.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Set the active and last-active classes\n\t *\n\t */\n\tsetActiveItemClass( item:HTMLElement ){\n\n\t\tvar last_active = this.control.querySelector('.last-active');\n\t\tif( last_active ) removeClasses(last_active as HTMLElement,'last-active');\n\n\t\taddClasses(item,'active last-active');\n\t\tif( this.activeItems.indexOf(item) == -1 ){\n\t\t\tthis.activeItems.push( item );\n\t\t}\n\t}\n\n\t/**\n\t * Remove active item\n\t *\n\t */\n\tremoveActiveItem( item:HTMLElement ){\n\t\tvar idx = this.activeItems.indexOf(item);\n\t\tthis.activeItems.splice(idx, 1);\n\t\tremoveClasses(item,'active');\n\t}\n\n\t/**\n\t * Clears all the active items\n\t *\n\t */\n\tclearActiveItems(){\n\t\tremoveClasses(this.activeItems,'active');\n\t\tthis.activeItems = [];\n\t}\n\n\t/**\n\t * Sets the selected item in the dropdown menu\n\t * of available options.\n\t *\n\t */\n\tsetActiveOption( option:HTMLElement ){\n\t\tvar height_menu, height_item, y;\n\n\t\tif( option === this.activeOption ){\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clearActiveOption();\n\t\tif( !option ) return;\n\n\t\tthis.activeOption = option;\n\t\tsetAttr(this.control_input,{'aria-activedescendant':option.getAttribute('id')});\n\t\tsetAttr(option,{'aria-selected':'true'});\n\t\taddClasses(option,'active');\n\n\t\theight_menu\t\t= this.dropdown_content.clientHeight;\n\t\tlet scrollTop\t= this.dropdown_content.scrollTop || 0;\n\n\t\theight_item\t\t= this.activeOption.offsetHeight;\n\t\ty\t\t\t\t= this.activeOption.getBoundingClientRect().top - this.dropdown_content.getBoundingClientRect().top + scrollTop;\n\n\t\tif (y + height_item > height_menu + scrollTop) {\n\t\t\tthis.dropdown_content.scrollTop = y - height_menu + height_item;\n\n\t\t} else if (y < scrollTop) {\n\t\t\tthis.dropdown_content.scrollTop = y;\n\t\t}\n\t}\n\n\n\t/**\n\t * Clears the active option\n\t *\n\t */\n\tclearActiveOption(){\n\t\tif( this.activeOption ){\n\t\t\tremoveClasses(this.activeOption,'active');\n\t\t\tthis.activeOption.removeAttribute('aria-selected');\n\t\t}\n\t\tthis.activeOption = null;\n\t\tthis.control_input.removeAttribute('aria-activedescendant');\n\t}\n\n\n\t/**\n\t * Selects all items (CTRL + A).\n\t */\n\tselectAll() {\n\n\t\tif (this.settings.mode === 'single') return;\n\n\t\tthis.activeItems = this.controlChildren();\n\n\t\tif( this.activeItems.length ){\n\t\t\taddClasses( this.activeItems, 'active' );\n\n\t\t\tthis.hideInput();\n\t\t\tthis.close();\n\t\t}\n\t\tthis.focus();\n\t}\n\n\t/**\n\t * Determines if the control_input should be in a hidden or visible state\n\t *\n\t */\n\tinputState(){\n\t\tvar self = this;\n\n\t\tif( self.settings.controlInput ) return;\n\n\t\tif( self.activeItems.length > 0 || (!self.isFocused && this.settings.hidePlaceholder && self.items.length > 0) ){\n\t\t\tself.setTextboxValue();\n\t\t\tself.isInputHidden = true;\n\t\t\taddClasses(self.wrapper,'input-hidden');\n\t\t}else{\n\t\t\tself.isInputHidden = false;\n\t\t\tremoveClasses(self.wrapper,'input-hidden');\n\t\t}\n\t}\n\n\t/**\n\t * Hides the input element out of view, while\n\t * retaining its focus.\n\t * @deprecated 1.3\n\t */\n\thideInput() {\n\t\tthis.inputState();\n\t}\n\n\t/**\n\t * Restores input visibility.\n\t * @deprecated 1.3\n\t */\n\tshowInput() {\n\t\tthis.inputState();\n\t}\n\n\t/**\n\t * Get the input value\n\t */\n\tinputValue(){\n\t\treturn this.control_input.value.trim();\n\t}\n\n\t/**\n\t * Gives the control focus.\n\t */\n\tfocus() {\n\t\tvar self = this;\n\t\tif (self.isDisabled) return;\n\n\t\tself.ignoreFocus = true;\n\t\tself.control_input.focus();\n\t\tsetTimeout(() => {\n\t\t\tself.ignoreFocus = false;\n\t\t\tself.onFocus();\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Forces the control out of focus.\n\t *\n\t */\n\tblur():void {\n\t\tthis.control_input.blur();\n\n\t\tthis.onBlur(null);\n\t}\n\n\t/**\n\t * Returns a function that scores an object\n\t * to show how good of a match it is to the\n\t * provided query.\n\t *\n\t * @return {function}\n\t */\n\tgetScoreFunction(query:string) {\n\t\treturn this.sifter.getScoreFunction(query, this.getSearchOptions());\n\t}\n\n\t/**\n\t * Returns search options for sifter (the system\n\t * for scoring and sorting results).\n\t *\n\t * @see https://github.com/brianreavis/sifter.js\n\t * @return {object}\n\t */\n\tgetSearchOptions() {\n\t\tvar sort;\n\t\tvar settings = this.settings;\n\t\tif (typeof settings.sortField === 'string') {\n\t\t\tsort = [{field: settings.sortField}];\n\t\t}\n\n\t\treturn {\n\t\t\tfields      : settings.searchField,\n\t\t\tconjunction : settings.searchConjunction,\n\t\t\tsort        : sort,\n\t\t\tnesting     : settings.nesting\n\t\t};\n\t}\n\n\t/**\n\t * Searches through available options and returns\n\t * a sorted array of matches.\n\t *\n\t */\n\tsearch(query:string) : ReturnType<Sifter['search']>{\n\t\tvar i, result, calculateScore;\n\t\tvar self     = this;\n\t\tvar settings = self.settings;\n\t\tvar options  = this.getSearchOptions();\n\n\t\t// validate user-provided result scoring function\n\t\tif (settings.score) {\n\t\t\tcalculateScore = self.settings.score.call(self,query);\n\t\t\tif (typeof calculateScore !== 'function') {\n\t\t\t\tthrow new Error('Tom Select \"score\" setting must be a function that returns a function');\n\t\t\t}\n\t\t}\n\n\t\t// perform search\n\t\tif (query !== self.lastQuery) {\n\t\t\tself.lastQuery\t\t\t= query;\n\t\t\tresult\t\t\t\t\t= self.sifter.search(query, Object.assign(options, {score: calculateScore}));\n\t\t\tself.currentResults\t\t= result;\n\t\t} else {\n\t\t\tresult\t\t\t\t\t= Object.assign( {}, self.currentResults);\n\t\t}\n\n\t\t// filter out selected items\n\t\tif (settings.hideSelected) {\n\t\t\tfor (i = result.items.length - 1; i >= 0; i--) {\n\t\t\t\tif (self.items.indexOf(hash_key(result.items[i].id)) !== -1) {\n\t\t\t\t\tresult.items.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Refreshes the list of available options shown\n\t * in the autocomplete dropdown menu.\n\t *\n\t */\n\trefreshOptions( triggerDropdown:boolean = true ){\n\t\tvar i, j, k, n, groups_order, optgroup, optgroups, html, has_create_option;\n\t\tvar active, create;\n\t\tvar groups: {[key:string]:DocumentFragment};\n\n\n\t\tvar self\t\t\t\t\t= this;\n\t\tvar query\t\t\t\t\t= self.inputValue();\n\t\tvar results\t\t\t\t\t= self.search(query);\n\t\tvar active_before_hash\t\t= self.activeOption && hash_key(self.activeOption.dataset.value);\n\t\tvar show_dropdown\t\t\t= self.settings.shouldOpen || false;\n\n\n\t\t// build markup\n\t\tn = results.items.length;\n\t\tif (typeof self.settings.maxOptions === 'number') {\n\t\t\tn = Math.min(n, self.settings.maxOptions);\n\t\t}\n\n\t\tif( n > 0 ){\n\t\t\tshow_dropdown = true;\n\t\t}\n\n\t\t// render and group available options individually\n\t\tgroups = {};\n\t\tgroups_order = [];\n\n\t\tfor (i = 0; i < n; i++) {\n\n\t\t\t// get option dom element, don't re-render if we\n\t\t\tlet option\t\t\t= self.options[results.items[i].id];\n\t\t\tlet opt_value\t\t= hash_key(option[self.settings.valueField]);\n\t\t\tlet option_el\t\t= self.getOption(opt_value);\n\t\t\tif( !option_el ){\n\t\t\t\toption_el = self.render('option', option);\n\t\t\t}\n\n\t\t\t// toggle 'selected' class\n\t\t\tif( !self.settings.hideSelected ){\n\t\t\t\toption_el.classList.toggle('selected', self.items.includes(opt_value) );\n\t\t\t}\n\n\t\t\toptgroup    = option[self.settings.optgroupField] || '';\n\t\t\toptgroups   = Array.isArray(optgroup) ? optgroup : [optgroup];\n\n\t\t\tfor (j = 0, k = optgroups && optgroups.length; j < k; j++) {\n\t\t\t\toptgroup = optgroups[j];\n\t\t\t\tif (!self.optgroups.hasOwnProperty(optgroup)) {\n\t\t\t\t\toptgroup = '';\n\t\t\t\t}\n\t\t\t\tif (!groups.hasOwnProperty(optgroup)) {\n\t\t\t\t\tgroups[optgroup] = document.createDocumentFragment();\n\t\t\t\t\tgroups_order.push(optgroup);\n\t\t\t\t}\n\n\t\t\t\t// a child could only have one parent, so if you have more parents clone the child\n\t\t\t\tif( j > 0 ){\n\t\t\t\t\toption_el = option_el.cloneNode(true) as HTMLElement;\n\t\t\t\t\tremoveClasses(option_el,'active');\n\t\t\t\t\toption_el.removeAttribute('aria-selected');\n\t\t\t\t}\n\n\t\t\t\tgroups[optgroup].appendChild(option_el);\n\t\t\t}\n\t\t}\n\n\t\t// sort optgroups\n\t\tif (this.settings.lockOptgroupOrder) {\n\t\t\tgroups_order.sort((a, b) => {\n\t\t\t\tvar a_order = self.optgroups[a] && self.optgroups[a].$order || 0;\n\t\t\t\tvar b_order = self.optgroups[b] && self.optgroups[b].$order || 0;\n\t\t\t\treturn a_order - b_order;\n\t\t\t});\n\t\t}\n\n\t\t// render optgroup headers & join groups\n\t\thtml = document.createDocumentFragment();\n\t\tfor( optgroup of groups_order ){\n\t\t\tif (self.optgroups.hasOwnProperty(optgroup) && groups[optgroup].children.length) {\n\n\t\t\t\tlet group_options = document.createDocumentFragment();\n\t\t\t\tgroup_options.append(self.render('optgroup_header', self.optgroups[optgroup]));\n\t\t\t\tgroup_options.append(groups[optgroup]);\n\n\t\t\t\tlet group_html = self.render('optgroup', {group:self.optgroups[optgroup],options:group_options} );\n\n\t\t\t\thtml.append(group_html);\n\n\t\t\t} else {\n\t\t\t\thtml.append(groups[optgroup]);\n\t\t\t}\n\t\t}\n\n\t\tself.dropdown_content.innerHTML = '';\n\t\tself.dropdown_content.append(html);\n\n\t\t// highlight matching terms inline\n\t\tif (self.settings.highlight) {\n\t\t\tremoveHighlight( self.dropdown_content );\n\t\t\tif (results.query.length && results.tokens.length) {\n\t\t\t\tfor( const tok of results.tokens ){\n\t\t\t\t\thighlight( self.dropdown_content, tok.regex);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// helper method for adding templates to dropdown\n\t\tvar add_template = (template:string) => {\n\t\t\tlet content = self.render(template,{input:query});\n\t\t\tif( content ){\n\t\t\t\tshow_dropdown = true;\n\t\t\t\tself.dropdown_content.insertBefore(content, self.dropdown_content.firstChild);\n\t\t\t}\n\t\t\treturn content;\n\t\t};\n\n\t\t// invalid query\n\t\tif( !self.settings.shouldLoad.call(self,query) ){\n\t\t\tadd_template('not_loading');\n\n\t\t// add loading message\n\t\t}else if( self.loading ){\n\t\t\tadd_template('loading');\n\n\t\t// add no_results message\n\t\t}else if( results.items.length === 0 ){\n\t\t\tadd_template('no_results');\n\n\t\t}\n\n\n\n\t\t// add create option\n\t\thas_create_option = self.canCreate(query);\n\t\tif (has_create_option) {\n\t\t\tcreate = add_template('option_create');\n\t\t}\n\n\n\t\t// activate\n\t\tself.hasOptions = results.items.length > 0 || has_create_option;\n\t\tif( show_dropdown ){\n\n\t\t\tif (results.items.length > 0) {\n\n\t\t\t\tactive = active_before_hash && self.getOption(active_before_hash);\n\n\t\t\t\tif( !active || !self.dropdown_content.contains(active)  ){\n\n\t\t\t\t\tlet active_index = 0;\n\t\t\t\t\tif( create && !self.settings.addPrecedence ){\n\t\t\t\t\t\tactive_index = 1;\n\t\t\t\t\t}\n\t\t\t\t\tactive = self.selectable()[active_index] as HTMLElement;\n\t\t\t\t}\n\n\t\t\t}else{\n\t\t\t\tactive = create;\n\t\t\t}\n\n\t\t\tself.setActiveOption(active);\n\t\t\tif( triggerDropdown && !self.isOpen ){ self.open(); }\n\n\t\t}else{\n\t\t\tself.clearActiveOption();\n\t\t\tif( triggerDropdown && self.isOpen ){\n\t\t\t\tself.close(false); // if create_option=null, we wan't the dropdown to close but not reset the textbox value\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Return list of selectable options\n\t *\n\t */\n\tselectable():NodeList{\n\t\treturn this.dropdown_content.querySelectorAll('[data-selectable]');\n\t}\n\n\n\n\t/**\n\t * Adds an available option. If it already exists,\n\t * nothing will happen. Note: this does not refresh\n\t * the options list dropdown (use `refreshOptions`\n\t * for that).\n\t *\n\t * Usage:\n\t *\n\t *   this.addOption(data)\n\t *\n\t */\n\taddOption(data:TomOption|TomOption[]):void {\n\t\tvar value, self = this;\n\n\t\tif (Array.isArray(data)) {\n\t\t\tfor( const dat of data ){\n\t\t\t\tself.addOption(dat);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (value = self.registerOption(data)) {\n\t\t\tself.userOptions[value] = true;\n\t\t\tself.lastQuery = null;\n\t\t\tself.trigger('option_add', value, data);\n\t\t}\n\t}\n\n\t/**\n\t * Registers an option to the pool of options.\n\t *\n\t */\n\tregisterOption(data:TomOption):false|string {\n\t\tvar key = hash_key(data[this.settings.valueField]);\n\t\tif ( key === null || this.options.hasOwnProperty(key)) return false;\n\n\t\tdata.$order\t\t\t= data.$order || ++this.order;\n\t\tdata.$id\t\t\t= this.inputId + '-opt-' + (this.options_i++);\n\t\tthis.options[key]\t= data;\n\t\treturn key;\n\t}\n\n\t/**\n\t * Registers an option group to the pool of option groups.\n\t *\n\t * @return {boolean|string}\n\t */\n\tregisterOptionGroup(data:TomOption) {\n\t\tvar key = hash_key(data[this.settings.optgroupValueField]);\n\n\t\tif ( key === null ) return false;\n\n\t\tdata.$order = data.$order || ++this.order;\n\t\tthis.optgroups[key] = data;\n\t\treturn key;\n\t}\n\n\t/**\n\t * Registers a new optgroup for options\n\t * to be bucketed into.\n\t *\n\t */\n\taddOptionGroup(id:string, data:TomOption) {\n\t\tvar hashed_id;\n\t\tdata[this.settings.optgroupValueField] = id;\n\n\t\tif( hashed_id = this.registerOptionGroup(data) ){\n\t\t\tthis.trigger('optgroup_add', hashed_id, data);\n\t\t}\n\t}\n\n\t/**\n\t * Removes an existing option group.\n\t *\n\t */\n\tremoveOptionGroup(id:string) {\n\t\tif (this.optgroups.hasOwnProperty(id)) {\n\t\t\tdelete this.optgroups[id];\n\t\t\tthis.clearCache();\n\t\t\tthis.trigger('optgroup_remove', id);\n\t\t}\n\t}\n\n\t/**\n\t * Clears all existing option groups.\n\t */\n\tclearOptionGroups() {\n\t\tthis.optgroups = {};\n\t\tthis.clearCache();\n\t\tthis.trigger('optgroup_clear');\n\t}\n\n\t/**\n\t * Updates an option available for selection. If\n\t * it is visible in the selected items or options\n\t * dropdown, it will be re-rendered automatically.\n\t *\n\t */\n\tupdateOption(value:string, data:TomOption) {\n\t\tvar self = this;\n\t\tvar item, item_new;\n\t\tvar value_new, index_item, cache_items, cache_options, order_old;\n\n\t\tvalue     = hash_key(value);\n\t\tvalue_new = hash_key(data[self.settings.valueField]);\n\n\t\t// sanity checks\n\t\tif (value === null) return;\n\t\tif (!self.options.hasOwnProperty(value)) return;\n\t\tif (typeof value_new !== 'string') throw new Error('Value must be set in option data');\n\n\t\torder_old = self.options[value].$order;\n\n\t\t// update references\n\t\tif (value_new !== value) {\n\t\t\tdelete self.options[value];\n\t\t\tindex_item = self.items.indexOf(value);\n\t\t\tif (index_item !== -1) {\n\t\t\t\tself.items.splice(index_item, 1, value_new);\n\t\t\t}\n\t\t}\n\t\tdata.$order = data.$order || order_old;\n\t\tself.options[value_new] = data;\n\n\t\t// invalidate render cache\n\t\tcache_items = self.renderCache['item'];\n\t\tcache_options = self.renderCache['option'];\n\n\t\tif (cache_items) {\n\t\t\tdelete cache_items[value];\n\t\t\tdelete cache_items[value_new];\n\t\t}\n\t\tif (cache_options) {\n\t\t\tdelete cache_options[value];\n\t\t\tdelete cache_options[value_new];\n\t\t}\n\n\t\t// update the item if it's selected\n\t\tif (self.items.indexOf(value_new) !== -1) {\n\t\t\titem\t\t= self.getItem(value);\n\t\t\titem_new\t= self.render('item', data);\n\n\t\t\tif( item.classList.contains('active') ) addClasses(item_new,'active');\n\n\t\t\titem.parentNode.insertBefore(item_new, item);\n\t\t\titem.remove();\n\t\t}\n\n\t\t// invalidate last query because we might have updated the sortField\n\t\tself.lastQuery = null;\n\n\t\t// update dropdown contents\n\t\tif (self.isOpen) {\n\t\t\tself.refreshOptions(false);\n\t\t}\n\t}\n\n\t/**\n\t * Removes a single option.\n\t *\n\t */\n\tremoveOption(value:string, silent?:boolean):void {\n\t\tvar self = this;\n\t\tvalue = hash_key(value);\n\n\t\tvar cache_items = self.renderCache['item'];\n\t\tvar cache_options = self.renderCache['option'];\n\t\tif (cache_items) delete cache_items[value];\n\t\tif (cache_options) delete cache_options[value];\n\n\t\tdelete self.userOptions[value];\n\t\tdelete self.options[value];\n\t\tself.lastQuery = null;\n\t\tself.trigger('option_remove', value);\n\t\tself.removeItem(value, silent);\n\t}\n\n\t/**\n\t * Clears all options.\n\t */\n\tclearOptions() {\n\n\t\tthis.loadedSearches\t\t= {};\n\t\tthis.userOptions\t\t= {};\n\t\tthis.clearCache();\n\t\tvar selected:TomOptions\t= {};\n\t\tfor( let key in this.options){\n    \t\tif( this.options.hasOwnProperty(key) && this.items.indexOf(key) >= 0 ){\n\t\t\t\tselected[key] = this.options[key];\n\t\t\t}\n\t\t}\n\n\t\tthis.options = this.sifter.items = selected;\n\t\tthis.lastQuery = null;\n\t\tthis.trigger('option_clear');\n\t}\n\n\t/**\n\t * Returns the dom element of the option\n\t * matching the given value.\n\t *\n\t * @returns {object}\n\t */\n\tgetOption(value:string):HTMLElement {\n\n\t\t// cached ?\n\t\tif( this.renderCache['option'].hasOwnProperty(value) ){\n\t\t\treturn this.renderCache['option'][value];\n\t\t}\n\n\t\t// from existing dropdown menu dom\n\t\treturn this.getElementWithValue(value, this.selectable());\n\t}\n\n\t/**\n\t * Returns the dom element of the next or previous dom element of the same type\n\t * Note: adjacent options may not be adjacent DOM elements (optgroups)\n\t *\n\t */\n\tgetAdjacent( option:HTMLElement, direction:number, type:string = 'option' ) : HTMLElement|void{\n\t\tvar self = this, all;\n\n\t\tif( !option ){\n\t\t\treturn;\n\t\t}\n\n\t\tif( type == 'item' ){\n\t\t\tall\t\t\t= self.controlChildren();\n\t\t}else{\n\t\t\tall\t\t\t= self.dropdown_content.querySelectorAll('[data-selectable]');\n\t\t}\n\n\t\tfor( let i = 0; i < all.length; i++ ){\n\t\t\tif( all[i] != option ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif( direction > 0 ){\n\t\t\t\treturn all[i+1] as HTMLElement;\n\t\t\t}\n\n\t\t\treturn all[i-1] as HTMLElement;\n\t\t}\n\t}\n\n\t/**\n\t * Finds the first element with a \"data-value\" attribute\n\t * that matches the given value.\n\t *\n\t */\n\tgetElementWithValue(value:string, els:HTMLCollection|NodeList|HTMLElement[]):HTMLElement {\n\t\tvalue = hash_key(value);\n\n\t\tif (value !== null) {\n\t\t\tfor( const node of els ){\n\t\t\t\tlet el = node as HTMLElement;\n\t\t\t\tif (el.getAttribute('data-value') === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns the dom element of the item\n\t * matching the given value.\n\t *\n\t */\n\tgetItem(value:string):HTMLElement {\n\t\treturn this.getElementWithValue(value, this.control.children);\n\t}\n\n\t/**\n\t * \"Selects\" multiple items at once. Adds them to the list\n\t * at the current caret position.\n\t *\n\t */\n\taddItems( values:string|string[], silent?:boolean ):void{\n\t\tvar self = this;\n\t\tself.buffer = document.createDocumentFragment();\n\n\t\tfor( const child of self.control.children ){\n\t\t\tself.buffer.appendChild(child);\n\t\t}\n\n\t\tvar items = Array.isArray(values) ? values : [values];\n\t\titems = items.filter(x => self.items.indexOf(x) === -1);\n\t\tfor (let i = 0, n = items.length; i < n; i++) {\n\t\t\tself.isPending = (i < n - 1);\n\t\t\tself.addItem(items[i], silent);\n\t\t}\n\n\t\tvar control = self.control;\n\t\tcontrol.insertBefore(self.buffer, control.firstChild);\n\n\t\tself.buffer = null;\n\t}\n\n\t/**\n\t * \"Selects\" an item. Adds it to the list\n\t * at the current caret position.\n\t *\n\t */\n\taddItem( value:string, silent?:boolean ):void{\n\t\tvar events = silent ? [] : ['change'];\n\n\t\tdebounce_events(this, events, () => {\n\t\t\tvar item;\n\t\t\tvar self = this;\n\t\t\tvar inputMode = self.settings.mode;\n\t\t\tvar wasFull;\n\t\t\tvalue = hash_key(value);\n\n\t\t\tif( self.items.indexOf(value) !== -1 ){\n\n\t\t\t\tif( inputMode === 'single' ){\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\n\t\t\t\tif( inputMode === 'single' || !self.settings.duplicates ){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.options.hasOwnProperty(value)) return;\n\t\t\tif (inputMode === 'single') self.clear(silent);\n\t\t\tif (inputMode === 'multi' && self.isFull()) return;\n\n\t\t\titem = self.render('item', self.options[value]);\n\n\t\t\tif( self.control.contains(item) ){ // duplicates\n\t\t\t\titem = item.cloneNode(true) as HTMLElement;\n\t\t\t}\n\n\t\t\twasFull = self.isFull();\n\t\t\tself.items.splice(self.caretPos, 0, value);\n\t\t\tself.insertAtCaret(item);\n\n\t\t\tif (self.isSetup) {\n\t\t\t\tlet options = self.selectable();\n\n\t\t\t\t// update menu / remove the option (if this is not one item being added as part of series)\n\t\t\t\tif (!self.isPending) {\n\t\t\t\t\tlet option = self.getOption(value);\n\t\t\t\t\tlet next = self.getAdjacent(option, 1);\n\t\t\t\t\tself.refreshOptions(self.isFocused && inputMode !== 'single');\n\t\t\t\t\tif( next ){\n\t\t\t\t\t\tself.setActiveOption(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// hide the menu if the maximum number of items have been selected or no options are left\n\t\t\t\tif ( !options.length || self.isFull()) {\n\t\t\t\t\tself.close();\n\t\t\t\t} else if (!self.isPending) {\n\t\t\t\t\tself.positionDropdown();\n\t\t\t\t}\n\n\t\t\t\tself.trigger('item_add', value, item);\n\n\t\t\t\tif (!self.isPending) {\n\t\t\t\t\tself.updateOriginalInput({silent: silent});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.isPending || (!wasFull && self.isFull())) {\n\t\t\t\tself.refreshState();\n\t\t\t}\n\n\t\t});\n\t}\n\n\t/**\n\t * Removes the selected item matching\n\t * the provided value.\n\t *\n\t */\n\tremoveItem( value:string, silent?:boolean ){\n\t\tvar i, idx, self = this;\n\n\t\tvar item\t= self.getItem(value);\n\n\t\tif( !item ) return;\n\n\t\tvalue\t\t= hash_key(item.dataset.value);\n\t\ti\t\t\t= self.items.indexOf(value);\n\n\t\tif (i !== -1) {\n\t\t\titem.remove();\n\t\t\tif( item.classList.contains('active') ){\n\t\t\t\tidx = self.activeItems.indexOf(item);\n\t\t\t\tself.activeItems.splice(idx, 1);\n\t\t\t\tremoveClasses(item,'active');\n\t\t\t}\n\n\t\t\tself.items.splice(i, 1);\n\t\t\tself.lastQuery = null;\n\t\t\tif (!self.settings.persist && self.userOptions.hasOwnProperty(value)) {\n\t\t\t\tself.removeOption(value, silent);\n\t\t\t}\n\n\t\t\tif (i < self.caretPos) {\n\t\t\t\tself.setCaret(self.caretPos - 1);\n\t\t\t}\n\n\t\t\tself.updateOriginalInput({silent: silent});\n\t\t\tself.refreshState();\n\t\t\tself.positionDropdown();\n\t\t\tself.trigger('item_remove', value, item);\n\t\t}\n\t}\n\n\t/**\n\t * Invokes the `create` method provided in the\n\t * TomSelect options that should provide the data\n\t * for the new item, given the user input.\n\t *\n\t * Once this completes, it will be added\n\t * to the item list.\n\t *\n\t */\n\tcreateItem( input?:string, triggerDropdown:boolean=true, callback?:TomCreateCallback ):boolean{\n\t\tvar self  = this;\n\t\tvar caret = self.caretPos;\n\t\tvar output;\n\t\tinput = input || self.inputValue();\n\n\t\tif (typeof callback !== 'function') callback = () => {};\n\n\t\tif (!self.canCreate(input)) {\n\t\t\tcallback();\n\t\t\treturn false;\n\t\t}\n\n\t\tself.lock();\n\n\t\tvar created = false;\n\t\tvar create = (data:TomOption) => {\n\t\t\tself.unlock();\n\n\t\t\tif (!data || typeof data !== 'object') return callback();\n\t\t\tvar value = hash_key(data[self.settings.valueField]);\n\t\t\tif( typeof value !== 'string' ){\n\t\t\t\treturn callback();\n\t\t\t}\n\n\t\t\tself.setTextboxValue();\n\t\t\tself.addOption(data);\n\t\t\tself.setCaret(caret);\n\t\t\tself.addItem(value);\n\t\t\tself.refreshOptions(triggerDropdown && self.settings.mode !== 'single');\n\t\t\tcallback(data);\n\t\t\tcreated = true;\n\t\t};\n\n\t\tif( typeof self.settings.create === 'function' ){\n\t\t\toutput = self.settings.create.call(this, input, create);\n\t\t}else{\n\t\t\toutput = {\n\t\t\t\t[self.settings.labelField]: input,\n\t\t\t\t[self.settings.valueField]: input,\n\t\t\t};\n\t\t}\n\n\t\tif( !created ){\n\t\t\tcreate(output);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Re-renders the selected item lists.\n\t */\n\trefreshItems() {\n\t\tvar self = this;\n\t\tself.lastQuery = null;\n\n\t\tif (self.isSetup) {\n\t\t\tself.addItems(self.items);\n\t\t}\n\n\t\tself.updateOriginalInput();\n\t\tself.refreshState();\n\t}\n\n\t/**\n\t * Updates all state-dependent attributes\n\t * and CSS classes.\n\t */\n\trefreshState() {\n\t\tvar self     = this;\n\n\t\tself.refreshValidityState();\n\n\t\tvar isFull   = self.isFull();\n\n\t\tvar isLocked = self.isLocked;\n\n\t\tself.wrapper.classList.toggle('rtl',self.rtl);\n\n\t\tvar classList = self.control.classList;\n\n\t\tclassList.toggle('focus', self.isFocused)\n\t\tclassList.toggle('disabled', self.isDisabled)\n\t\tclassList.toggle('required', self.isRequired)\n\t\tclassList.toggle('invalid', self.isInvalid)\n\t\tclassList.toggle('locked', isLocked)\n\t\tclassList.toggle('full', isFull)\n\t\tclassList.toggle('not-full', !isFull)\n\t\tclassList.toggle('input-active', self.isFocused && !self.isInputHidden)\n\t\tclassList.toggle('dropdown-active', self.isOpen)\n\t\tclassList.toggle('has-options', isEmptyObject(self.options) )\n\t\tclassList.toggle('has-items', self.items.length > 0);\n\n\t}\n\n\n\t/**\n\t * Update the `required` attribute of both input and control input.\n\t *\n\t * The `required` property needs to be activated on the control input\n\t * for the error to be displayed at the right place. `required` also\n\t * needs to be temporarily deactivated on the input since the input is\n\t * hidden and can't show errors.\n\t */\n\trefreshValidityState() {\n\t\tvar self = this;\n\n\t\tif( !self.input.checkValidity ){\n\t\t\treturn;\n\t\t}\n\n\t\t// if required, make sure the input required attribute = true so checkValidity() will work\n\t\tif( this.isRequired ){\n\t\t\tself.input.required = true;\n\t\t}\n\n\t\tvar invalid = !self.input.checkValidity();\n\n\t\tself.isInvalid = invalid;\n\t\tself.control_input.required = invalid;\n\n\t\tif( this.isRequired ){\n\t\t\tself.input.required = !invalid;\n\t\t}\n\t}\n\n\t/**\n\t * Determines whether or not more items can be added\n\t * to the control without exceeding the user-defined maximum.\n\t *\n\t * @returns {boolean}\n\t */\n\tisFull() {\n\t\treturn this.settings.maxItems !== null && this.items.length >= this.settings.maxItems;\n\t}\n\n\t/**\n\t * Refreshes the original <select> or <input>\n\t * element to reflect the current state.\n\t *\n\t */\n\tupdateOriginalInput( opts:TomArgObject = {} ){\n\t\tvar i, value, option, self = this;\n\n\t\tif( self.is_select_tag ){\n\n\t\t\t// remove selected attribute from options whose values are not in self.items\n\t\t\tself.input.querySelectorAll('option[selected]').forEach((option:HTMLOptionElement) => {\n\t\t\t\tif( self.items.indexOf(option.value) == -1 ){\n\t\t\t\t\toption.selected = false;\n\t\t\t\t\toption.removeAttribute('selected');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// order selected <option> tags for values in self.items\n\t\t\tfor( i = self.items.length - 1; i >= 0; i-- ){\n\t\t\t\tvalue = self.items[i];\n\n\t\t\t\tvar option = self.options[value].$option;\n\t\t\t\tif( !option ){\n\t\t\t\t\tconst label = self.options[value][self.settings.labelField] || '';\n\t\t\t\t\toption = getDom('<option value=\"' + escape_html(value) + '\">' + escape_html(label) + '</option>');\n\t\t\t\t\tself.options[value].$option = option;\n\t\t\t\t}\n\n\t\t\t\toption.selected = true;\n\t\t\t\tsetAttr(option,{selected:'true'});\n\t\t\t\tself.input.prepend(option);\n\t\t\t}\n\n\t\t} else {\n\t\t\tself.input.value = self.getValue() as string;\n\t\t}\n\n\t\tif (self.isSetup) {\n\t\t\tif (!opts.silent) {\n\t\t\t\tself.trigger('change', self.getValue() );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Shows the autocomplete dropdown containing\n\t * the available options.\n\t */\n\topen() {\n\t\tvar self = this;\n\n\t\tif (self.isLocked || self.isOpen || (self.settings.mode === 'multi' && self.isFull())) return;\n\t\tself.isOpen = true;\n\t\tsetAttr(self.control_input,{'aria-expanded': 'true'});\n\t\tself.refreshState();\n\t\tapplyCSS(self.dropdown,{visibility: 'hidden', display: 'block'});\n\t\tself.positionDropdown();\n\t\tapplyCSS(self.dropdown,{visibility: 'visible', display: 'block'});\n\t\tself.focus();\n\t\tself.trigger('dropdown_open', self.dropdown);\n\t}\n\n\t/**\n\t * Closes the autocomplete dropdown menu.\n\t */\n\tclose(setTextboxValue=true) {\n\t\tvar self = this;\n\t\tvar trigger = self.isOpen;\n\n\t\t// before blur() to prevent form onchange event\n\t\tif( setTextboxValue ) self.setTextboxValue();\n\n\t\tif (self.settings.mode === 'single' && self.items.length) {\n\t\t\tself.hideInput();\n\n\t\t\t// Do not trigger blur while inside a blur event,\n\t\t\t// this fixes some weird tabbing behavior in FF and IE.\n\t\t\t// See #selectize.js#1164\n\t\t\tif( !self.tab_key ){\n\t\t\t\tself.blur(); // close keyboard on iOS\n\t\t\t}\n\t\t}\n\n\t\tself.isOpen = false;\n\t\tsetAttr(self.control_input,{'aria-expanded': 'false'});\n\t\tapplyCSS(self.dropdown,{display: 'none'});\n\t\tself.clearActiveOption();\n\t\tself.refreshState();\n\n\t\tif (trigger) self.trigger('dropdown_close', self.dropdown);\n\t}\n\n\t/**\n\t * Calculates and applies the appropriate\n\t * position of the dropdown if dropdownParent = 'body'.\n\t * Otherwise, position is determined by css\n\t */\n\tpositionDropdown(){\n\n\t\tif( this.settings.dropdownParent !== 'body' ){\n\t\t\treturn;\n\t\t}\n\n\t\tvar context\t\t\t= this.control;\n\t\tvar rect\t\t\t= context.getBoundingClientRect();\n\t\tvar top\t\t\t\t= context.offsetHeight + rect.top  + window.scrollY;\n\t\tvar left\t\t\t= rect.left + window.scrollX;\n\n\n\t\tapplyCSS(this.dropdown,{\n\t\t\twidth : rect.width + 'px',\n\t\t\ttop   : top + 'px',\n\t\t\tleft  : left + 'px'\n\t\t});\n\n\t}\n\n\t/**\n\t * Resets / clears all selected items\n\t * from the control.\n\t *\n\t */\n\tclear(silent:boolean) {\n\t\tvar self = this;\n\n\t\tif (!self.items.length) return;\n\n\t\tvar items = self.controlChildren();\n\t\tfor( const item of items ){\n\t\t\titem.remove();\n\t\t}\n\n\t\tself.items = [];\n\t\tself.lastQuery = null;\n\t\tself.setCaret(0);\n\t\tself.setActiveItem();\n\t\tself.updateOriginalInput({silent: silent});\n\t\tself.refreshState();\n\t\tself.showInput();\n\t\tself.trigger('clear');\n\t}\n\n\t/**\n\t * A helper method for inserting an element\n\t * at the current caret position.\n\t *\n\t */\n\tinsertAtCaret(el:HTMLElement) {\n\t\tvar self = this;\n\t\tvar caret\t= Math.min(self.caretPos, self.items.length);\n\t\tvar target\t= self.buffer || self.control;\n\n\t\tif (caret === 0) {\n\t\t\ttarget.insertBefore(el, target.firstChild);\n\t\t} else {\n\t\t\ttarget.insertBefore(el, target.children[caret]);\n\t\t}\n\n\t\tself.setCaret(caret + 1);\n\t}\n\n\t/**\n\t * Removes the current selected item(s).\n\t *\n\t */\n\tdeleteSelection(e:KeyboardEvent):boolean {\n\t\tvar direction, selection, values, caret, tail;\n\t\tvar self = this;\n\n\t\tdirection = (e && e.keyCode === constants.KEY_BACKSPACE) ? -1 : 1;\n\t\tselection = getSelection(self.control_input);\n\n\n\t\t// determine items that will be removed\n\t\tvalues = [];\n\n\t\tif (self.activeItems.length) {\n\n\t\t\ttail = getTail(self.activeItems, direction);\n\t\t\tcaret = nodeIndex(tail);\n\n\t\t\tif (direction > 0) { caret++; }\n\n\t\t\tfor( const item of self.activeItems ){\n\t\t\t\tvalues.push( item.dataset.value );\n\t\t\t}\n\n\t\t} else if ((self.isFocused || self.settings.mode === 'single') && self.items.length) {\n\t\t\tif (direction < 0 && selection.start === 0 && selection.length === 0) {\n\t\t\t\tvalues.push(self.items[self.caretPos - 1]);\n\t\t\t} else if (direction > 0 && selection.start === self.inputValue().length) {\n\t\t\t\tvalues.push(self.items[self.caretPos]);\n\t\t\t}\n\t\t}\n\n\t\t// allow the callback to abort\n\t\tif (!values.length || (typeof self.settings.onDelete === 'function' && self.settings.onDelete.call(self,values,e) === false)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tpreventDefault(e,true);\n\n\t\t// perform removal\n\t\tif (typeof caret !== 'undefined') {\n\t\t\tself.setCaret(caret);\n\t\t}\n\t\twhile (values.length) {\n\t\t\tself.removeItem(values.pop());\n\t\t}\n\n\t\tself.showInput();\n\t\tself.positionDropdown();\n\t\tself.refreshOptions(false);\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Selects the previous / next item (depending on the `direction` argument).\n\t *\n\t * > 0 - right\n\t * < 0 - left\n\t *\n\t */\n\tadvanceSelection(direction:number, e?:MouseEvent|KeyboardEvent) {\n\t\tvar idx, last_active, adjacent, self = this;\n\n\t\tif (self.rtl) direction *= -1;\n\t\tif( self.inputValue().length ) return;\n\n\n\t\t// add or remove to active items\n\t\tif( isKeyDown(constants.KEY_SHORTCUT,e) || isKeyDown('shiftKey',e) ){\n\n\t\t\tlast_active\t\t\t= self.getLastActive(direction);\n\t\t\tif( last_active ){\n\n\t\t\t\tif( !last_active.classList.contains('active') ){\n\t\t\t\t\tadjacent\t\t\t= last_active;\n\t\t\t\t}else{\n\t\t\t\t\tadjacent\t\t\t= self.getAdjacent(last_active,direction,'item');\n\t\t\t\t}\n\n\t\t\t// if no active item, get items adjacent to the control input\n\t\t\t}else if( direction > 0 ){\n\t\t\t\tadjacent\t\t\t= self.control_input.nextElementSibling;\n\t\t\t}else{\n\t\t\t\tadjacent\t\t\t= self.control_input.previousElementSibling;\n\t\t\t}\n\n\n\t\t\tif( adjacent ){\n\t\t\t\tif( adjacent.classList.contains('active') ){\n\t\t\t\t\tself.removeActiveItem(last_active);\n\t\t\t\t}\n\t\t\t\tself.setActiveItemClass(adjacent); // mark as last_active !! after removeActiveItem() on last_active\n\t\t\t}\n\n\t\t// move caret to the left or right\n\t\t}else if( self.isFocused && !self.activeItems.length ){\n\n\t\t\tself.setCaret(self.caretPos + direction);\n\n\t\t// move caret before or after selected items\n\t\t}else{\n\n\t\t\tlast_active\t\t= self.getLastActive(direction);\n\t\t\tif( last_active ){\n\t\t\t\tidx = nodeIndex(last_active);\n\t\t\t\tself.setCaret(direction > 0 ? idx + 1: idx);\n\t\t\t\tself.setActiveItem();\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * Get the last active item\n\t *\n\t */\n\tgetLastActive(direction?:number){\n\n\t\tlet last_active = this.control.querySelector('.last-active');\n\t\tif( last_active ){\n\t\t\treturn last_active;\n\t\t}\n\n\n\t\tvar result = this.control.querySelectorAll('.active');\n\t\tif( result ){\n\t\t\treturn getTail(result,direction);\n\t\t}\n\t}\n\n\n\t/**\n\t * Moves the caret to the specified index.\n\t *\n\t * The input must be moved by leaving it in place and moving the\n\t * siblings, due to the fact that focus cannot be restored once lost\n\t * on mobile webkit devices\n\t *\n\t */\n\tsetCaret(new_pos:number) {\n\t\tvar self = this;\n\n\t\tif( self.settings.mode === 'single' || self.settings.controlInput ) {\n\t\t\tnew_pos = self.items.length;\n\t\t} else {\n\t\t\tnew_pos = Math.max(0, Math.min(self.items.length, new_pos));\n\n\t\t\tif( new_pos != self.caretPos && !self.isPending ){\n\n\t\t\t\tself.controlChildren().forEach((child,j) => {\n\t\t\t\t\tif( j < new_pos ){\n\t\t\t\t\t\tself.control_input.insertAdjacentElement('beforebegin', child );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.control.appendChild( child );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tself.caretPos = new_pos;\n\t}\n\n\t/**\n\t * Return list of item dom elements\n\t *\n\t */\n\tcontrolChildren():HTMLElement[]{\n\t\treturn Array.from( this.control.getElementsByClassName(this.settings.itemClass) ) as HTMLElement[];\n\t}\n\n\t/**\n\t * Disables user input on the control. Used while\n\t * items are being asynchronously created.\n\t */\n\tlock() {\n\t\tthis.close();\n\t\tthis.isLocked = true;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Re-enables user input on the control.\n\t */\n\tunlock() {\n\t\tthis.isLocked = false;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Disables user input on the control completely.\n\t * While disabled, it cannot receive focus.\n\t */\n\tdisable() {\n\t\tvar self = this;\n\t\tself.input.disabled\t\t\t\t= true;\n\t\tself.control_input.disabled\t\t= true;\n\t\tself.control_input.tabIndex\t\t= -1;\n\t\tself.isDisabled\t\t\t\t\t= true;\n\t\tself.lock();\n\t}\n\n\t/**\n\t * Enables the control so that it can respond\n\t * to focus and user input.\n\t */\n\tenable() {\n\t\tvar self = this;\n\t\tself.input.disabled\t\t\t\t= false;\n\t\tself.control_input.disabled\t\t= false;\n\t\tself.control_input.tabIndex\t\t= self.tabIndex;\n\t\tself.isDisabled\t\t\t\t\t= false;\n\t\tself.unlock();\n\t}\n\n\t/**\n\t * Completely destroys the control and\n\t * unbinds all event listeners so that it can\n\t * be garbage collected.\n\t */\n\tdestroy() {\n\t\tvar self = this;\n\t\tvar revertSettings = self.revertSettings;\n\n\t\tself.trigger('destroy');\n\t\tself.off();\n\t\tself.wrapper.remove();\n\t\tself.dropdown.remove();\n\n\t\tself.input.innerHTML = revertSettings.innerHTML;\n\t\tself.input.tabIndex = revertSettings.tabIndex;\n\n\t\tremoveClasses(self.input,'tomselected');\n\t\tself.input.removeAttribute('hidden');\n\t\tself.input.required = this.isRequired;\n\n\t\tself._destroy();\n\n\t\tdelete self.input.tomselect;\n\t}\n\n\t/**\n\t * A helper method for rendering \"item\" and\n\t * \"option\" templates, given the data.\n\t *\n\t */\n\trender( templateName:string, data?:any ):null|HTMLElement{\n\t\tvar value, id, html;\n\t\tvar self = this;\n\n\t\tif (templateName === 'option' || templateName === 'item') {\n\t\t\tvalue = hash_key(data[self.settings.valueField]);\n\n\t\t\t// pull markup from cache if it exists\n\t\t\tif( self.renderCache[templateName].hasOwnProperty(value) ){\n\t\t\t\treturn self.renderCache[templateName][value];\n\t\t\t}\n\n\t\t}\n\n\t\tvar template = self.settings.render[templateName];\n\t\tif( typeof template !== 'function' ){\n\t\t\treturn null;\n\t\t}\n\n\t\t// render markup\n\t\thtml = template.call(this, data, escape_html);\n\n\t\tif( !html ){\n\t\t\treturn html;\n\t\t}\n\n\t\thtml = getDom( html );\n\n\t\t// add mandatory attributes\n\t\tif (templateName === 'option' || templateName === 'option_create') {\n\n\t\t\tif( data[self.settings.disabledField] ){\n\t\t\t\tsetAttr(html,{'aria-disabled':'true'});\n\t\t\t}else{\n\t\t\t\tsetAttr(html,{'data-selectable': ''});\n\t\t\t}\n\n\t\t}else if (templateName === 'optgroup') {\n\t\t\tid = data.group[self.settings.optgroupValueField];\n\t\t\tsetAttr(html,{'data-group': id});\n\t\t\tif(data.group[self.settings.disabledField]) {\n\t\t\t\tsetAttr(html,{'data-disabled': ''});\n\t\t\t}\n\t\t}\n\n\t\tif (templateName === 'option' || templateName === 'item') {\n\t\t\tsetAttr(html,{'data-value': value });\n\n\n\t\t\t// make sure we have some classes if a template is overwritten\n\t\t\tif( templateName === 'item' ){\n\t\t\t\taddClasses(html,self.settings.itemClass);\n\t\t\t}else{\n\t\t\t\taddClasses(html,self.settings.optionClass);\n\t\t\t\tsetAttr(html,{\n\t\t\t\t\trole:'option',\n\t\t\t\t\tid:data.$id\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// update cache\n\t\t\tself.renderCache[templateName][value] = html;\n\n\t\t}\n\n\t\treturn html;\n\t}\n\n\t/**\n\t * Clears the render cache for a template. If\n\t * no template is given, clears all render\n\t * caches.\n\t *\n\t */\n\tclearCache( templateName?:'item'|'option' ){\n\t\tvar self = this;\n\n\t\tif (templateName === void 0) {\n\t\t\tself.renderCache = {'item':{},'option':{}};\n\t\t} else {\n\t\t\tself.renderCache[templateName] = {};\n\t\t}\n\t}\n\n\t/**\n\t * Determines whether or not to display the\n\t * create item prompt, given a user input.\n\t *\n\t */\n\tcanCreate( input:string ):boolean {\n\t\treturn this.settings.create && input.length && (this.settings.createFilter as TomCreateFilter ).call(this, input);\n\t}\n\n\n\t/**\n\t * Wraps this.`method` so that `new_fn` can be invoked 'before', 'after', or 'instead' of the original method\n\t *\n\t * this.hook('instead','onKeyDown',function( arg1, arg2 ...){\n\t *\n\t * });\n\t */\n\thook( when:string, method:string, new_fn:()=>any ){\n\t\tvar self = this;\n\t\tvar orig_method = self[method];\n\n\n\t\tself[method] = function(){\n\t\t\tvar result, result_new;\n\n\t\t\tif( when === 'after' ){\n\t\t\t\tresult = orig_method.apply(self, arguments);\n\t\t\t}\n\n\t\t\tresult_new = new_fn.apply(self, arguments );\n\n\t\t\tif( when === 'instead' ){\n\t\t\t\treturn result_new;\n\t\t\t}\n\n\t\t\tif( when === 'before' ){\n\t\t\t\tresult = orig_method.apply(self, arguments);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\n\t}\n\n};\n"],"names":["instance_i","TomSelect","MicroPlugin","MicroEvent","constructor","input_arg","settings","control_input","wrapper","dropdown","control","dropdown_content","order","input","tabIndex","is_select_tag","rtl","inputId","_destroy","sifter","tab_key","isOpen","isDisabled","isRequired","isInvalid","isLocked","isFocused","isInputHidden","isSetup","ignoreFocus","ignoreBlur","hasOptions","currentResults","lastValue","caretPos","loading","loadedSearches","activeOption","activeItems","optgroups","options","options_i","userOptions","items","renderCache","dir","getDom","tomselect","Error","computedStyle","window","getComputedStyle","getPropertyValue","getSettings","tagName","toLowerCase","test","getId","required","Sifter","diacritics","setupOptions","mode","maxItems","hideSelected","hidePlaceholder","filter","createFilter","RegExp","initializePlugins","plugins","setupCallbacks","setupTemplates","setup","self","inputMode","classes","classes_plugins","control_id","passive_event","passive","listboxId","getAttribute","addClasses","wrapperClass","inputClass","append","render","dropdownClass","dropdownContentClass","dropdownParent","appendChild","controlInput","attrs","attr","setAttr","disabled","role","haspopup","query","escapeQuery","label","document","querySelector","for","label_id","copyClassesToDropdown","style","width","names","length","join","multiple","placeholder","splitOn","delimiter","delimiterEscaped","replace","load","loadThrottle","loadDebounce","type","addEvent","e","target_match","parentMatch","target","onOptionHover","capture","evt","clearActiveItems","stopPropagation","inputState","itemClass","onItemSelect","onMouseDown","onClick","onKeyDown","onKeyUp","onKeyPress","positionDropdown","onBlur","onFocus","onPaste","doc_mousedown","option","contains","blur","preventDefault","onOptionSelect","win_scroll","removeEventListener","revertSettings","innerHTML","hidden","insertAdjacentElement","setValue","refreshState","updateOriginalInput","refreshItems","disable","on","onChange","trigger","preload","registerOption","optgroup","registerOptionGroup","field_label","labelField","field_optgroup","optgroupLabelField","templates","data","escape","createElement","className","Object","assign","key","fn","callbacks","focus","setActiveItem","open","setTimeout","triggerEvent","isFull","pastedText","inputValue","match","splitInput","trim","split","piece","createItem","character","String","fromCharCode","keyCode","which","create","constants","isKeyDown","selectAll","close","next","getAdjacent","setActiveOption","prev","advanceSelection","selectOnTab","deleteSelection","value","shouldLoad","call","refreshOptions","wasFocused","showInput","openOnFocus","activeElement","deactivate","setCaret","createOnBlur","parentElement","matches","classList","closeAfterSelect","dataset","lastQuery","addItem","getOption","item","hasOwnProperty","loadingClass","callback","loadCallback","bind","Math","max","clearActiveOption","removeClasses","onSearchChange","setTextboxValue","changed","getValue","hasAttribute","silent","events","debounce_events","clear","addItems","setMaxItems","eventName","i","begin","end","swap","last","getLastActive","Array","prototype","indexOf","children","setActiveItemClass","removeActiveItem","hideInput","last_active","push","idx","splice","height_menu","height_item","y","clientHeight","scrollTop","offsetHeight","getBoundingClientRect","top","removeAttribute","controlChildren","getScoreFunction","getSearchOptions","sort","sortField","field","fields","searchField","conjunction","searchConjunction","nesting","search","result","calculateScore","score","hash_key","id","triggerDropdown","j","k","n","groups_order","html","has_create_option","active","groups","results","active_before_hash","show_dropdown","shouldOpen","maxOptions","min","opt_value","valueField","option_el","toggle","includes","optgroupField","isArray","createDocumentFragment","cloneNode","lockOptgroupOrder","a","b","a_order","$order","b_order","group_options","group_html","group","highlight","removeHighlight","tokens","tok","regex","add_template","template","content","insertBefore","firstChild","canCreate","active_index","addPrecedence","selectable","querySelectorAll","addOption","dat","$id","optgroupValueField","addOptionGroup","hashed_id","removeOptionGroup","clearCache","clearOptionGroups","updateOption","item_new","value_new","index_item","cache_items","cache_options","order_old","getItem","parentNode","remove","removeOption","removeItem","clearOptions","selected","getElementWithValue","direction","all","els","node","el","values","buffer","child","x","isPending","wasFull","duplicates","insertAtCaret","persist","caret","output","lock","created","unlock","refreshValidityState","isEmptyObject","checkValidity","invalid","opts","forEach","$option","escape_html","prepend","applyCSS","visibility","display","context","rect","scrollY","left","scrollX","selection","tail","getSelection","getTail","nodeIndex","start","onDelete","pop","adjacent","nextElementSibling","previousElementSibling","new_pos","from","getElementsByClassName","enable","destroy","off","templateName","disabledField","optionClass","hook","when","method","new_fn","orig_method","result_new","apply","arguments"],"mappings":"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"}