{"version":3,"file":"remove_button.js","sources":["../../../src/vanilla.js","../../../src/utils.js","../../../src/plugins/remove_button/plugin.js"],"sourcesContent":["\n/**\n * Return a dom element from either a dom query string, jQuery object, a dom element or html string\n * https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n *\n * @param {mixed} query\n * @return {Element}\n */\nexport function getDom( query ){\n\n\tif( query.jquery ){\n\t\treturn query[0];\n\t}\n\n\tif( query instanceof HTMLElement ){\n\t\treturn query;\n\t}\n\n\tif( query.indexOf('<') > -1 ){\n\t\tlet div = document.createElement('div');\n\t\tdiv.innerHTML = query.trim(); // Never return a text node of whitespace as the result\n\t\treturn div.firstChild;\n\t}\n\n\treturn document.querySelector(query);\n};\n\n/**\n * Dispatch an event\n *\n */\nexport function triggerEvent( dom_el, event_name ){\n\tvar event = document.createEvent('HTMLEvents');\n\tevent.initEvent(event_name, true, false);\n\tdom_el.dispatchEvent(event)\n};\n\n/**\n * Apply CSS rules to a dom element\n *\n */\nexport function applyCSS( dom_el, css){\n\tObject.keys(css).forEach(function(name){\n\t\tdom_el.style[name] = css[name];\n\t});\n}\n\n\n/**\n * Add css classes\n *\n */\nexport function addClasses( elmts ){\n\n\tvar classes\t\t= classesArray.apply(null,arguments);\n\telmts\t\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tclasses.map( cls => {\n\t\t\tel.classList.add( cls );\n\t\t});\n\t});\n}\n\n/**\n * Remove css classes\n *\n */\n export function removeClasses( elmts ){\n\n \tvar classes \t= classesArray.apply(null,arguments);\n\telmts\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tclasses.map(cls => {\n\t \t\tel.classList.remove( cls );\n\t\t});\n \t});\n }\n\n\n/**\n * Return arguments\n *\n */\nexport function classesArray(){\n\tvar classes = [];\n\tfor( let i = 1; i < arguments.length; i++ ){\n\t\tlet _classes = arguments[i];\n\t\tif( typeof _classes === 'string' ){\n\t\t\t_classes = _classes.trim().split(/[\\11\\12\\14\\15\\40]/);\n\t\t}\n\t\tif( Array.isArray(_classes) ){\n\t\t\tclasses = classes.concat(_classes);\n\t\t}\n\t}\n\n\treturn classes.filter(Boolean);\n}\n\nexport function castAsArray(arg){\n\tif( !Array.isArray(arg) ){\n \t\targ = [arg];\n \t}\n\treturn arg;\n}\n\n/**\n * Delegate Event\n *\n */\nexport function onEvent( el, eventName, elementSelector, handler ){\n\n\tlet event_names\t= eventName.split(/\\s/);\n\n\t// create intermediate handler that can be used for all event names\n\t// loop parent nodes from the target to the delegation node\n\tlet _handler = function(e) {\n\t\tvar target_match = parentMatch(e.target, elementSelector, el);\n\t\tif( target_match ){\n\t\t\te.delegateTarget = target_match;\n\t\t\thandler.call(target_match, e);\n\t\t}\n\t};\n\n\tfor( let i = 0; i<event_names.length; i++){\n\t\tel.addEventListener(event_names[i], _handler, true);\n\t}\n\n};\n\n\n/**\n * Get the closest node to the evt.target matching the selector\n * Stops at wrapper\n *\n */\nexport function parentMatch(target, selector, wrapper ){\n\n\tif( wrapper && !wrapper.contains(target) ){\n\t\treturn;\n\t}\n\n\twhile( target && target.matches ){\n\n\t\tif( target.matches(selector) ){\n\t\t\treturn target;\n\t\t}\n\n\t\ttarget = target.parentNode;\n\t}\n}\n\n/**\n * Get the first or last item from a querySelectorAll result\n *\n * > 0 - right (last)\n * < 0 - left (first)\n *\n */\nexport function querySelectorEnd( el, query, direction){\n\tvar result = el.querySelectorAll(query);\n\tif( !result ){\n\t\treturn;\n\t}\n\n\treturn getTail(result,direction);\n};\n\n\n/**\n * Get the first or last item from an array\n *\n */\nexport function getTail( array, direction ){\n\n\tif( direction > 0 ){\n\t\treturn array[array.length-1];\n\t}\n\n\treturn array[0];\n}\n\n/**\n * Return true if an object is empty\n *\n */\nexport function isEmptyObject(obj){\n\treturn (Object.keys(obj).length === 0);\n}\n\n\n/**\n * Get the index of an element amongst sibling nodes of the same type\n *\n */\nexport function nodeIndex( el, amongst ){\n\tif (!el) return -1;\n\n\tamongst = amongst || el.nodeName;\n\n\tvar i = 0;\n\twhile( el = el.previousElementSibling ){\n\n\t\tif( el.matches(amongst) ){\n\t\t\ti++;\n\t\t}\n\t}\n\treturn i;\n}\n","/**\n * Determines if the provided value has been defined.\n *\n * @param {mixed} object\n * @returns {boolean}\n */\nexport function isset(object) {\n\treturn typeof object !== 'undefined';\n};\n\n/**\n * Converts a scalar to its best string representation\n * for hash keys and HTML attribute values.\n *\n * Transformations:\n *   'str'     -> 'str'\n *   null      -> ''\n *   undefined -> ''\n *   true      -> '1'\n *   false     -> '0'\n *   0         -> '0'\n *   1         -> '1'\n *\n * @param {string} value\n * @returns {string|null}\n */\nexport function hash_key(value) {\n\tif (typeof value === 'undefined' || value === null) return null;\n\tif (typeof value === 'boolean') return value ? '1' : '0';\n\treturn value + '';\n};\n\n/**\n * Escapes a string for use within HTML.\n *\n * @param {string} str\n * @returns {string}\n */\nexport function escape_html(str) {\n\treturn (str + '')\n\t\t.replace(/&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;');\n};\n\n\n/**\n * Debounce all fired events types listed in `types`\n * while executing the provided `fn`.\n *\n * @param {object} self\n * @param {array} types\n * @param {function} fn\n */\nexport function debounce_events( self, types, fn) {\n\tvar type;\n\tvar trigger = self.trigger;\n\tvar event_args = {};\n\n\t// override trigger method\n\tself.trigger = function() {\n\t\tvar type = arguments[0];\n\t\tif (types.indexOf(type) !== -1) {\n\t\t\tevent_args[type] = arguments;\n\t\t} else {\n\t\t\treturn trigger.apply(self, arguments);\n\t\t}\n\t};\n\n\t// invoke provided function\n\tfn.apply(self, []);\n\tself.trigger = trigger;\n\n\t// trigger queued events\n\tfor (type in event_args) {\n\t\tif (event_args.hasOwnProperty(type)) {\n\t\t\ttrigger.apply(self, event_args[type]);\n\t\t}\n\t}\n};\n\n\n/**\n * Determines the current selection within a text input control.\n * Returns an object containing:\n *   - start\n *   - length\n *\n * @param {object} input\n * @returns {object}\n */\nexport function getSelection(input) {\n\treturn {\n\t\tstart\t: input.selectionStart,\n\t\tlength\t: input.selectionEnd - input.selectionStart,\n\t};\n};\n","/**\n * Plugin: \"remove_button\" (Tom Select)\n * Copyright (c) contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n */\nimport TomSelect from '../../tom-select.js';\nimport { getDom } from '../../vanilla.js';\nimport { escape_html } from '../../utils.js';\n\nexport default TomSelect.define('remove_button',function(options) {\n\n\toptions = Object.assign({\n\t\t\tlabel     : '&times;',\n\t\t\ttitle     : 'Remove',\n\t\t\tclassName : 'remove',\n\t\t\tappend    : true\n\t\t}, options);\n\n\n\t//options.className = 'remove-single';\n\tvar self\t\t\t= this;\n\n\t// override the render method to add remove button to each item\n\tif( !options.append ){\n\t\treturn;\n\t}\n\n\tvar html = '<a href=\"javascript:void(0)\" class=\"' + options.className + '\" tabindex=\"-1\" title=\"' + escape_html(options.title) + '\">' + options.label + '</a>';\n\n\tself.hook('after','setupTemplates',function(){\n\n\t\tvar orig_render_item = self.settings.render.item;\n\n\t\tself.settings.render.item = function(){\n\n\t\t\tvar rendered = getDom(orig_render_item.apply(self, arguments));\n\n\t\t\tvar close_button = getDom(html);\n\t\t\trendered.appendChild(close_button);\n\n\t\t\tclose_button.addEventListener('mousedown',function(evt){\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevt.stopPropagation();\n\t\t\t});\n\n\t\t\tclose_button.addEventListener('click',function(evt){\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevt.stopPropagation();\n\n\t\t\t\t// propagating will trigger the dropdown to show for single mode\n\t\t\t\tif( self.settings.mode !== 'single' ){\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tif (self.isLocked) return;\n\n\t\t\t\tvar value = rendered.dataset.value;\n\t\t\t\tself.removeItem(value);\n\t\t\t\tself.refreshOptions(false);\n\t\t\t});\n\n\t\t\treturn rendered;\n\t\t};\n\n\t});\n\n\n});\n"],"names":["getDom","query","jquery","HTMLElement","indexOf","div","document","createElement","innerHTML","trim","firstChild","querySelector","escape_html","str","replace","TomSelect","define","options","Object","assign","label","title","className","append","self","html","hook","orig_render_item","settings","render","item","rendered","apply","arguments","close_button","appendChild","addEventListener","evt","preventDefault","stopPropagation","mode","isLocked","value","dataset","removeItem","refreshOptions"],"mappings":"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"}