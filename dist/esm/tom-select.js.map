{"version":3,"file":"tom-select.js","sources":["../../src/tom-select.ts"],"sourcesContent":["\nimport MicroEvent from './contrib/microevent.js';\nimport MicroPlugin from './contrib/microplugin.js';\nimport Sifter from './contrib/sifter.js';\nimport { TomSettings } from './types/settings';\nimport { TomInput, TomArgObject, TomOption, TomOptions, TomCreateFilter, TomCreateCallback } from './types/index';\nimport {highlight, removeHighlight} from './contrib/highlight.js';\nimport * as constants from './constants.js';\nimport getSettings from './settings.js';\nimport {\n\thash_key,\n\tescape_html,\n\tdebounce_events,\n\tgetSelection,\n\tpreventDefault,\n\taddEvent,\n\tloadDebounce,\n\tisKeyDown\n} from './utils';\n\nimport {\n\tgetDom,\n\tescapeQuery,\n\ttriggerEvent,\n\tapplyCSS,\n\taddClasses,\n\tremoveClasses,\n\tparentMatch,\n\tgetTail,\n\tisEmptyObject,\n\tnodeIndex\n} from './vanilla';\n\nexport default class TomSelect extends MicroPlugin(MicroEvent){\n\n\tpublic control_input\t\t\t: HTMLInputElement;\n\tpublic wrapper\t\t\t\t\t: HTMLElement;\n\tpublic dropdown\t\t\t\t\t: HTMLElement;\n\tpublic control\t\t\t\t\t: HTMLElement;\n\tpublic dropdown_content\t\t\t: HTMLElement;\n\n\tpublic order\t\t\t\t\t: number;\n\tpublic settings\t\t\t\t\t: TomSettings;\n\tpublic input\t\t\t\t\t: TomInput;\n\tpublic tabIndex\t\t\t\t\t: number;\n\tpublic is_select_tag\t\t\t: boolean;\n\tpublic rtl\t\t\t\t\t\t: boolean;\n\n\tprivate _destroy\t\t\t\t: () => void;\n\tpublic sifter\t\t\t\t\t: Sifter;\n\n\n\tpublic tab_key\t\t\t\t\t: boolean;\n\tpublic isOpen\t\t\t\t\t: boolean;\n\tpublic isDisabled\t\t\t\t: boolean;\n\tpublic isRequired\t\t\t\t: boolean;\n\tpublic isInvalid\t\t\t\t: boolean;\n\tpublic isLocked\t\t\t\t\t: boolean;\n\tpublic isFocused\t\t\t\t: boolean;\n\tpublic isInputHidden\t\t\t: boolean;\n\tpublic isSetup\t\t\t\t\t: boolean;\n\tpublic ignoreFocus\t\t\t\t: boolean;\n\tpublic ignoreBlur\t\t\t\t: boolean;\n\tpublic ignoreHover\t\t\t\t: boolean;\n\tpublic hasOptions\t\t\t\t: boolean;\n\tpublic currentResults\t\t\t: object;\n\tpublic lastValue\t\t\t\t: string;\n\tpublic caretPos\t\t\t\t\t: number;\n\tpublic loading\t\t\t\t\t: number;\n\tpublic loadedSearches\t\t\t: { [key: string]: boolean };\n\n\tpublic activeOption\t\t\t\t: HTMLElement;\n\tpublic activeItems\t\t\t\t: HTMLElement[];\n\n\tpublic optgroups\t\t\t\t: object;\n\tpublic options\t\t\t\t\t: TomOptions;\n\tpublic userOptions\t\t\t\t: object;\n\tpublic items\t\t\t\t\t: string[];\n\tpublic renderCache\t\t\t\t: {'item':{[key:string]:HTMLElement},'option':{[key:string]:HTMLElement}};\n\n\n\n\tconstructor( input, settings ){\n\t\tsuper();\n\n\t\tvar dir;\n\n\t\tinput\t\t\t\t= getDom( input );\n\n\t\tif( input.tomselect ){\n\t\t\tthrow new Error('Tom Select already initialized on this element');\n\t\t}\n\n\n\t\tinput.tomselect\t\t\t= this;\n\n\n\t\t// detect rtl environment\n\t\tvar computedStyle\t\t= window.getComputedStyle && window.getComputedStyle(input, null);\n\t\tdir\t\t\t\t\t\t= computedStyle.getPropertyValue('direction');\n\n\t\t// setup default state\n\t\tthis.order\t\t\t\t= 0;\n\t\tthis.settings\t\t\t= getSettings( input, settings );\n\t\tthis.input\t\t\t\t= input;\n\t\tthis.tabIndex\t\t\t= input.getAttribute('tabindex') || null;\n\t\tthis.is_select_tag\t\t= input.tagName.toLowerCase() === 'select';\n\t\tthis.rtl\t\t\t\t= /rtl/i.test(dir);\n\n\t\tthis.tab_key\t\t\t= false;\n\t\tthis.isOpen\t\t\t\t= false;\n\t\tthis.isDisabled\t\t\t= false;\n\t\tthis.isRequired\t\t\t= input.required;\n\t\tthis.isInvalid\t\t\t= false;\n\t\tthis.isLocked\t\t\t= false;\n\t\tthis.isFocused\t\t\t= false;\n\t\tthis.isInputHidden\t\t= false;\n\t\tthis.isSetup\t\t\t= false;\n\t\tthis.ignoreFocus\t\t= false;\n\t\tthis.ignoreBlur\t\t\t= false;\n\t\tthis.ignoreHover\t\t= false;\n\t\tthis.hasOptions\t\t\t= false;\n\t\tthis.currentResults\t\t= null;\n\t\tthis.lastValue\t\t\t= '';\n\t\tthis.caretPos\t\t\t= 0;\n\t\tthis.loading\t\t\t= 0;\n\t\tthis.loadedSearches\t\t= {};\n\n\t\tthis.activeOption\t\t= null;\n\t\tthis.activeItems\t\t= [];\n\n\t\tthis.optgroups\t\t\t= {};\n\t\tthis.options\t\t\t= {};\n\t\tthis.userOptions\t\t= {};\n\t\tthis.items\t\t\t\t= [];\n\t\tthis.renderCache\t\t= {'item':{},'option':{}};\n\n\n\t\t// debounce user defined load() if loadThrottle > 0\n\t\tif( this.settings.load && this.settings.loadThrottle ){\n\t\t\tthis.settings.load = loadDebounce(this.settings.load,this.settings.loadThrottle)\n\t\t}\n\n\t\t// search system\n\t\tthis.sifter = new Sifter(this.options, {diacritics: this.settings.diacritics});\n\n\t\tthis.setupOptions(this.settings.options,this.settings.optgroups);\n\t\tdelete this.settings.optgroups;\n\t\tdelete this.settings.options;\n\n\n\t\t// option-dependent defaults\n\t\tthis.settings.mode = this.settings.mode || (this.settings.maxItems === 1 ? 'single' : 'multi');\n\t\tif (typeof this.settings.hideSelected !== 'boolean') {\n\t\t\tthis.settings.hideSelected = this.settings.mode === 'multi';\n\t\t}\n\n\t\t// set up createFilter callback\n\t\tvar filter = this.settings.createFilter;\n\t\tif( typeof filter !== 'function' ){\n\n\t\t\tif( typeof filter === 'string' ){\n\t\t\t\tfilter = new RegExp(filter);\n\t\t\t}\n\n\t\t\tif( filter instanceof RegExp ){\n\t\t\t\tthis.settings.createFilter = (input) => (filter as RegExp).test(input);\n\t\t\t}else{\n\t\t\t\tthis.settings.createFilter = () => true;\n\t\t\t}\n\t\t}\n\n\n\t\tthis.initializePlugins(this.settings.plugins);\n\t\tthis.setupCallbacks();\n\t\tthis.setupTemplates();\n\t\tthis.setup();\n\t}\n\n\n\t// methods\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Creates all elements and sets up event bindings.\n\t *\n\t */\n\tsetup(){\n\n\n\t\tvar self      = this;\n\t\tvar settings  = self.settings;\n\t\tvar wrapper;\n\t\tvar control;\n\t\tvar control_input;\n\t\tvar dropdown;\n\t\tvar dropdown_content;\n\t\tvar inputMode;\n\t\tvar classes;\n\t\tvar classes_plugins;\n\t\tvar inputId;\n\t\tvar input\t\t\t= self.input;\n\t\tconst passive_event = { passive: true };\n\n\t\tinputMode\t\t\t= self.settings.mode;\n\t\tclasses\t\t\t\t= input.getAttribute('class') || '';\n\n\t\twrapper\t\t\t\t= getDom('<div>');\n\t\taddClasses( wrapper, settings.wrapperClass, classes, inputMode);\n\n\n\t\tcontrol\t\t\t\t= getDom('<div class=\"items\">');\n\t\taddClasses(control,settings.inputClass);\n\t\twrapper.append(control);\n\n\n\t\tdropdown\t\t\t= self.render('dropdown');\n\t\taddClasses(dropdown, settings.dropdownClass, inputMode);\n\n\n\t\tdropdown_content\t= getDom('<div style=\"scroll-behavior: smooth;\">')\n\t\taddClasses(dropdown_content, settings.dropdownContentClass);\n\t\tdropdown.append(dropdown_content);\n\n\t\tgetDom( settings.dropdownParent || wrapper ).appendChild( dropdown );\n\n\t\tif( settings.controlInput ){\n\t\t\tcontrol_input\t\t= getDom( settings.controlInput );\n\t\t}else{\n\t\t\tcontrol_input\t\t= getDom('<input type=\"text\" autocomplete=\"off\" />' );\n\n\t\t\t// set attributes\n\t\t\tvar attrs = ['autocorrect','autocapitalize','autocomplete'];\n\t\t\tfor(let i = 0; i<attrs.length; i++){\n\t\t\t\tlet attr = attrs[i];\n\t\t\t\tif( input.getAttribute(attr) ){\n\t\t\t\t\tcontrol_input.setAttribute(attr, input.getAttribute(attr) );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif( !settings.controlInput ){\n\t\t\tcontrol_input.setAttribute('tabindex', input.disabled ? '-1' : self.tabIndex);\n\t\t\tcontrol.appendChild( control_input );\n\t\t}\n\n\n\n\t\tif( inputId = input.getAttribute('id') ){\n\t\t\tcontrol_input.setAttribute('id', inputId + '-tomselected');\n\n\t\t\tlet query = \"label[for='\"+escapeQuery(inputId)+\"']\";\n\t\t\tlet label = document.querySelector(query);\n\t\t\tif( label ) label.setAttribute('for', inputId + '-tomselected');\n\t\t}\n\n\t\tif(self.settings.copyClassesToDropdown) {\n\t\t\taddClasses( dropdown, classes);\n\t\t}\n\n\t\twrapper.style.width = input.style.width;\n\n\t\tif (self.plugins.names.length) {\n\t\t\tclasses_plugins = 'plugin-' + self.plugins.names.join(' plugin-');\n\t\t\taddClasses( [wrapper,dropdown], classes_plugins);\n\t\t}\n\n\t\tif ((settings.maxItems === null || settings.maxItems > 1) && self.is_select_tag ){\n\t\t\tinput.setAttribute('multiple','multiple');\n\t\t}\n\n\t\tif (self.settings.placeholder) {\n\t\t\tcontrol_input.setAttribute('placeholder', settings.placeholder);\n\t\t}\n\n\t\t// if splitOn was not passed in, construct it from the delimiter to allow pasting universally\n\t\tif (!self.settings.splitOn && self.settings.delimiter) {\n\t\t\tvar delimiterEscaped = self.settings.delimiter.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n\t\t\tself.settings.splitOn = new RegExp('\\\\s*' + delimiterEscaped + '+\\\\s*');\n\t\t}\n\n\n\n\t\tself.control\t\t\t= control;\n\t\tself.control_input\t\t= control_input;\n\t\tself.wrapper\t\t\t= wrapper;\n\t\tself.dropdown\t\t\t= dropdown;\n\t\tself.dropdown_content\t= dropdown_content;\n\n\t\tself.control_input.type\t= input.type;\n\n\t\taddEvent(dropdown,'mouseenter', (e) => {\n\n\t\t\tvar target_match = parentMatch(e.target as HTMLElement, '[data-selectable]', dropdown);\n\t\t\tif( target_match ){\n\t\t\t\treturn self.onOptionHover( e as MouseEvent, target_match );\n\t\t\t}\n\t\t}, {capture:true});\n\n\t\taddEvent(control,'mousedown', (evt) => {\n\n\t\t\tvar target_match = parentMatch( evt.target as HTMLElement, '.'+self.settings.itemClass, control);\n\t\t\tif( target_match ){\n\t\t\t\treturn self.onItemSelect(evt as MouseEvent, target_match);\n\t\t\t}\n\t\t\treturn self.onMouseDown(evt as MouseEvent);\n\t\t});\n\n\t\taddEvent(control,'click', (e) => self.onClick(e as KeyboardEvent) );\n\n\n\t\taddEvent(control_input,'mousedown',\t(e) => e.stopPropagation() );\n\t\taddEvent(control_input,'keydown',\t(e) => self.onKeyDown(e as KeyboardEvent) );\n\t\taddEvent(control_input,'keyup',\t\t(e) => self.onKeyUp(e as KeyboardEvent) );\n\t\taddEvent(control_input,'keypress',\t(e) => self.onKeyPress(e as KeyboardEvent) );\n\t\taddEvent(control_input,'resize',\t() => self.positionDropdown(), passive_event);\n\t\taddEvent(control_input,'blur',\t\t(e) => self.onBlur(e as MouseEvent) );\n\t\taddEvent(control_input,'focus',\t\t(e) => { self.ignoreBlur = false; self.onFocus(e as MouseEvent) });\n\t\taddEvent(control_input,'paste',\t\t(e) => self.onPaste(e as MouseEvent) );\n\n\n\t\t// clicking anywhere in the control should not close the dropdown\n\t\t// clicking on an option should selectit\n\t\tvar doc_mousedown = (e) => {\n\n\t\t\t// if dropdownParent is set, options may not be within self.wrapper\n\t\t\tvar option = parentMatch(e.target, '[data-selectable]',self.dropdown);\n\n\t\t\t// outside of this instance\n\t\t\tif( !option && !self.wrapper.contains(e.target) ){\n\t\t\t\tif (self.isFocused) {\n\t\t\t\t\tself.blur(e.target);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpreventDefault(e,true);\n\n\t\t\tif( option ){\n\t\t\t\tself.onOptionSelect( e, option );\n\t\t\t}\n\t\t};\n\n\t\tvar win_scroll = () => {\n\t\t\tif (self.isOpen) {\n\t\t\t\tself.positionDropdown();\n\t\t\t}\n\t\t};\n\n\t\tvar win_hover = () => {\n\t\t\tself.ignoreHover = false;\n\t\t};\n\n\n\t\taddEvent(document,'mousedown',doc_mousedown);\n\t\taddEvent(window,'sroll', win_scroll, passive_event);\n\t\taddEvent(window,'resize', win_scroll, passive_event);\n\t\taddEvent(window,'mousemove', win_hover, passive_event);\n\n\t\tself._destroy = () => {\n\t\t\tdocument.removeEventListener('mousedown',doc_mousedown);\n\t\t\twindow.removeEventListener('mousemove',win_hover);\n\t\t\twindow.removeEventListener('sroll',win_scroll);\n\t\t\twindow.removeEventListener('resize',win_scroll);\n\t\t};\n\n\t\t// store original children and tab index so that they can be\n\t\t// restored when the destroy() method is called.\n\t\tvar children = [];\n\t\twhile( input.children.length > 0 ){\n\t\t\tchildren.push( input.children[0] );\n\t\t\tinput.children[0].remove();\n\t\t}\n\t\tthis.revertSettings = {\n\t\t\tchildren : children,\n\t\t\ttabindex  : input.getAttribute('tabindex')\n\t\t};\n\n\n\t\tinput.tabIndex = -1;\n\t\tinput.setAttribute('hidden','hidden');\n\t\tinput.insertAdjacentElement('afterend', self.wrapper);\n\n\t\tself.setValue(settings.items);\n\t\tdelete settings.items;\n\n\t\taddEvent(input,'invalid', (e) => {\n\t\t\tpreventDefault(e);\n\t\t\tif( !self.isInvalid ){\n\t\t\t\tself.isInvalid = true;\n\t\t\t\tself.refreshState();\n\t\t\t}\n\t\t});\n\n\t\tself.updateOriginalInput();\n\t\tself.refreshItems();\n\t\tself.refreshState();\n\t\tself.isSetup = true;\n\n\t\tif( input.disabled ){\n\t\t\tself.disable();\n\t\t}\n\n\t\tself.on('change', this.onChange);\n\n\t\taddClasses(input,'tomselected');\n\t\tself.trigger('initialize');\n\n\t\t// preload options\n\t\tif (settings.preload === true) {\n\t\t\tself.load('');\n\t\t}\n\n\t}\n\n\n\t/**\n\t * Register options and optgroups\n\t *\n\t */\n\tsetupOptions(options, optgroups){\n\t\tvar i, n;\n\n\t\toptions = options || [];\n\t\toptgroups = optgroups || [];\n\n\t\t// build options table\n\t\tfor( i = 0, n = options.length; i < n; i++ ){\n\t\t\tthis.registerOption(options[i]);\n\t\t}\n\n\n\t\t// build optgroup table\n\t\tfor( i = 0, n = optgroups.length; i < n; i++ ){\n\t\t\tthis.registerOptionGroup(optgroups[i]);\n\t\t}\n\t}\n\n\t/**\n\t * Sets up default rendering functions.\n\t */\n\tsetupTemplates() {\n\t\tvar self = this;\n\t\tvar field_label = self.settings.labelField;\n\t\tvar field_optgroup = self.settings.optgroupLabelField;\n\n\t\tvar templates = {\n\t\t\t'optgroup': (data, escape) => {\n\t\t\t\tlet optgroup = document.createElement('div');\n\t\t\t\toptgroup.className = 'optgroup';\n\t\t\t\toptgroup.appendChild(data.options);\n\t\t\t\treturn optgroup;\n\n\t\t\t},\n\t\t\t'optgroup_header': (data, escape) => {\n\t\t\t\treturn '<div class=\"optgroup-header\">' + escape(data[field_optgroup]) + '</div>';\n\t\t\t},\n\t\t\t'option': (data, escape) => {\n\t\t\t\treturn '<div>' + escape(data[field_label]) + '</div>';\n\t\t\t},\n\t\t\t'item': (data, escape) => {\n\t\t\t\treturn '<div>' + escape(data[field_label]) + '</div>';\n\t\t\t},\n\t\t\t'option_create': (data, escape) => {\n\t\t\t\treturn '<div class=\"create\">Add <strong>' + escape(data.input) + '</strong>&hellip;</div>';\n\t\t\t},\n\t\t\t'no_results':(data,escape) => {\n\t\t\t\treturn '<div class=\"no-results\">No results found</div>';\n\t\t\t},\n\t\t\t'loading':(data,escape) => {\n\t\t\t\treturn '<div class=\"spinner\"></div>';\n\t\t\t},\n\t\t\t'dropdown':() => {\n\t\t\t\treturn '<div style=\"display:none\"></div>';\n\t\t\t}\n\t\t};\n\n\n\t\tself.settings.render = Object.assign({}, templates, self.settings.render);\n\t}\n\n\t/**\n\t * Maps fired events to callbacks provided\n\t * in the settings used when creating the control.\n\t */\n\tsetupCallbacks() {\n\t\tvar key, fn, callbacks = {\n\t\t\t'initialize'      : 'onInitialize',\n\t\t\t'change'          : 'onChange',\n\t\t\t'item_add'        : 'onItemAdd',\n\t\t\t'item_remove'     : 'onItemRemove',\n\t\t\t'clear'           : 'onClear',\n\t\t\t'option_add'      : 'onOptionAdd',\n\t\t\t'option_remove'   : 'onOptionRemove',\n\t\t\t'option_clear'    : 'onOptionClear',\n\t\t\t'optgroup_add'    : 'onOptionGroupAdd',\n\t\t\t'optgroup_remove' : 'onOptionGroupRemove',\n\t\t\t'optgroup_clear'  : 'onOptionGroupClear',\n\t\t\t'dropdown_open'   : 'onDropdownOpen',\n\t\t\t'dropdown_close'  : 'onDropdownClose',\n\t\t\t'type'            : 'onType',\n\t\t\t'load'            : 'onLoad',\n\t\t\t'focus'           : 'onFocus',\n\t\t\t'blur'            : 'onBlur'\n\t\t};\n\n\t\tfor (key in callbacks) {\n\n\t\t\tfn = this.settings[callbacks[key]];\n\t\t\tif (fn) this.on(key, fn);\n\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the main control element\n\t * has a click event.\n\t *\n\t */\n\tonClick(e:MouseEvent|KeyboardEvent) {\n\t\tvar self = this;\n\n\t\t// necessary for mobile webkit devices (manual focus triggering\n\t\t// is ignored unless invoked within a click event)\n\t\t// also necessary to reopen a dropdown that has been closed by\n\t\t// closeAfterSelect\n\t\tif (!self.isFocused || !self.isOpen) {\n\t\t\tself.focus();\n\t\t\tpreventDefault(e);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the main control element\n\t * has a mouse down event.\n\t *\n\t */\n\tonMouseDown(e:MouseEvent|KeyboardEvent):boolean {\n\t\tvar self = this;\n\n\n\t\tif (self.isFocused) {\n\t\t\t// retain focus by preventing native handling. if the\n\t\t\t// event target is the input it should not be modified.\n\t\t\t// otherwise, text selection within the input won't work.\n\t\t\tif (e.target !== self.control_input) {\n\t\t\t\tif (self.settings.mode === 'single') {\n\t\t\t\t\t// toggle dropdown\n\t\t\t\t\tself.isOpen ? self.close() : self.open();\n\t\t\t\t} else {\n\t\t\t\t\tself.setActiveItem();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\t// give control focus\n\t\t\tsetTimeout(() => self.focus(), 0);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the value of the control has been changed.\n\t * This should propagate the event to the original DOM\n\t * input / select element.\n\t */\n\tonChange() {\n\t\ttriggerEvent(this.input, 'input');\n\t\ttriggerEvent(this.input, 'change');\n\t}\n\n\t/**\n\t * Triggered on <input> paste.\n\t *\n\t */\n\tonPaste(e:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tif (self.isFull() || self.isInputHidden || self.isLocked) {\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\t// If a regex or string is included, this will split the pasted\n\t\t// input and create Items for each separate value\n\t\tif (self.settings.splitOn) {\n\n\t\t\t// Wait for pasted text to be recognized in value\n\t\t\tsetTimeout(() => {\n\t\t\t\tvar pastedText = self.inputValue();\n\t\t\t\tif(!pastedText.match(self.settings.splitOn)){ return }\n\n\t\t\t\tvar splitInput = pastedText.trim().split(self.settings.splitOn);\n\t\t\t\tfor (var i = 0, n = splitInput.length; i < n; i++) {\n\t\t\t\t\tself.createItem(splitInput[i]);\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keypress.\n\t *\n\t */\n\tonKeyPress(e:KeyboardEvent):void {\n\t\tvar self = this;\n\t\tif(self.isLocked){\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\t\tvar character = String.fromCharCode(e.keyCode || e.which);\n\t\tif (self.settings.create && self.settings.mode === 'multi' && character === self.settings.delimiter) {\n\t\t\tself.createItem();\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keydown.\n\t *\n\t */\n\tonKeyDown(e:KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tself.ignoreHover = true;\n\n\t\tif (self.isLocked) {\n\t\t\tif (e.keyCode !== constants.KEY_TAB) {\n\t\t\t\tpreventDefault(e);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e.keyCode) {\n\n\t\t\t// ctrl+A: select all\n\t\t\tcase constants.KEY_A:\n\t\t\t\tif( isKeyDown(constants.KEY_SHORTCUT,e) ){\n\t\t\t\t\tself.selectAll();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// esc: close dropdown\n\t\t\tcase constants.KEY_ESC:\n\t\t\t\tif (self.isOpen) {\n\t\t\t\t\tpreventDefault(e,true);\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\t// down: open dropdown or move selection down\n\t\t\tcase constants.KEY_DOWN:\n\t\t\t\tif (!self.isOpen && self.hasOptions) {\n\t\t\t\t\tself.open();\n\t\t\t\t} else if (self.activeOption) {\n\t\t\t\t\tlet next = self.getAdjacent(self.activeOption, 1);\n\t\t\t\t\tif (next) self.setActiveOption(next, true );\n\t\t\t\t}\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\n\t\t\t// up: move selection up\n\t\t\tcase constants.KEY_UP:\n\t\t\t\tif (self.activeOption) {\n\t\t\t\t\tlet prev = self.getAdjacent(self.activeOption, -1);\n\t\t\t\t\tif (prev) self.setActiveOption(prev, true);\n\t\t\t\t}\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\n\t\t\t// doc_src select active option\n\t\t\tcase constants.KEY_RETURN:\n\t\t\t\tif (self.isOpen && self.activeOption) {\n\t\t\t\t\tself.onOptionSelect(e,self.activeOption);\n\t\t\t\t\tpreventDefault(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\t// left: modifiy item selection to the left\n\t\t\tcase constants.KEY_LEFT:\n\t\t\t\tself.advanceSelection(-1, e);\n\t\t\t\treturn;\n\n\t\t\t// right: modifiy item selection to the right\n\t\t\tcase constants.KEY_RIGHT:\n\t\t\t\tself.advanceSelection(1, e);\n\t\t\t\treturn;\n\n\t\t\t// tab: select active option and/or create item\n\t\t\tcase constants.KEY_TAB:\n\t\t\t\tif (self.settings.selectOnTab && self.isOpen && self.activeOption) {\n\t\t\t\t\tself.tab_key = true;\n\t\t\t\t\tself.onOptionSelect(e,self.activeOption);\n\n\t\t\t\t\t// prevent default [tab] behaviour of jump to the next field\n\t\t\t\t\t// if select isFull, then the dropdown won't be open and [tab] will work normally\n\t\t\t\t\tpreventDefault(e);\n\t\t\t\t\tself.tab_key = false;\n\t\t\t\t}\n\t\t\t\tif (self.settings.create && self.createItem()) {\n\t\t\t\t\tpreventDefault(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\n\t\t\t// delete|backspace: delete items\n\t\t\tcase constants.KEY_BACKSPACE:\n\t\t\tcase constants.KEY_DELETE:\n\t\t\t\tself.deleteSelection(e);\n\t\t\t\treturn;\n\t\t}\n\n\t\tif( self.isInputHidden && !isKeyDown(constants.KEY_SHORTCUT,e) ){\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Triggered on <input> keyup.\n\t *\n\t */\n\tonKeyUp(e:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\n\t\tif (self.isLocked){\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\tvar value = self.inputValue();\n\t\tif (self.lastValue !== value) {\n\t\t\tself.lastValue = value;\n\t\t\tself.load(value);\n\t\t\tself.refreshOptions();\n\t\t\tself.trigger('type', value);\n\t\t}\n\t}\n\n\n\t/**\n\t * Triggered on <input> focus.\n\t *\n\t */\n\tonFocus(e?:MouseEvent|KeyboardEvent):void {\n\t\tvar self = this;\n\t\tvar wasFocused = self.isFocused;\n\n\t\tif (self.isDisabled) {\n\t\t\tself.blur();\n\t\t\tpreventDefault(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif (self.ignoreFocus) return;\n\t\tself.isFocused = true;\n\t\tif (self.settings.preload === 'focus') self.load('');\n\n\t\tif (!wasFocused) self.trigger('focus');\n\n\t\tif (!self.activeItems.length) {\n\t\t\tself.showInput();\n\t\t\tself.setActiveItem();\n\t\t\tself.refreshOptions(!!self.settings.openOnFocus);\n\t\t}\n\n\t\tself.refreshState();\n\t}\n\n\t/**\n\t * Triggered on <input> blur.\n\t *\n\t */\n\tonBlur(e:MouseEvent|KeyboardEvent, dest?:HTMLElement):void {\n\t\tvar self = this;\n\t\tif (!self.isFocused) return;\n\t\tself.isFocused = false;\n\t\tself.ignoreFocus = false;\n\n\n\t\tif (!self.ignoreBlur && document.activeElement === self.dropdown_content) {\n\t\t\t// necessary to prevent IE closing the dropdown when the scrollbar is clicked\n\t\t\tself.ignoreBlur = true;\n\t\t\tself.onFocus(e);\n\t\t\treturn;\n\t\t}\n\n\t\tvar deactivate = () => {\n\t\t\tself.close();\n\t\t\tself.setActiveItem();\n\t\t\tself.setActiveOption();\n\t\t\tself.setCaret(self.items.length);\n\t\t\tself.refreshState();\n\t\t\tself.trigger('blur');\n\t\t};\n\n\t\tif (self.settings.create && self.settings.createOnBlur) {\n\t\t\tself.createItem(null, false, deactivate);\n\t\t} else {\n\t\t\tdeactivate();\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the user rolls over\n\t * an option in the autocomplete dropdown menu.\n\t *\n\t */\n\tonOptionHover( evt:MouseEvent|KeyboardEvent, option:HTMLElement ):boolean{\n\t\tif (this.ignoreHover) return;\n\t\tthis.setActiveOption(option, false);\n\t}\n\n\t/**\n\t * Triggered when the user clicks on an option\n\t * in the autocomplete dropdown menu.\n\t *\n\t */\n\tonOptionSelect( evt:MouseEvent|KeyboardEvent, option:HTMLElement ): boolean{\n\t\tvar value, self = this;\n\n\t\tif( !option ){\n\t\t\treturn;\n\t\t}\n\n\t\t// should not be possible to trigger a option under a disabled optgroup\n\t\tif( option.parentElement && option.parentElement.matches('[data-disabled]') ){\n\t\t\treturn;\n\t\t}\n\n\n\t\tif( option.classList.contains('create') ){\n\t\t\tself.createItem(null, true, () => {\n\t\t\t\tif (self.settings.closeAfterSelect) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvalue = option.dataset.value;\n\t\t\tif (typeof value !== 'undefined') {\n\t\t\t\tself.lastQuery = null;\n\t\t\t\tself.addItem(value);\n\t\t\t\tif (self.settings.closeAfterSelect) {\n\t\t\t\t\tself.close();\n\t\t\t\t} else if (!self.settings.hideSelected && evt.type && /mouse/.test(evt.type)) {\n\t\t\t\t\tself.setActiveOption(self.getOption(value));\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Triggered when the user clicks on an item\n\t * that has been selected.\n\t *\n\t */\n\tonItemSelect( evt?:MouseEvent, item?:HTMLElement ):boolean{\n\t\tvar self = this;\n\n\t\tif (self.isLocked) return;\n\t\tif (self.settings.mode === 'multi') {\n\t\t\tpreventDefault(evt);\n\t\t\tself.setActiveItem(item, evt);\n\t\t}\n\t}\n\n\n\t/**\n\t * Invokes the user-provided option provider / loader.\n\t *\n\t */\n\tload(value:string):void {\n\t\tvar self = this;\n\t\tvar fn = self.settings.load;\n\t\tif (!fn) return;\n\t\tif (self.loadedSearches.hasOwnProperty(value)) return;\n\n\t\taddClasses(self.wrapper,self.settings.loadingClass);\n\t\tself.loading++;\n\n\n\t\tfn.call(self, value, function(options, optgroups){\n\t\t\tself.loading = Math.max(self.loading - 1, 0);\n\t\t\tself.lastQuery = null;\n\n\t\t\tself.setupOptions(options,optgroups);\n\n\t\t\tself.refreshOptions(self.isFocused && !self.isInputHidden);\n\n\t\t\tif (!self.loading) {\n\t\t\t\tremoveClasses(self.wrapper,self.settings.loadingClass);\n\t\t\t}\n\n\t\t\tself.trigger('load', options, optgroups);\n\t\t});\n\t}\n\n\t/**\n\t * @deprecated 1.1\n\t *\n\t */\n\tonSearchChange(value:string):void {\n\t\tthis.load(value);\n\t}\n\n\n\t/**\n\t * Sets the input field of the control to the specified value.\n\t *\n\t */\n\tsetTextboxValue(value:string) {\n\t\tvar input = this.control_input;\n\t\tvar changed = input.value !== value;\n\t\tif (changed) {\n\t\t\tinput.value = value;\n\t\t\ttriggerEvent(input,'update');\n\t\t\tthis.lastValue = value;\n\t\t}\n\t}\n\n\t/**\n\t * Returns the value of the control. If multiple items\n\t * can be selected (e.g. <select multiple>), this returns\n\t * an array. If only one item can be selected, this\n\t * returns a string.\n\t *\n\t */\n\tgetValue():string|string[] {\n\n\t\tif( this.is_select_tag && this.input.hasAttribute('multiple')) {\n\t\t\treturn this.items;\n\t\t}\n\n\t\treturn this.items.join(this.settings.delimiter);\n\t}\n\n\t/**\n\t * Resets the selected items to the given value.\n\t *\n\t */\n\tsetValue( value:string|string[], silent?:boolean ):void{\n\t\tvar events = silent ? [] : ['change'];\n\n\t\tdebounce_events(this, events,() => {\n\t\t\tthis.clear(silent);\n\t\t\tthis.addItems(value, silent);\n\t\t});\n\t}\n\n\n\t/**\n\t * Resets the number of max items to the given value\n\t *\n\t */\n\tsetMaxItems(value:number){\n\t\tif(value === 0) value = null; //reset to unlimited items.\n\t\tthis.settings.maxItems = value;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Sets the selected item.\n\t *\n\t */\n\tsetActiveItem( item?:HTMLElement, e?:MouseEvent|KeyboardEvent ){\n\t\tvar self = this;\n\t\tvar eventName;\n\t\tvar i, begin, end, swap;\n\t\tvar last;\n\n\t\tif (self.settings.mode === 'single') return;\n\n\t\t// clear the active selection\n\t\tif( !item ){\n\t\t\tremoveClasses(self.activeItems,'active');\n\t\t\tself.activeItems = [];\n\t\t\tif (self.isFocused) {\n\t\t\t\tself.showInput();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// modify selection\n\t\teventName = e && e.type.toLowerCase();\n\n\t\tif (eventName === 'mousedown' && isKeyDown('shiftKey',e) && self.activeItems.length) {\n\t\t\tlast\t= self.getLastActive();\n\t\t\tbegin\t= Array.prototype.indexOf.call(self.control.children, last);\n\t\t\tend\t\t= Array.prototype.indexOf.call(self.control.children, item);\n\n\t\t\tif (begin > end) {\n\t\t\t\tswap  = begin;\n\t\t\t\tbegin = end;\n\t\t\t\tend   = swap;\n\t\t\t}\n\t\t\tfor (i = begin; i <= end; i++) {\n\t\t\t\titem = self.control.children[i] as HTMLElement;\n\t\t\t\tif (self.activeItems.indexOf(item) === -1) {\n\t\t\t\t\tself.setActiveItemClass(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\tpreventDefault(e);\n\t\t} else if ((eventName === 'mousedown' && isKeyDown(constants.KEY_SHORTCUT,e) ) || (eventName === 'keydown' && isKeyDown('shiftKey',e))) {\n\t\t\tif( item.classList.contains('active') ){\n\t\t\t\tself.removeActiveItem( item );\n\t\t\t} else {\n\t\t\t\tself.setActiveItemClass(item);\n\t\t\t}\n\t\t} else {\n\t\t\tremoveClasses(self.activeItems,'active');\n\t\t\tself.activeItems = [];\n\t\t\tself.setActiveItemClass(item);\n\t\t}\n\n\t\t// ensure control has focus\n\t\tself.hideInput();\n\t\tif (!self.isFocused) {\n\t\t\tself.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Set the active and last-active classes\n\t *\n\t */\n\tsetActiveItemClass( item:HTMLElement ){\n\n\t\tvar last_active = this.control.querySelector('.last-active');\n\t\tif( last_active ) removeClasses(last_active as HTMLElement,'last-active');\n\n\t\taddClasses(item,'active last-active');\n\t\tif( this.activeItems.indexOf(item) == -1 ){\n\t\t\tthis.activeItems.push( item );\n\t\t}\n\t}\n\n\t/**\n\t * Remove active item\n\t *\n\t */\n\tremoveActiveItem( item:HTMLElement ){\n\t\tvar idx = this.activeItems.indexOf(item);\n\t\tthis.activeItems.splice(idx, 1);\n\t\tremoveClasses(item,'active');\n\t}\n\n\n\t/**\n\t * Sets the selected item in the dropdown menu\n\t * of available options.\n\t *\n\t */\n\tsetActiveOption( option?:HTMLElement, scroll?:boolean ){\n\t\tvar height_menu, height_item, y;\n\n\t\tif( option === this.activeOption ){\n\t\t\treturn;\n\t\t}\n\n\t\tif( this.activeOption ) removeClasses(this.activeOption,'active');\n\t\tthis.activeOption = null;\n\n\t\tif( !option ) return;\n\n\t\tthis.activeOption = option;\n\t\taddClasses(option,'active');\n\n\t\tif( scroll ){\n\n\t\t\theight_menu\t\t= this.dropdown_content.clientHeight;\n\t\t\tlet scrollTop\t= this.dropdown_content.scrollTop || 0;\n\n\t\t\theight_item\t\t= this.activeOption.offsetHeight;\n\t\t\ty\t\t\t\t= this.activeOption.getBoundingClientRect().top - this.dropdown_content.getBoundingClientRect().top + scrollTop;\n\n\t\t\tif (y + height_item > height_menu + scrollTop) {\n\t\t\t\tthis.dropdown_content.scrollTop = y - height_menu + height_item;\n\n\t\t\t} else if (y < scrollTop) {\n\t\t\t\tthis.dropdown_content.scrollTop = y;\n\t\t\t}\n\n\n\t\t}\n\t}\n\n\t/**\n\t * Selects all items (CTRL + A).\n\t */\n\tselectAll() {\n\n\t\tif (this.settings.mode === 'single') return;\n\n\t\tthis.activeItems = this.controlChildren();\n\n\t\tif( this.activeItems.length ){\n\t\t\taddClasses( this.activeItems, 'active' );\n\n\t\t\tthis.hideInput();\n\t\t\tthis.close();\n\t\t}\n\t\tthis.focus();\n\t}\n\n\t/**\n\t * Hides the input element out of view, while\n\t * retaining its focus.\n\t */\n\thideInput() {\n\n\t\tif( this.settings.controlInput ) return;\n\n\t\tthis.setTextboxValue('');\n\t\tapplyCSS(this.control_input, {opacity: 0, position: 'absolute', left: (this.rtl ? 10000 : -10000)+'px'} );\n\t\tthis.isInputHidden = true;\n\t}\n\n\t/**\n\t * Restores input visibility.\n\t */\n\tshowInput() {\n\n\t\tif( this.settings.controlInput ) return;\n\n\t\tapplyCSS(this.control_input, {opacity: 1, position: 'relative', left: 0} );\n\t\tthis.isInputHidden = false;\n\t}\n\n\t/**\n\t * Get the input value\n\t */\n\tinputValue(){\n\t\treturn this.control_input.value.trim();\n\t}\n\n\t/**\n\t * Gives the control focus.\n\t */\n\tfocus() {\n\t\tvar self = this;\n\t\tif (self.isDisabled) return;\n\n\t\tself.ignoreFocus = true;\n\t\tself.control_input.focus();\n\t\tsetTimeout(() => {\n\t\t\tself.ignoreFocus = false;\n\t\t\tself.onFocus();\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Forces the control out of focus.\n\t *\n\t */\n\tblur(dest?:HTMLElement):void {\n\t\tthis.control_input.blur();\n\n\t\tthis.onBlur(null, dest);\n\t}\n\n\t/**\n\t * Returns a function that scores an object\n\t * to show how good of a match it is to the\n\t * provided query.\n\t *\n\t * @return {function}\n\t */\n\tgetScoreFunction(query:string) {\n\t\treturn this.sifter.getScoreFunction(query, this.getSearchOptions());\n\t}\n\n\t/**\n\t * Returns search options for sifter (the system\n\t * for scoring and sorting results).\n\t *\n\t * @see https://github.com/brianreavis/sifter.js\n\t * @return {object}\n\t */\n\tgetSearchOptions() {\n\t\tvar sort;\n\t\tvar settings = this.settings;\n\t\tif (typeof settings.sortField === 'string') {\n\t\t\tsort = [{field: settings.sortField}];\n\t\t}\n\n\t\treturn {\n\t\t\tfields      : settings.searchField,\n\t\t\tconjunction : settings.searchConjunction,\n\t\t\tsort        : sort,\n\t\t\tnesting     : settings.nesting\n\t\t};\n\t}\n\n\t/**\n\t * Searches through available options and returns\n\t * a sorted array of matches.\n\t *\n\t * Returns an object containing:\n\t *\n\t *   - query {string}\n\t *   - tokens {array}\n\t *   - total {int}\n\t *   - items {array}\n\t *\n\t * @returns {object}\n\t */\n\tsearch(query:string){\n\t\tvar i, result, calculateScore;\n\t\tvar self     = this;\n\t\tvar settings = self.settings;\n\t\tvar options  = this.getSearchOptions();\n\n\t\t// validate user-provided result scoring function\n\t\tif (settings.score) {\n\t\t\tcalculateScore = self.settings.score.call(self,query);\n\t\t\tif (typeof calculateScore !== 'function') {\n\t\t\t\tthrow new Error('Tom Select \"score\" setting must be a function that returns a function');\n\t\t\t}\n\t\t}\n\n\t\t// perform search\n\t\tif (query !== self.lastQuery) {\n\t\t\tself.lastQuery\t\t\t= query;\n\t\t\tresult\t\t\t\t\t= self.sifter.search(query, Object.assign(options, {score: calculateScore}));\n\t\t\tself.currentResults\t\t= result;\n\t\t} else {\n\t\t\tresult\t\t\t\t\t= Object.assign( {}, self.currentResults);\n\t\t}\n\n\t\t// filter out selected items\n\t\tif (settings.hideSelected) {\n\t\t\tfor (i = result.items.length - 1; i >= 0; i--) {\n\t\t\t\tif (self.items.indexOf(hash_key(result.items[i].id)) !== -1) {\n\t\t\t\t\tresult.items.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Refreshes the list of available options shown\n\t * in the autocomplete dropdown menu.\n\t *\n\t */\n\trefreshOptions( triggerDropdown:boolean = true ){\n\t\tvar i, j, k, n, groups, groups_order, optgroup, optgroups, html, has_create_option;\n\t\tvar active, create;\n\n\n\t\tvar self\t\t\t\t\t= this;\n\t\tvar query\t\t\t\t\t= self.inputValue();\n\t\tvar results\t\t\t\t\t= self.search(query);\n\t\tvar active_before_hash\t\t= self.activeOption && hash_key(self.activeOption.dataset.value);\n\t\tvar show_dropdown\t\t\t= false;\n\n\n\t\t// build markup\n\t\tn = results.items.length;\n\t\tif (typeof self.settings.maxOptions === 'number') {\n\t\t\tn = Math.min(n, self.settings.maxOptions);\n\t\t}\n\n\t\tif( n > 0 ){\n\t\t\tshow_dropdown = true;\n\t\t}\n\n\t\t// render and group available options individually\n\t\tgroups = {};\n\t\tgroups_order = [];\n\n\t\tfor (i = 0; i < n; i++) {\n\n\t\t\t// get option dom element, don't re-render if we\n\t\t\tlet option\t\t\t= self.options[results.items[i].id];\n\t\t\tlet opt_value\t\t= hash_key(option[self.settings.valueField]);\n\t\t\tlet option_el\t\t= self.getOption(opt_value);\n\t\t\tif( !option_el ){\n\t\t\t\toption_el = self.render('option', option);\n\t\t\t}\n\n\n\t\t\toptgroup    = option[self.settings.optgroupField] || '';\n\t\t\toptgroups   = Array.isArray(optgroup) ? optgroup : [optgroup];\n\n\t\t\tfor (j = 0, k = optgroups && optgroups.length; j < k; j++) {\n\t\t\t\toptgroup = optgroups[j];\n\t\t\t\tif (!self.optgroups.hasOwnProperty(optgroup)) {\n\t\t\t\t\toptgroup = '';\n\t\t\t\t}\n\t\t\t\tif (!groups.hasOwnProperty(optgroup)) {\n\t\t\t\t\tgroups[optgroup] = document.createDocumentFragment();\n\t\t\t\t\tgroups_order.push(optgroup);\n\t\t\t\t}\n\n\t\t\t\t// a child could only have one parent, so if you have more parents clone the child\n\t\t\t\tif( j > 0 ){\n\t\t\t\t\toption_el = option_el.cloneNode(true) as HTMLElement;\n\t\t\t\t\tremoveClasses(option_el,'active');\n\t\t\t\t}\n\n\t\t\t\tgroups[optgroup].appendChild(option_el);\n\t\t\t}\n\t\t}\n\n\t\t// sort optgroups\n\t\tif (this.settings.lockOptgroupOrder) {\n\t\t\tgroups_order.sort((a, b) => {\n\t\t\t\tvar a_order = self.optgroups[a].$order || 0;\n\t\t\t\tvar b_order = self.optgroups[b].$order || 0;\n\t\t\t\treturn a_order - b_order;\n\t\t\t});\n\t\t}\n\n\t\t// render optgroup headers & join groups\n\t\thtml = document.createDocumentFragment();\n\t\tfor (i = 0, n = groups_order.length; i < n; i++) {\n\t\t\toptgroup = groups_order[i];\n\t\t\tif (self.optgroups.hasOwnProperty(optgroup) && groups[optgroup].children.length) {\n\n\t\t\t\tlet group_options = document.createDocumentFragment();\n\t\t\t\tgroup_options.appendChild(self.render('optgroup_header', self.optgroups[optgroup]));\n\t\t\t\tgroup_options.appendChild(groups[optgroup]);\n\n\t\t\t\tlet group_html = self.render('optgroup', {group:self.optgroups[optgroup],options:group_options} );\n\n\t\t\t\thtml.appendChild(group_html);\n\n\t\t\t} else {\n\t\t\t\thtml.appendChild(groups[optgroup]);\n\t\t\t}\n\t\t}\n\n\t\tself.dropdown_content.innerHTML = '';\n\t\tself.dropdown_content.appendChild(html);\n\n\t\t// highlight matching terms inline\n\t\tif (self.settings.highlight) {\n\t\t\tremoveHighlight( self.dropdown_content );\n\t\t\tif (results.query.length && results.tokens.length) {\n\t\t\t\tfor (i = 0, n = results.tokens.length; i < n; i++) {\n\t\t\t\t\thighlight( self.dropdown_content, results.tokens[i].regex);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// add \"selected\" class to selected options\n\t\tif (!self.settings.hideSelected) {\n\t\t\tfor (i = 0, n = self.items.length; i < n; i++) {\n\t\t\t\tlet option = self.getOption(self.items[i])\n\t\t\t\tif( option ){\n\t\t\t\t\taddClasses(option,'selected');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// helper method for adding templates to dropdown\n\t\tvar add_template = (template:string) => {\n\t\t\tlet content = self.render(template,{input:query});\n\t\t\tif( content ){\n\t\t\t\tshow_dropdown = true;\n\t\t\t\tself.dropdown_content.insertBefore(content, self.dropdown_content.firstChild);\n\t\t\t}\n\t\t\treturn content;\n\t\t};\n\n\t\t// add loading message\n\t\tif( self.loading ){\n\t\t\tadd_template('loading');\n\n\t\t// add no_results message\n\t\t}else if( results.items.length === 0 && self.settings.render['no_results']  && query.length ){\n\t\t\tadd_template('no_results');\n\n\t\t}\n\n\n\t\t// add create option\n\t\thas_create_option = self.canCreate(query);\n\t\tif (has_create_option) {\n\t\t\tcreate = add_template('option_create');\n\t\t}\n\n\n\t\t// activate\n\t\tself.hasOptions = results.items.length > 0 || has_create_option;\n\t\tif( show_dropdown ){\n\n\t\t\tif (results.items.length > 0) {\n\n\t\t\t\tactive = active_before_hash && self.getOption(active_before_hash);\n\n\t\t\t\tif( !active || !self.dropdown_content.contains(active)  ){\n\n\t\t\t\t\tlet active_index = 0;\n\t\t\t\t\tif( create && !self.settings.addPrecedence ){\n\t\t\t\t\t\tactive_index = 1;\n\t\t\t\t\t}\n\t\t\t\t\tactive = self.selectable()[active_index];\n\t\t\t\t}\n\n\t\t\t}else{\n\t\t\t\tactive = create;\n\t\t\t}\n\n\t\t\tself.setActiveOption(active);\n\t\t\tif( triggerDropdown && !self.isOpen ){ self.open(); }\n\n\t\t}else{\n\t\t\tself.setActiveOption();\n\t\t\tif( triggerDropdown && self.isOpen ){ self.close(); }\n\t\t}\n\t}\n\n\t/**\n\t * Return list of selectable options\n\t *\n\t */\n\tselectable():NodeList{\n\t\treturn this.dropdown_content.querySelectorAll('[data-selectable]');\n\t}\n\n\n\n\t/**\n\t * Adds an available option. If it already exists,\n\t * nothing will happen. Note: this does not refresh\n\t * the options list dropdown (use `refreshOptions`\n\t * for that).\n\t *\n\t * Usage:\n\t *\n\t *   this.addOption(data)\n\t *\n\t */\n\taddOption(data:TomOption|TomOption[]):void {\n\t\tvar i, n, value, self = this;\n\n\t\tif (Array.isArray(data)) {\n\t\t\tfor (i = 0, n = data.length; i < n; i++) {\n\t\t\t\tself.addOption(data[i]);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (value = self.registerOption(data)) {\n\t\t\tself.userOptions[value] = true;\n\t\t\tself.lastQuery = null;\n\t\t\tself.trigger('option_add', value, data);\n\t\t}\n\t}\n\n\t/**\n\t * Registers an option to the pool of options.\n\t *\n\t */\n\tregisterOption(data:TomOption):boolean|string {\n\t\tvar key = hash_key(data[this.settings.valueField]);\n\t\tif (typeof key === 'undefined' || key === null || this.options.hasOwnProperty(key)) return false;\n\t\tdata.$order = data.$order || ++this.order;\n\t\tthis.options[key] = data;\n\t\treturn key;\n\t}\n\n\t/**\n\t * Registers an option group to the pool of option groups.\n\t *\n\t * @return {boolean|string}\n\t */\n\tregisterOptionGroup(data:TomOption) {\n\t\tvar key = hash_key(data[this.settings.optgroupValueField]);\n\t\tif (!key) return false;\n\n\t\tdata.$order = data.$order || ++this.order;\n\t\tthis.optgroups[key] = data;\n\t\treturn key;\n\t}\n\n\t/**\n\t * Registers a new optgroup for options\n\t * to be bucketed into.\n\t *\n\t */\n\taddOptionGroup(id:string, data:TomOption) {\n\t\tvar hashed_id;\n\t\tdata[this.settings.optgroupValueField] = id;\n\n\t\tif( hashed_id = this.registerOptionGroup(data) ){\n\t\t\tthis.trigger('optgroup_add', hashed_id, data);\n\t\t}\n\t}\n\n\t/**\n\t * Removes an existing option group.\n\t *\n\t */\n\tremoveOptionGroup(id:string) {\n\t\tif (this.optgroups.hasOwnProperty(id)) {\n\t\t\tdelete this.optgroups[id];\n\t\t\tthis.clearCache();\n\t\t\tthis.trigger('optgroup_remove', id);\n\t\t}\n\t}\n\n\t/**\n\t * Clears all existing option groups.\n\t */\n\tclearOptionGroups() {\n\t\tthis.optgroups = {};\n\t\tthis.clearCache();\n\t\tthis.trigger('optgroup_clear');\n\t}\n\n\t/**\n\t * Updates an option available for selection. If\n\t * it is visible in the selected items or options\n\t * dropdown, it will be re-rendered automatically.\n\t *\n\t */\n\tupdateOption(value:string, data:TomOption) {\n\t\tvar self = this;\n\t\tvar item, item_new;\n\t\tvar value_new, index_item, cache_items, cache_options, order_old;\n\n\t\tvalue     = hash_key(value);\n\t\tvalue_new = hash_key(data[self.settings.valueField]);\n\n\t\t// sanity checks\n\t\tif (value === null) return;\n\t\tif (!self.options.hasOwnProperty(value)) return;\n\t\tif (typeof value_new !== 'string') throw new Error('Value must be set in option data');\n\n\t\torder_old = self.options[value].$order;\n\n\t\t// update references\n\t\tif (value_new !== value) {\n\t\t\tdelete self.options[value];\n\t\t\tindex_item = self.items.indexOf(value);\n\t\t\tif (index_item !== -1) {\n\t\t\t\tself.items.splice(index_item, 1, value_new);\n\t\t\t}\n\t\t}\n\t\tdata.$order = data.$order || order_old;\n\t\tself.options[value_new] = data;\n\n\t\t// invalidate render cache\n\t\tcache_items = self.renderCache['item'];\n\t\tcache_options = self.renderCache['option'];\n\n\t\tif (cache_items) {\n\t\t\tdelete cache_items[value];\n\t\t\tdelete cache_items[value_new];\n\t\t}\n\t\tif (cache_options) {\n\t\t\tdelete cache_options[value];\n\t\t\tdelete cache_options[value_new];\n\t\t}\n\n\t\t// update the item if it's selected\n\t\tif (self.items.indexOf(value_new) !== -1) {\n\t\t\titem\t\t= self.getItem(value);\n\t\t\titem_new\t= self.render('item', data);\n\n\t\t\tif( item.classList.contains('active') ) addClasses(item_new,'active');\n\n\t\t\titem.parentNode.insertBefore(item_new, item);\n\t\t\titem.remove();\n\t\t}\n\n\t\t// invalidate last query because we might have updated the sortField\n\t\tself.lastQuery = null;\n\n\t\t// update dropdown contents\n\t\tif (self.isOpen) {\n\t\t\tself.refreshOptions(false);\n\t\t}\n\t}\n\n\t/**\n\t * Removes a single option.\n\t *\n\t */\n\tremoveOption(value:string, silent?:boolean):void {\n\t\tvar self = this;\n\t\tvalue = hash_key(value);\n\n\t\tvar cache_items = self.renderCache['item'];\n\t\tvar cache_options = self.renderCache['option'];\n\t\tif (cache_items) delete cache_items[value];\n\t\tif (cache_options) delete cache_options[value];\n\n\t\tdelete self.userOptions[value];\n\t\tdelete self.options[value];\n\t\tself.lastQuery = null;\n\t\tself.trigger('option_remove', value);\n\t\tself.removeItem(value, silent);\n\t}\n\n\t/**\n\t * Clears all options.\n\t */\n\tclearOptions() {\n\n\t\tthis.loadedSearches\t\t= {};\n\t\tthis.userOptions\t\t= {};\n\t\tthis.clearCache();\n\t\tvar selected:TomOptions\t= {};\n\t\tfor( let key in this.options){\n    \t\tif( this.options.hasOwnProperty(key) && this.items.indexOf(key) >= 0 ){\n\t\t\t\tselected[key] = this.options[key];\n\t\t\t}\n\t\t}\n\n\t\tthis.options = this.sifter.items = selected;\n\t\tthis.lastQuery = null;\n\t\tthis.trigger('option_clear');\n\t}\n\n\t/**\n\t * Returns the dom element of the option\n\t * matching the given value.\n\t *\n\t * @returns {object}\n\t */\n\tgetOption(value:string) {\n\n\t\t// cached ?\n\t\tif( this.renderCache['option'].hasOwnProperty(value) ){\n\t\t\treturn this.renderCache['option'][value];\n\t\t}\n\n\t\t// from existing dropdown menu dom\n\t\treturn this.getElementWithValue(value, this.selectable());\n\t}\n\n\t/**\n\t * Returns the dom element of the next or previous dom element of the same type\n\t *\n\t */\n\tgetAdjacent( option:HTMLElement, direction:number, type:string = 'option' ) : HTMLElement|void{\n\n\t\tif( !option ){\n\t\t\treturn;\n\t\t}\n\n\t\tvar self\t\t= this;\n\t\tvar type_class\t= self.settings.optionClass;\n\t\tvar parent\t\t= self.dropdown;\n\n\t\tif( type == 'item' ){\n\t\t\tparent\t\t= self.control;\n\t\t\ttype_class\t= self.settings.itemClass;\n\t\t}\n\n\t\tvar all\t\t\t= parent.querySelectorAll('.'+type_class);\n\t\tfor( let i = 0; i < all.length; i++ ){\n\t\t\tif( all[i] != option ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif( direction > 0 ){\n\t\t\t\treturn all[i+1] as HTMLElement;\n\t\t\t}\n\n\t\t\treturn all[i-1] as HTMLElement;\n\t\t}\n\t}\n\n\t/**\n\t * Finds the first element with a \"data-value\" attribute\n\t * that matches the given value.\n\t *\n\t */\n\tgetElementWithValue(value:string, els:HTMLCollection|NodeList|HTMLElement[]):HTMLElement {\n\t\tvalue = hash_key(value);\n\n\t\tif (typeof value !== 'undefined' && value !== null) {\n\t\t\tfor (var i = 0, n = els.length; i < n; i++) {\n\t\t\t\tlet el = els[i] as HTMLElement;\n\t\t\t\tif (el.getAttribute('data-value') === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns the dom element of the item\n\t * matching the given value.\n\t *\n\t */\n\tgetItem(value:string):HTMLElement {\n\t\treturn this.getElementWithValue(value, this.control.children);\n\t}\n\n\t/**\n\t * \"Selects\" multiple items at once. Adds them to the list\n\t * at the current caret position.\n\t *\n\t */\n\taddItems( values:string|string[], silent?:boolean ):void{\n\t\tthis.buffer = document.createDocumentFragment();\n\n\t\tvar children = this.control.children;\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tthis.buffer.appendChild(children[i]);\n\t\t}\n\n\t\tvar items = Array.isArray(values) ? values : [values];\n\t\tfor (let i = 0, n = items.length; i < n; i++) {\n\t\t\tthis.isPending = (i < n - 1);\n\t\t\tthis.addItem(items[i], silent);\n\t\t}\n\n\t\tvar control = this.control;\n\t\tcontrol.insertBefore(this.buffer, control.firstChild);\n\n\t\tthis.buffer = null;\n\t}\n\n\t/**\n\t * \"Selects\" an item. Adds it to the list\n\t * at the current caret position.\n\t *\n\t */\n\taddItem( value:string, silent?:boolean ):void{\n\t\tvar events = silent ? [] : ['change'];\n\n\t\tdebounce_events(this, events, () => {\n\t\t\tvar item;\n\t\t\tvar self = this;\n\t\t\tvar inputMode = self.settings.mode;\n\t\t\tvar wasFull;\n\t\t\tvalue = hash_key(value);\n\n\t\t\tif( self.items.indexOf(value) !== -1 ){\n\n\t\t\t\tif( inputMode === 'single' ){\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\n\t\t\t\tif( inputMode === 'single' || !self.settings.duplicates ){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.options.hasOwnProperty(value)) return;\n\t\t\tif (inputMode === 'single') self.clear(silent);\n\t\t\tif (inputMode === 'multi' && self.isFull()) return;\n\n\t\t\titem = self.render('item', self.options[value]);\n\n\t\t\tif( self.control.contains(item) ){ // duplicates\n\t\t\t\titem = item.cloneNode(true) as HTMLElement;\n\t\t\t}\n\n\t\t\twasFull = self.isFull();\n\t\t\tself.items.splice(self.caretPos, 0, value);\n\t\t\tself.insertAtCaret(item);\n\n\t\t\tif (self.isSetup) {\n\t\t\t\tlet options = self.selectable();\n\n\t\t\t\t// update menu / remove the option (if this is not one item being added as part of series)\n\t\t\t\tif (!self.isPending) {\n\t\t\t\t\tlet option = self.getOption(value);\n\t\t\t\t\tlet next = self.getAdjacent(option, 1);\n\t\t\t\t\tself.refreshOptions(self.isFocused && inputMode !== 'single');\n\t\t\t\t\tif( next ){\n\t\t\t\t\t\tself.setActiveOption(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// hide the menu if the maximum number of items have been selected or no options are left\n\t\t\t\tif ( !options.length || self.isFull()) {\n\t\t\t\t\tself.close();\n\t\t\t\t} else if (!self.isPending) {\n\t\t\t\t\tself.positionDropdown();\n\t\t\t\t}\n\n\t\t\t\tself.trigger('item_add', value, item);\n\n\t\t\t\tif (!self.isPending) {\n\t\t\t\t\tself.updateOriginalInput({silent: silent});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.isPending || (!wasFull && self.isFull())) {\n\t\t\t\tself.refreshState();\n\t\t\t}\n\n\t\t});\n\t}\n\n\t/**\n\t * Removes the selected item matching\n\t * the provided value.\n\t *\n\t */\n\tremoveItem( value:string, silent?:boolean ){\n\t\tvar i, idx, self = this;\n\n\t\tvar item\t= self.getItem(value);\n\n\t\tif( !item ) return;\n\n\t\tvalue\t\t= hash_key(item.dataset.value);\n\t\ti\t\t\t= self.items.indexOf(value);\n\n\t\tif (i !== -1) {\n\t\t\titem.remove();\n\t\t\tif( item.classList.contains('active') ){\n\t\t\t\tidx = self.activeItems.indexOf(item);\n\t\t\t\tself.activeItems.splice(idx, 1);\n\t\t\t\tremoveClasses(item,'active');\n\t\t\t}\n\n\t\t\tself.items.splice(i, 1);\n\t\t\tself.lastQuery = null;\n\t\t\tif (!self.settings.persist && self.userOptions.hasOwnProperty(value)) {\n\t\t\t\tself.removeOption(value, silent);\n\t\t\t}\n\n\t\t\tif (i < self.caretPos) {\n\t\t\t\tself.setCaret(self.caretPos - 1);\n\t\t\t}\n\n\t\t\tself.updateOriginalInput({silent: silent});\n\t\t\tself.refreshState();\n\t\t\tself.positionDropdown();\n\t\t\tself.trigger('item_remove', value, item);\n\t\t}\n\t}\n\n\t/**\n\t * Invokes the `create` method provided in the\n\t * TomSelect options that should provide the data\n\t * for the new item, given the user input.\n\t *\n\t * Once this completes, it will be added\n\t * to the item list.\n\t *\n\t */\n\tcreateItem( input?:string, triggerDropdown:boolean=true, callback?:TomCreateCallback ):boolean{\n\t\tvar self  = this;\n\t\tvar caret = self.caretPos;\n\t\tvar output;\n\t\tinput = input || self.inputValue();\n\n\t\tif (typeof callback !== 'function') callback = () => {};\n\n\t\tif (!self.canCreate(input)) {\n\t\t\tcallback();\n\t\t\treturn false;\n\t\t}\n\n\t\tself.lock();\n\n\t\tvar created = false;\n\t\tvar create = (data:TomOption) => {\n\t\t\tself.unlock();\n\n\t\t\tif (!data || typeof data !== 'object') return callback();\n\t\t\tvar value = hash_key(data[self.settings.valueField]);\n\t\t\tif( typeof value !== 'string' ){\n\t\t\t\treturn callback();\n\t\t\t}\n\n\t\t\tself.setTextboxValue('');\n\t\t\tself.addOption(data);\n\t\t\tself.setCaret(caret);\n\t\t\tself.addItem(value);\n\t\t\tself.refreshOptions(triggerDropdown && self.settings.mode !== 'single');\n\t\t\tcallback(data);\n\t\t\tcreated = true;\n\t\t};\n\n\t\tif( typeof self.settings.create === 'function' ){\n\t\t\toutput = self.settings.create.call(this, input, create);\n\t\t}else{\n\t\t\toutput = {\n\t\t\t\t[self.settings.labelField]: input,\n\t\t\t\t[self.settings.valueField]: input,\n\t\t\t};\n\t\t}\n\n\t\tif( !created ){\n\t\t\tcreate(output);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Re-renders the selected item lists.\n\t */\n\trefreshItems() {\n\t\tvar self = this;\n\t\tself.lastQuery = null;\n\n\t\tif (self.isSetup) {\n\t\t\tself.addItems(self.items);\n\t\t}\n\n\t\tself.updateOriginalInput();\n\t\tself.refreshState();\n\t}\n\n\t/**\n\t * Updates all state-dependent attributes\n\t * and CSS classes.\n\t */\n\trefreshState() {\n\t\tvar self     = this;\n\n\t\tself.refreshValidityState();\n\n\t\tvar isFull   = self.isFull();\n\n\t\tvar isLocked = self.isLocked;\n\n\t\tself.wrapper.classList.toggle('rtl',self.rtl);\n\n\t\tvar classList = self.control.classList;\n\n\t\tclassList.toggle('focus', self.isFocused)\n\t\tclassList.toggle('disabled', self.isDisabled)\n\t\tclassList.toggle('required', self.isRequired)\n\t\tclassList.toggle('invalid', self.isInvalid)\n\t\tclassList.toggle('locked', isLocked)\n\t\tclassList.toggle('full', isFull)\n\t\tclassList.toggle('not-full', !isFull)\n\t\tclassList.toggle('input-active', self.isFocused && !self.isInputHidden)\n\t\tclassList.toggle('dropdown-active', self.isOpen)\n\t\tclassList.toggle('has-options', isEmptyObject(self.options) )\n\t\tclassList.toggle('has-items', self.items.length > 0);\n\n\t}\n\n\n\t/**\n\t * Update the `required` attribute of both input and control input.\n\t *\n\t * The `required` property needs to be activated on the control input\n\t * for the error to be displayed at the right place. `required` also\n\t * needs to be temporarily deactivated on the input since the input is\n\t * hidden and can't show errors.\n\t */\n\trefreshValidityState() {\n\t\tvar self = this;\n\n\t\tif( !self.input.checkValidity ){\n\t\t\treturn;\n\t\t}\n\n\t\t// if required, make sure the input required attribute = true so checkValidity() will work\n\t\tif( this.isRequired ){\n\t\t\tself.input.required = true;\n\t\t}\n\n\t\tvar invalid = !self.input.checkValidity();\n\n\t\tself.isInvalid = invalid;\n\t\tself.control_input.required = invalid;\n\n\t\tif( this.isRequired ){\n\t\t\tself.input.required = !invalid;\n\t\t}\n\t}\n\n\t/**\n\t * Determines whether or not more items can be added\n\t * to the control without exceeding the user-defined maximum.\n\t *\n\t * @returns {boolean}\n\t */\n\tisFull() {\n\t\treturn this.settings.maxItems !== null && this.items.length >= this.settings.maxItems;\n\t}\n\n\t/**\n\t * Refreshes the original <select> or <input>\n\t * element to reflect the current state.\n\t *\n\t */\n\tupdateOriginalInput(opts:TomArgObject = {}) {\n\t\tvar i, n, options, label, self = this;\n\n\t\tif( self.is_select_tag ){\n\t\t\toptions = [];\n\t\t\tfor (i = 0, n = self.items.length; i < n; i++) {\n\t\t\t\tlabel = self.options[self.items[i]][self.settings.labelField] || '';\n\t\t\t\toptions.push('<option value=\"' + escape_html(self.items[i]) + '\" selected=\"selected\">' + escape_html(label) + '</option>');\n\t\t\t}\n\t\t\tif (!options.length && !this.input.hasAttribute('multiple')) {\n\t\t\t\toptions.push('<option value=\"\" selected=\"selected\"></option>');\n\t\t\t}\n\t\t\tself.input.innerHTML = options.join('');\n\t\t} else {\n\t\t\tself.input.value = self.getValue() as string;\n\t\t\tself.input.setAttribute('value',self.input.value);\n\t\t}\n\n\t\tif (self.isSetup) {\n\t\t\tif (!opts.silent) {\n\t\t\t\tself.trigger('change', self.input.value );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Shows the autocomplete dropdown containing\n\t * the available options.\n\t */\n\topen() {\n\t\tvar self = this;\n\n\t\tif (self.isLocked || self.isOpen || (self.settings.mode === 'multi' && self.isFull())) return;\n\t\tself.focus();\n\t\tself.isOpen = true;\n\t\tself.refreshState();\n\t\tapplyCSS(self.dropdown,{visibility: 'hidden', display: 'block'});\n\t\tself.positionDropdown();\n\t\tapplyCSS(self.dropdown,{visibility: 'visible', display: 'block'});\n\t\tself.trigger('dropdown_open', self.dropdown);\n\t}\n\n\t/**\n\t * Closes the autocomplete dropdown menu.\n\t */\n\tclose() {\n\t\tvar self = this;\n\t\tvar trigger = self.isOpen;\n\n\t\tif (self.settings.mode === 'single' && self.items.length) {\n\t\t\tself.hideInput();\n\n\t\t\t// Do not trigger blur while inside a blur event,\n\t\t\t// this fixes some weird tabbing behavior in FF and IE.\n\t\t\t// See #selectize.js#1164\n\t\t\tif( !self.tab_key ){\n\t\t\t\tself.blur(); // close keyboard on iOS\n\t\t\t}\n\t\t}\n\n\t\tself.isOpen = false;\n\t\tapplyCSS(self.dropdown,{display: 'none'});\n\t\tself.setActiveOption();\n\t\tself.refreshState();\n\n\t\tif (trigger) self.trigger('dropdown_close', self.dropdown);\n\t}\n\n\t/**\n\t * Calculates and applies the appropriate\n\t * position of the dropdown if dropdownParent = 'body'.\n\t * Otherwise, position is determined by css\n\t */\n\tpositionDropdown(){\n\n\t\tif( this.settings.dropdownParent !== 'body' ){\n\t\t\treturn;\n\t\t}\n\n\t\tvar context\t\t\t= this.control;\n\t\tvar rect\t\t\t= context.getBoundingClientRect();\n\t\tvar top\t\t\t\t= context.offsetHeight + rect.top  + window.scrollY;\n\t\tvar left\t\t\t= rect.left + window.scrollX;\n\n\n\t\tapplyCSS(this.dropdown,{\n\t\t\twidth : rect.width + 'px',\n\t\t\ttop   : top + 'px',\n\t\t\tleft  : left + 'px'\n\t\t});\n\n\t}\n\n\t/**\n\t * Resets / clears all selected items\n\t * from the control.\n\t *\n\t */\n\tclear(silent:boolean) {\n\t\tvar self = this;\n\n\t\tif (!self.items.length) return;\n\n\t\tvar items = self.controlChildren();\n\t\tfor( let i = 0; i < items.length; i++){\n\t\t\titems[i].remove();\n\t\t}\n\n\t\tself.items = [];\n\t\tself.lastQuery = null;\n\t\tself.setCaret(0);\n\t\tself.setActiveItem();\n\t\tself.updateOriginalInput({silent: silent});\n\t\tself.refreshState();\n\t\tself.showInput();\n\t\tself.trigger('clear');\n\t}\n\n\t/**\n\t * A helper method for inserting an element\n\t * at the current caret position.\n\t *\n\t */\n\tinsertAtCaret(el:HTMLElement) {\n\t\tvar self = this;\n\t\tvar caret\t= Math.min(self.caretPos, self.items.length);\n\t\tvar target\t= self.buffer || self.control;\n\n\t\tif (caret === 0) {\n\t\t\ttarget.insertBefore(el, target.firstChild);\n\t\t} else {\n\t\t\ttarget.insertBefore(el, target.children[caret]);\n\t\t}\n\n\t\tself.setCaret(caret + 1);\n\t}\n\n\t/**\n\t * Removes the current selected item(s).\n\t *\n\t */\n\tdeleteSelection(e:KeyboardEvent):boolean {\n\t\tvar i, n, direction, selection, values, caret, tail;\n\t\tvar self = this;\n\n\t\tdirection = (e && e.keyCode === constants.KEY_BACKSPACE) ? -1 : 1;\n\t\tselection = getSelection(self.control_input);\n\n\n\t\t// determine items that will be removed\n\t\tvalues = [];\n\n\t\tif (self.activeItems.length) {\n\n\t\t\ttail = getTail(self.activeItems, direction);\n\t\t\tcaret = nodeIndex(tail);\n\n\t\t\tif (direction > 0) { caret++; }\n\n\t\t\tfor (i = 0, n = self.activeItems.length; i < n; i++) {\n\t\t\t\tvalues.push( self.activeItems[i].dataset.value );\n\t\t\t}\n\t\t\tpreventDefault(e,true);\n\n\t\t} else if ((self.isFocused || self.settings.mode === 'single') && self.items.length) {\n\t\t\tif (direction < 0 && selection.start === 0 && selection.length === 0) {\n\t\t\t\tvalues.push(self.items[self.caretPos - 1]);\n\t\t\t} else if (direction > 0 && selection.start === self.inputValue().length) {\n\t\t\t\tvalues.push(self.items[self.caretPos]);\n\t\t\t}\n\t\t}\n\n\t\t// allow the callback to abort\n\t\tif (!values.length || (typeof self.settings.onDelete === 'function' && self.settings.onDelete.call(self,values,e) === false)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// perform removal\n\t\tif (typeof caret !== 'undefined') {\n\t\t\tself.setCaret(caret);\n\t\t}\n\t\twhile (values.length) {\n\t\t\tself.removeItem(values.pop());\n\t\t}\n\n\t\tself.showInput();\n\t\tself.positionDropdown();\n\t\tself.refreshOptions(false);\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Selects the previous / next item (depending on the `direction` argument).\n\t *\n\t * > 0 - right\n\t * < 0 - left\n\t *\n\t */\n\tadvanceSelection(direction:number, e?:MouseEvent|KeyboardEvent) {\n\t\tvar idx, last_active, self = this;\n\n\t\tif (direction === 0) return;\n\t\tif (self.rtl) direction *= -1;\n\n\n\t\t// add or remove to active items\n\t\tif( isKeyDown(constants.KEY_SHORTCUT,e) || isKeyDown('shiftKey',e) ){\n\n\t\t\tlast_active\t\t\t= self.getLastActive(direction);\n\t\t\tlet adjacent\t\t= self.getAdjacent(last_active,direction,'item');\n\t\t\tif( adjacent ){\n\t\t\t\tif( adjacent.classList.contains('active') ){\n\t\t\t\t\tself.removeActiveItem(last_active);\n\t\t\t\t}\n\t\t\t\tself.setActiveItemClass(adjacent); // mark as last_active !! after removeActiveItem() on last_active\n\t\t\t}\n\n\t\t// move caret to the left or right\n\t\t}else if (self.isFocused && !self.isInputHidden) {\n\n\t\t\tif( !self.inputValue().length ){\n\t\t\t\tself.setCaret(self.caretPos + direction);\n\t\t\t}\n\n\t\t// move caret before or after selected items\n\t\t} else {\n\n\t\t\tlast_active\t\t= self.getLastActive(direction);\n\t\t\tif( last_active ){\n\t\t\t\tidx = nodeIndex(last_active);\n\t\t\t\tself.setCaret(direction > 0 ? idx + 1: idx);\n\t\t\t\tself.setActiveItem();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get the last active item\n\t *\n\t */\n\tgetLastActive(direction?:number){\n\n\t\tlet last_active = this.control.querySelector('.last-active');\n\t\tif( last_active ){\n\t\t\treturn last_active;\n\t\t}\n\n\n\t\tvar result = this.control.querySelectorAll('.active');\n\t\tif( result ){\n\t\t\treturn getTail(result,direction);\n\t\t}\n\t}\n\n\n\t/**\n\t * Moves the caret to the specified index.\n\t *\n\t */\n\tsetCaret(i:number) {\n\t\tvar self = this;\n\n\t\tif( self.settings.mode === 'single' || self.settings.controlInput ) {\n\t\t\ti = self.items.length;\n\t\t} else {\n\t\t\ti = Math.max(0, Math.min(self.items.length, i));\n\t\t}\n\n\t\tif (!self.settings.controlInput && !self.isPending) {\n\t\t\t// the input must be moved by leaving it in place and moving the\n\t\t\t// siblings, due to the fact that focus cannot be restored once lost\n\t\t\t// on mobile webkit devices\n\t\t\tvar j, child,\n\t\t\tchildren = self.controlChildren(),\n\t\t\tn = children.length;\n\n\t\t\tfor( j = 0; j < n; j++ ){\n\t\t\t\tchild = children[j];\n\n\t\t\t\tif( j < i ){\n\t\t\t\t\tself.control_input.insertAdjacentElement('beforebegin', child );\n\t\t\t\t} else {\n\t\t\t\t\tself.control.appendChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tself.caretPos = i;\n\t}\n\n\t/**\n\t * Return list of item dom elements\n\t *\n\t */\n\tcontrolChildren(){\n\t\treturn Array.prototype.filter.call( this.control.children, (node:HTMLElement) => node.nodeName !== 'INPUT' );\n\t}\n\n\t/**\n\t * Disables user input on the control. Used while\n\t * items are being asynchronously created.\n\t */\n\tlock() {\n\t\tthis.close();\n\t\tthis.isLocked = true;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Re-enables user input on the control.\n\t */\n\tunlock() {\n\t\tthis.isLocked = false;\n\t\tthis.refreshState();\n\t}\n\n\t/**\n\t * Disables user input on the control completely.\n\t * While disabled, it cannot receive focus.\n\t */\n\tdisable() {\n\t\tvar self = this;\n\t\tself.input.disabled\t\t\t\t= true;\n\t\tself.control_input.disabled\t\t= true;\n\t\tself.control_input.tabIndex\t\t= -1;\n\t\tself.isDisabled\t\t\t\t\t= true;\n\t\tself.lock();\n\t}\n\n\t/**\n\t * Enables the control so that it can respond\n\t * to focus and user input.\n\t */\n\tenable() {\n\t\tvar self = this;\n\t\tself.input.disabled\t\t\t\t= false;\n\t\tself.control_input.disabled\t\t= false;\n\t\tself.control_input.tabIndex\t\t= self.tabIndex;\n\t\tself.isDisabled\t\t\t\t\t= false;\n\t\tself.unlock();\n\t}\n\n\t/**\n\t * Completely destroys the control and\n\t * unbinds all event listeners so that it can\n\t * be garbage collected.\n\t */\n\tdestroy() {\n\t\tvar self = this;\n\t\tvar revertSettings = self.revertSettings;\n\n\t\tself.trigger('destroy');\n\t\tself.off();\n\t\tself.wrapper.remove();\n\t\tself.dropdown.remove();\n\n\t\tself.input.innerHTML = '';\n\t\tif( revertSettings.tabindex ){\n\t\t\tself.input.setAttribute('tabindex', revertSettings.tabindex );\n\t\t}else{\n\t\t\tself.input.removeAttribute('tabindex' );\n\t\t}\n\n\t\tremoveClasses(self.input,'tomselected');\n\t\tself.input.removeAttribute('hidden');\n\t\tself.input.required = this.isRequired;\n\n\t\tfor( let i = 0; i < revertSettings.children.length; i++ ){\n\t\t\tself.input.appendChild( revertSettings.children[i] );\n\t\t}\n\n\t\tself._destroy();\n\n\t\tdelete self.input.tomselect;\n\t}\n\n\t/**\n\t * A helper method for rendering \"item\" and\n\t * \"option\" templates, given the data.\n\t *\n\t */\n\trender( templateName:string, data?:any ):null|HTMLElement{\n\t\tvar value, id, html;\n\t\tvar self = this;\n\n\t\tif (templateName === 'option' || templateName === 'item') {\n\t\t\tvalue = hash_key(data[self.settings.valueField]);\n\n\t\t\t// pull markup from cache if it exists\n\t\t\tif( self.renderCache[templateName].hasOwnProperty(value) ){\n\t\t\t\treturn self.renderCache[templateName][value];\n\t\t\t}\n\n\t\t}\n\n\n\t\t// render markup\n\t\thtml = self.settings.render[templateName].call(this, data, escape_html);\n\n\t\tif( !html ){\n\t\t\treturn html;\n\t\t}\n\n\t\thtml = getDom( html );\n\n\t\t// add mandatory attributes\n\t\tif (templateName === 'option' || templateName === 'option_create') {\n\t\t\tif (!data[self.settings.disabledField]) {\n\t\t\t\thtml.setAttribute('data-selectable', '');\n\t\t\t}\n\n\t\t}else if (templateName === 'optgroup') {\n\t\t\tid = data.group[self.settings.optgroupValueField];\n\t\t\thtml.setAttribute('data-group', id);\n\t\t\tif(data.group[self.settings.disabledField]) {\n\t\t\t\thtml.setAttribute('data-disabled', '');\n\t\t\t}\n\t\t}\n\n\t\tif (templateName === 'option' || templateName === 'item') {\n\t\t\thtml.setAttribute('data-value', value );\n\n\t\t\t// make sure we have some classes if a template is overwritten\n\t\t\tif( templateName === 'item' ){\n\t\t\t\taddClasses(html,self.settings.itemClass);\n\t\t\t}else{\n\t\t\t\taddClasses(html,self.settings.optionClass);\n\t\t\t}\n\n\t\t\t// update cache\n\t\t\tself.renderCache[templateName][value] = html;\n\n\t\t}\n\n\t\treturn html;\n\t}\n\n\t/**\n\t * Clears the render cache for a template. If\n\t * no template is given, clears all render\n\t * caches.\n\t *\n\t */\n\tclearCache( templateName?:'item'|'option' ){\n\t\tvar self = this;\n\n\t\tif (templateName === void 0) {\n\t\t\tself.renderCache = {'item':{},'option':{}};\n\t\t} else {\n\t\t\tself.renderCache[templateName] = {};\n\t\t}\n\t}\n\n\t/**\n\t * Determines whether or not to display the\n\t * create item prompt, given a user input.\n\t *\n\t */\n\tcanCreate( input:string ):boolean {\n\t\treturn this.settings.create && input.length && (this.settings.createFilter as TomCreateFilter ).call(this, input);\n\t}\n\n\n\t/**\n\t * Wraps this.`method` so that `new_fn` can be invoked 'before', 'after', or 'instead' of the original method\n\t *\n\t * this.hook('instead','onKeyDown',function( arg1, arg2 ...){\n\t *\n\t * });\n\t */\n\thook( when:string, method:string, new_fn:()=>any ){\n\t\tvar self = this;\n\t\tvar orig_method = self[method];\n\n\n\t\tself[method] = function(){\n\t\t\tvar result, result_new;\n\n\t\t\tif( when === 'after' ){\n\t\t\t\tresult = orig_method.apply(self, arguments);\n\t\t\t}\n\n\t\t\tresult_new = new_fn.apply(self, arguments );\n\n\t\t\tif( when === 'instead' ){\n\t\t\t\treturn result_new;\n\t\t\t}\n\n\t\t\tif( when === 'before' ){\n\t\t\t\tresult = orig_method.apply(self, arguments);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\n\t}\n\n};\n"],"names":["TomSelect","MicroPlugin","MicroEvent","constructor","input","settings","dir","getDom","tomselect","Error","computedStyle","window","getComputedStyle","getPropertyValue","order","getSettings","tabIndex","getAttribute","is_select_tag","tagName","toLowerCase","rtl","test","tab_key","isOpen","isDisabled","isRequired","required","isInvalid","isLocked","isFocused","isInputHidden","isSetup","ignoreFocus","ignoreBlur","ignoreHover","hasOptions","currentResults","lastValue","caretPos","loading","loadedSearches","activeOption","activeItems","optgroups","options","userOptions","items","renderCache","load","loadThrottle","loadDebounce","sifter","Sifter","diacritics","setupOptions","mode","maxItems","hideSelected","filter","createFilter","RegExp","initializePlugins","plugins","setupCallbacks","setupTemplates","setup","self","wrapper","control","control_input","dropdown","dropdown_content","inputMode","classes","classes_plugins","inputId","passive_event","passive","addClasses","wrapperClass","inputClass","append","render","dropdownClass","dropdownContentClass","dropdownParent","appendChild","controlInput","attrs","i","length","attr","setAttribute","disabled","query","escapeQuery","label","document","querySelector","copyClassesToDropdown","style","width","names","join","placeholder","splitOn","delimiter","delimiterEscaped","replace","type","addEvent","e","target_match","parentMatch","target","onOptionHover","capture","evt","itemClass","onItemSelect","onMouseDown","onClick","stopPropagation","onKeyDown","onKeyUp","onKeyPress","positionDropdown","onBlur","onFocus","onPaste","doc_mousedown","option","contains","blur","preventDefault","onOptionSelect","win_scroll","win_hover","_destroy","removeEventListener","children","push","remove","revertSettings","tabindex","insertAdjacentElement","setValue","refreshState","updateOriginalInput","refreshItems","disable","on","onChange","trigger","preload","n","registerOption","registerOptionGroup","field_label","labelField","field_optgroup","optgroupLabelField","templates","data","escape","optgroup","createElement","className","Object","assign","key","fn","callbacks","focus","close","open","setActiveItem","setTimeout","triggerEvent","isFull","pastedText","inputValue","match","splitInput","trim","split","createItem","character","String","fromCharCode","keyCode","which","create","constants","isKeyDown","selectAll","next","getAdjacent","setActiveOption","prev","advanceSelection","selectOnTab","deleteSelection","value","refreshOptions","wasFocused","showInput","openOnFocus","dest","activeElement","deactivate","setCaret","createOnBlur","parentElement","matches","classList","closeAfterSelect","dataset","lastQuery","addItem","getOption","item","hasOwnProperty","loadingClass","call","Math","max","removeClasses","onSearchChange","setTextboxValue","changed","getValue","hasAttribute","silent","events","debounce_events","clear","addItems","setMaxItems","eventName","begin","end","swap","last","getLastActive","Array","prototype","indexOf","setActiveItemClass","removeActiveItem","hideInput","last_active","idx","splice","scroll","height_menu","height_item","y","clientHeight","scrollTop","offsetHeight","getBoundingClientRect","top","controlChildren","applyCSS","opacity","position","left","getScoreFunction","getSearchOptions","sort","sortField","field","fields","searchField","conjunction","searchConjunction","nesting","search","result","calculateScore","score","hash_key","id","triggerDropdown","j","k","groups","groups_order","html","has_create_option","active","results","active_before_hash","show_dropdown","maxOptions","min","opt_value","valueField","option_el","optgroupField","isArray","createDocumentFragment","cloneNode","lockOptgroupOrder","a","b","a_order","$order","b_order","group_options","group_html","group","innerHTML","highlight","removeHighlight","tokens","regex","add_template","template","content","insertBefore","firstChild","canCreate","active_index","addPrecedence","selectable","querySelectorAll","addOption","optgroupValueField","addOptionGroup","hashed_id","removeOptionGroup","clearCache","clearOptionGroups","updateOption","item_new","value_new","index_item","cache_items","cache_options","order_old","getItem","parentNode","removeOption","removeItem","clearOptions","selected","getElementWithValue","direction","type_class","optionClass","parent","all","els","el","values","buffer","isPending","wasFull","duplicates","insertAtCaret","persist","callback","caret","output","lock","created","unlock","refreshValidityState","toggle","isEmptyObject","checkValidity","invalid","opts","escape_html","visibility","display","context","rect","scrollY","scrollX","selection","tail","getSelection","getTail","nodeIndex","start","onDelete","pop","adjacent","child","node","nodeName","enable","destroy","off","removeAttribute","templateName","disabledField","hook","when","method","new_fn","orig_method","result_new","apply","arguments"],"mappings":"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"}