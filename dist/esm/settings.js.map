{"version":3,"file":"settings.js","sources":["../../src/settings.ts"],"sourcesContent":["import defaults from './defaults.js';\nimport { hash_key } from './utils';\nimport { TomSettings } from './types/settings';\n\nexport default function getSettings( input:HTMLInputElement, settings_user:TomSettings):TomSettings{\n\tvar settings\t\t\t\t= Object.assign({}, defaults, settings_user);\n\n\tvar attr_data\t\t\t\t= settings.dataAttr;\n\tvar field_label\t\t\t\t= settings.labelField;\n\tvar field_value\t\t\t\t= settings.valueField;\n\tvar field_disabled\t\t\t= settings.disabledField;\n\tvar field_optgroup\t\t\t= settings.optgroupField;\n\tvar field_optgroup_label\t= settings.optgroupLabelField;\n\tvar field_optgroup_value\t= settings.optgroupValueField;\n\n\tvar tag_name\t\t\t\t= input.tagName.toLowerCase();\n\tvar placeholder\t\t\t\t= input.getAttribute('placeholder') || input.getAttribute('data-placeholder');\n\n\tif (!placeholder && !settings.allowEmptyOption) {\n\t\tlet option\t\t= input.querySelector('option[value=\"\"]');\n\t\tif( option ){\n\t\t\tplaceholder = option.textContent;\n\t\t}\n\n\t}\n\n\tvar settings_element\t\t= {\n\t\t\t\t\t\t\t\t\t\tplaceholder\t: placeholder,\n\t\t\t\t\t\t\t\t\t\toptions\t\t: [],\n\t\t\t\t\t\t\t\t\t\toptgroups\t: [],\n\t\t\t\t\t\t\t\t\t\titems\t\t: [],\n\t\t\t\t\t\t\t\t\t\tmaxItems\t: null,\n\t\t\t\t\t\t\t\t\t};\n\n\n\t/**\n\t * Initialize from a <select> element.\n\t *\n\t */\n\tvar init_select = () => {\n\t\tvar i, n, tagName, children;\n\t\tvar options = settings_element.options;\n\t\tvar optionsMap = {};\n\n\t\tvar readData = (el) => {\n\n\t\t\tvar data\t= Object.assign({},el.dataset); // get plain object from DOMStringMap\n\t\t\tvar json\t= attr_data && data[attr_data];\n\n\t\t\tif( typeof json === 'string' && json.length ){\n\t\t\t\tdata = Object.assign(data,JSON.parse(json));\n\t\t\t}\n\n\t\t\treturn data;\n\t\t};\n\n\t\tvar addOption = (option, group?:string) => {\n\n\t\t\tvar value = hash_key(option.value);\n\t\t\tif (!value && !settings.allowEmptyOption) return;\n\n\t\t\t// if the option already exists, it's probably been\n\t\t\t// duplicated in another optgroup. in this case, push\n\t\t\t// the current group to the \"optgroup\" property on the\n\t\t\t// existing option so that it's rendered in both places.\n\t\t\tif (optionsMap.hasOwnProperty(value)) {\n\t\t\t\tif (group) {\n\t\t\t\t\tvar arr = optionsMap[value][field_optgroup];\n\t\t\t\t\tif (!arr) {\n\t\t\t\t\t\toptionsMap[value][field_optgroup] = group;\n\t\t\t\t\t} else if (!Array.isArray(arr)) {\n\t\t\t\t\t\toptionsMap[value][field_optgroup] = [arr, group];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tarr.push(group);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar option_data             = readData(option);\n\t\t\toption_data[field_label]    = option_data[field_label] || option.textContent;\n\t\t\toption_data[field_value]    = option_data[field_value] || value;\n\t\t\toption_data[field_disabled] = option_data[field_disabled] || option.disabled;\n\t\t\toption_data[field_optgroup] = option_data[field_optgroup] || group;\n\n\t\t\toptionsMap[value] = option_data;\n\t\t\toptions.push(option_data);\n\n\t\t\tif( option.selected ){\n\t\t\t\tsettings_element.items.push(value);\n\t\t\t}\n\t\t};\n\n\t\tvar addGroup = ( optgroup ) => {\n\t\t\tvar i, n, id, optgroup_data, options;\n\n\t\t\tid = optgroup.getAttribute('label')\n\n\t\t\tif (id) {\n\t\t\t\toptgroup_data\t\t\t\t\t\t\t= readData(optgroup);\n\t\t\t\toptgroup_data[field_optgroup_label]\t\t= id;\n\t\t\t\toptgroup_data[field_optgroup_value]\t\t= id;\n\t\t\t\toptgroup_data[field_disabled]\t\t\t= optgroup.disabled;\n\t\t\t\tsettings_element.optgroups.push(optgroup_data);\n\t\t\t}\n\n\t\t\tvar options = optgroup.children;\n\t\t\tfor (i = 0, n = options.length; i < n; i++) {\n\t\t\t\taddOption(options[i], id);\n\t\t\t}\n\t\t};\n\n\t\tsettings_element.maxItems = input.hasAttribute('multiple') ? null : 1;\n\n\t\tchildren = input.children;\n\t\tfor (i = 0, n = children.length; i < n; i++) {\n\t\t\ttagName = children[i].tagName.toLowerCase();\n\t\t\tif (tagName === 'optgroup') {\n\t\t\t\taddGroup(children[i]);\n\t\t\t} else if (tagName === 'option') {\n\t\t\t\taddOption(children[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\n\t/**\n\t * Initialize from a <input type=\"text\"> element.\n\t *\n\t */\n\tvar init_textbox = () => {\n\t\tvar i, n, values, option;\n\n\t\tvar data_raw = input.getAttribute(attr_data);\n\n\t\tif (!data_raw) {\n\t\t\tvar value = input.value.trim() || '';\n\t\t\tif (!settings.allowEmptyOption && !value.length) return;\n\t\t\tvalues = value.split(settings.delimiter);\n\t\t\tfor (i = 0, n = values.length; i < n; i++) {\n\t\t\t\toption = {};\n\t\t\t\toption[field_label] = values[i];\n\t\t\t\toption[field_value] = values[i];\n\t\t\t\tsettings_element.options.push(option);\n\t\t\t}\n\t\t\tsettings_element.items = values;\n\t\t} else {\n\t\t\tsettings_element.options = JSON.parse(data_raw);\n\t\t\tfor (i = 0, n = settings_element.options.length; i < n; i++) {\n\t\t\t\tsettings_element.items.push(settings_element.options[i][field_value]);\n\t\t\t}\n\t\t}\n\t};\n\n\n\tif (tag_name === 'select') {\n\t\tinit_select();\n\t} else {\n\t\tinit_textbox();\n\t}\n\n\treturn Object.assign( {}, defaults, settings_element, settings_user) as TomSettings;\n};\n"],"names":["getSettings","input","settings_user","settings","Object","assign","defaults","attr_data","dataAttr","field_label","labelField","field_value","valueField","field_disabled","disabledField","field_optgroup","optgroupField","field_optgroup_label","optgroupLabelField","field_optgroup_value","optgroupValueField","tag_name","tagName","toLowerCase","placeholder","getAttribute","allowEmptyOption","option","querySelector","textContent","settings_element","options","optgroups","items","maxItems","init_select","i","n","children","optionsMap","readData","el","data","dataset","json","length","JSON","parse","addOption","group","value","hash_key","hasOwnProperty","arr","Array","isArray","push","option_data","disabled","selected","addGroup","optgroup","id","optgroup_data","hasAttribute","init_textbox","values","data_raw","trim","split","delimiter"],"mappings":";;;;;;;;AAIe,SAASA,WAAT,CAAsBC,KAAtB,EAA8CC,aAA9C,EAAoF;AAClG,MAAIC,QAAQ,GAAMC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBC,QAAlB,EAA4BJ,aAA5B,CAAlB;AAEA,MAAIK,SAAS,GAAMJ,QAAQ,CAACK,QAA5B;AACA,MAAIC,WAAW,GAAMN,QAAQ,CAACO,UAA9B;AACA,MAAIC,WAAW,GAAMR,QAAQ,CAACS,UAA9B;AACA,MAAIC,cAAc,GAAKV,QAAQ,CAACW,aAAhC;AACA,MAAIC,cAAc,GAAKZ,QAAQ,CAACa,aAAhC;AACA,MAAIC,oBAAoB,GAAGd,QAAQ,CAACe,kBAApC;AACA,MAAIC,oBAAoB,GAAGhB,QAAQ,CAACiB,kBAApC;AAEA,MAAIC,QAAQ,GAAMpB,KAAK,CAACqB,OAAN,CAAcC,WAAd,EAAlB;AACA,MAAIC,WAAW,GAAMvB,KAAK,CAACwB,YAAN,CAAmB,aAAnB,KAAqCxB,KAAK,CAACwB,YAAN,CAAmB,kBAAnB,CAA1D;;AAEA,MAAI,CAACD,WAAD,IAAgB,CAACrB,QAAQ,CAACuB,gBAA9B,EAAgD;AAC/C,QAAIC,MAAM,GAAI1B,KAAK,CAAC2B,aAAN,CAAoB,kBAApB,CAAd;;AACA,QAAID,MAAJ,EAAY;AACXH,MAAAA,WAAW,GAAGG,MAAM,CAACE,WAArB;AACA;AAED;;AAED,MAAIC,gBAAgB,GAAI;AACfN,IAAAA,WAAW,EAAGA,WADC;AAEfO,IAAAA,OAAO,EAAI,EAFI;AAGfC,IAAAA,SAAS,EAAG,EAHG;AAIfC,IAAAA,KAAK,EAAI,EAJM;AAKfC,IAAAA,QAAQ,EAAG;AALI,GAAxB;AASA;;;;;AAIA,MAAIC,WAAW,GAAG,MAAM;AACvB,QAAIC,CAAJ,EAAOC,CAAP,EAAUf,OAAV,EAAmBgB,QAAnB;AACA,QAAIP,OAAO,GAAGD,gBAAgB,CAACC,OAA/B;AACA,QAAIQ,UAAU,GAAG,EAAjB;;AAEA,QAAIC,QAAQ,GAAIC,EAAD,IAAQ;AAEtB,UAAIC,IAAI,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAiBoC,EAAE,CAACE,OAApB,CAAX,CAFsB;;AAGtB,UAAIC,IAAI,GAAGrC,SAAS,IAAImC,IAAI,CAACnC,SAAD,CAA5B;;AAEA,UAAI,OAAOqC,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,CAACC,MAArC,EAA6C;AAC5CH,QAAAA,IAAI,GAAGtC,MAAM,CAACC,MAAP,CAAcqC,IAAd,EAAmBI,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAnB,CAAP;AACA;;AAED,aAAOF,IAAP;AACA,KAVD;;AAYA,QAAIM,SAAS,GAAG,CAACrB,MAAD,EAASsB,KAAT,KAA2B;AAE1C,UAAIC,KAAK,GAAGC,QAAQ,CAACxB,MAAM,CAACuB,KAAR,CAApB;AACA,UAAI,CAACA,KAAD,IAAU,CAAC/C,QAAQ,CAACuB,gBAAxB,EAA0C,OAHA;AAM1C;AACA;AACA;;AACA,UAAIa,UAAU,CAACa,cAAX,CAA0BF,KAA1B,CAAJ,EAAsC;AACrC,YAAID,KAAJ,EAAW;AACV,cAAII,GAAG,GAAGd,UAAU,CAACW,KAAD,CAAV,CAAkBnC,cAAlB,CAAV;;AACA,cAAI,CAACsC,GAAL,EAAU;AACTd,YAAAA,UAAU,CAACW,KAAD,CAAV,CAAkBnC,cAAlB,IAAoCkC,KAApC;AACA,WAFD,MAEO,IAAI,CAACK,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAL,EAAyB;AAC/Bd,YAAAA,UAAU,CAACW,KAAD,CAAV,CAAkBnC,cAAlB,IAAoC,CAACsC,GAAD,EAAMJ,KAAN,CAApC;AACA,WAFM,MAEA;AACNI,YAAAA,GAAG,CAACG,IAAJ,CAASP,KAAT;AACA;AACD;;AACD;AACA;;AAED,UAAIQ,WAAW,GAAejB,QAAQ,CAACb,MAAD,CAAtC;AACA8B,MAAAA,WAAW,CAAChD,WAAD,CAAX,GAA8BgD,WAAW,CAAChD,WAAD,CAAX,IAA4BkB,MAAM,CAACE,WAAjE;AACA4B,MAAAA,WAAW,CAAC9C,WAAD,CAAX,GAA8B8C,WAAW,CAAC9C,WAAD,CAAX,IAA4BuC,KAA1D;AACAO,MAAAA,WAAW,CAAC5C,cAAD,CAAX,GAA8B4C,WAAW,CAAC5C,cAAD,CAAX,IAA+Bc,MAAM,CAAC+B,QAApE;AACAD,MAAAA,WAAW,CAAC1C,cAAD,CAAX,GAA8B0C,WAAW,CAAC1C,cAAD,CAAX,IAA+BkC,KAA7D;AAEAV,MAAAA,UAAU,CAACW,KAAD,CAAV,GAAoBO,WAApB;AACA1B,MAAAA,OAAO,CAACyB,IAAR,CAAaC,WAAb;;AAEA,UAAI9B,MAAM,CAACgC,QAAX,EAAqB;AACpB7B,QAAAA,gBAAgB,CAACG,KAAjB,CAAuBuB,IAAvB,CAA4BN,KAA5B;AACA;AACD,KAnCD;;AAqCA,QAAIU,QAAQ,GAAKC,QAAF,IAAgB;AAC9B,UAAIzB,CAAJ,EAAOC,CAAP,EAAUyB,EAAV,EAAcC,aAAd,EAA6BhC,OAA7B;AAEA+B,MAAAA,EAAE,GAAGD,QAAQ,CAACpC,YAAT,CAAsB,OAAtB,CAAL;;AAEA,UAAIqC,EAAJ,EAAQ;AACPC,QAAAA,aAAa,GAASvB,QAAQ,CAACqB,QAAD,CAA9B;AACAE,QAAAA,aAAa,CAAC9C,oBAAD,CAAb,GAAuC6C,EAAvC;AACAC,QAAAA,aAAa,CAAC5C,oBAAD,CAAb,GAAuC2C,EAAvC;AACAC,QAAAA,aAAa,CAAClD,cAAD,CAAb,GAAkCgD,QAAQ,CAACH,QAA3C;AACA5B,QAAAA,gBAAgB,CAACE,SAAjB,CAA2BwB,IAA3B,CAAgCO,aAAhC;AACA;;AAED,UAAIhC,OAAO,GAAG8B,QAAQ,CAACvB,QAAvB;;AACA,WAAKF,CAAC,GAAG,CAAJ,EAAOC,CAAC,GAAGN,OAAO,CAACc,MAAxB,EAAgCT,CAAC,GAAGC,CAApC,EAAuCD,CAAC,EAAxC,EAA4C;AAC3CY,QAAAA,SAAS,CAACjB,OAAO,CAACK,CAAD,CAAR,EAAa0B,EAAb,CAAT;AACA;AACD,KAjBD;;AAmBAhC,IAAAA,gBAAgB,CAACI,QAAjB,GAA4BjC,KAAK,CAAC+D,YAAN,CAAmB,UAAnB,IAAiC,IAAjC,GAAwC,CAApE;AAEA1B,IAAAA,QAAQ,GAAGrC,KAAK,CAACqC,QAAjB;;AACA,SAAKF,CAAC,GAAG,CAAJ,EAAOC,CAAC,GAAGC,QAAQ,CAACO,MAAzB,EAAiCT,CAAC,GAAGC,CAArC,EAAwCD,CAAC,EAAzC,EAA6C;AAC5Cd,MAAAA,OAAO,GAAGgB,QAAQ,CAACF,CAAD,CAAR,CAAYd,OAAZ,CAAoBC,WAApB,EAAV;;AACA,UAAID,OAAO,KAAK,UAAhB,EAA4B;AAC3BsC,QAAAA,QAAQ,CAACtB,QAAQ,CAACF,CAAD,CAAT,CAAR;AACA,OAFD,MAEO,IAAId,OAAO,KAAK,QAAhB,EAA0B;AAChC0B,QAAAA,SAAS,CAACV,QAAQ,CAACF,CAAD,CAAT,CAAT;AACA;AACD;AACD,GApFD;AAuFA;;;;;;AAIA,MAAI6B,YAAY,GAAG,MAAM;AACxB,QAAI7B,CAAJ,EAAOC,CAAP,EAAU6B,MAAV,EAAkBvC,MAAlB;AAEA,QAAIwC,QAAQ,GAAGlE,KAAK,CAACwB,YAAN,CAAmBlB,SAAnB,CAAf;;AAEA,QAAI,CAAC4D,QAAL,EAAe;AACd,UAAIjB,KAAK,GAAGjD,KAAK,CAACiD,KAAN,CAAYkB,IAAZ,MAAsB,EAAlC;AACA,UAAI,CAACjE,QAAQ,CAACuB,gBAAV,IAA8B,CAACwB,KAAK,CAACL,MAAzC,EAAiD;AACjDqB,MAAAA,MAAM,GAAGhB,KAAK,CAACmB,KAAN,CAAYlE,QAAQ,CAACmE,SAArB,CAAT;;AACA,WAAKlC,CAAC,GAAG,CAAJ,EAAOC,CAAC,GAAG6B,MAAM,CAACrB,MAAvB,EAA+BT,CAAC,GAAGC,CAAnC,EAAsCD,CAAC,EAAvC,EAA2C;AAC1CT,QAAAA,MAAM,GAAG,EAAT;AACAA,QAAAA,MAAM,CAAClB,WAAD,CAAN,GAAsByD,MAAM,CAAC9B,CAAD,CAA5B;AACAT,QAAAA,MAAM,CAAChB,WAAD,CAAN,GAAsBuD,MAAM,CAAC9B,CAAD,CAA5B;AACAN,QAAAA,gBAAgB,CAACC,OAAjB,CAAyByB,IAAzB,CAA8B7B,MAA9B;AACA;;AACDG,MAAAA,gBAAgB,CAACG,KAAjB,GAAyBiC,MAAzB;AACA,KAXD,MAWO;AACNpC,MAAAA,gBAAgB,CAACC,OAAjB,GAA2Be,IAAI,CAACC,KAAL,CAAWoB,QAAX,CAA3B;;AACA,WAAK/B,CAAC,GAAG,CAAJ,EAAOC,CAAC,GAAGP,gBAAgB,CAACC,OAAjB,CAAyBc,MAAzC,EAAiDT,CAAC,GAAGC,CAArD,EAAwDD,CAAC,EAAzD,EAA6D;AAC5DN,QAAAA,gBAAgB,CAACG,KAAjB,CAAuBuB,IAAvB,CAA4B1B,gBAAgB,CAACC,OAAjB,CAAyBK,CAAzB,EAA4BzB,WAA5B,CAA5B;AACA;AACD;AACD,GAtBD;;AAyBA,MAAIU,QAAQ,KAAK,QAAjB,EAA2B;AAC1Bc,IAAAA,WAAW;AACX,GAFD,MAEO;AACN8B,IAAAA,YAAY;AACZ;;AAED,SAAO7D,MAAM,CAACC,MAAP,CAAe,EAAf,EAAmBC,QAAnB,EAA6BwB,gBAA7B,EAA+C5B,aAA/C,CAAP;AACA;;;;"}