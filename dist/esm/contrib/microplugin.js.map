{"version":3,"file":"microplugin.js","sources":["../../../src/contrib/microplugin.js"],"sourcesContent":["/**\n * microplugin.js\n * Copyright (c) 2013 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\nexport default function MicroPlugin(Interface){\n\n\tInterface.plugins = {};\n\n\n\treturn class mixin extends Interface{\n\n\t\t/**\n\t\t * Registers a plugin.\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {function} fn\n\t\t */\n\t\tstatic define(name, fn){\n\t\t\tInterface.plugins[name] = {\n\t\t\t\t'name' : name,\n\t\t\t\t'fn'   : fn\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Initializes the listed plugins (with options).\n\t\t * Acceptable formats:\n\t\t *\n\t\t * List (without options):\n\t\t *   ['a', 'b', 'c']\n\t\t *\n\t\t * List (with options):\n\t\t *   [{'name': 'a', options: {}}, {'name': 'b', options: {}}]\n\t\t *\n\t\t * Hash (with options):\n\t\t *   {'a': { ... }, 'b': { ... }, 'c': { ... }}\n\t\t *\n\t\t * @param {array|object} plugins\n\t\t */\n\t\tinitializePlugins(plugins) {\n\t\t\tvar i, n, key;\n\t\t\tvar self  = this;\n\t\t\tvar queue = [];\n\n\t\t\tself.plugins = {\n\t\t\t\tnames     : [],\n\t\t\t\tsettings  : {},\n\t\t\t\trequested : {},\n\t\t\t\tloaded    : {}\n\t\t\t};\n\n\t\t\tif (Array.isArray(plugins)) {\n\t\t\t\tfor (i = 0, n = plugins.length; i < n; i++) {\n\t\t\t\t\tif (typeof plugins[i] === 'string') {\n\t\t\t\t\t\tqueue.push(plugins[i]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.plugins.settings[plugins[i].name] = plugins[i].options;\n\t\t\t\t\t\tqueue.push(plugins[i].name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (plugins) {\n\t\t\t\tfor (key in plugins) {\n\t\t\t\t\tif (plugins.hasOwnProperty(key)) {\n\t\t\t\t\t\tself.plugins.settings[key] = plugins[key];\n\t\t\t\t\t\tqueue.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (queue.length) {\n\t\t\t\tself.require(queue.shift());\n\t\t\t}\n\t\t}\n\n\t\tloadPlugin(name) {\n\t\t\tvar self    = this;\n\t\t\tvar plugins = self.plugins;\n\t\t\tvar plugin  = Interface.plugins[name];\n\n\t\t\tif (!Interface.plugins.hasOwnProperty(name)) {\n\t\t\t\tthrow new Error('Unable to find \"' +  name + '\" plugin');\n\t\t\t}\n\n\t\t\tplugins.requested[name] = true;\n\t\t\tplugins.loaded[name] = plugin.fn.apply(self, [self.plugins.settings[name] || {}]);\n\t\t\tplugins.names.push(name);\n\t\t}\n\n\t\t/**\n\t\t * Initializes a plugin.\n\t\t *\n\t\t * @param {string} name\n\t\t */\n\t\trequire(name) {\n\t\t\tvar self = this;\n\t\t\tvar plugins = self.plugins;\n\n\t\t\tif (!self.plugins.loaded.hasOwnProperty(name)) {\n\t\t\t\tif (plugins.requested[name]) {\n\t\t\t\t\tthrow new Error('Plugin has circular dependency (\"' + name + '\")');\n\t\t\t\t}\n\t\t\t\tself.loadPlugin(name);\n\t\t\t}\n\n\t\t\treturn plugins.loaded[name];\n\t\t}\n\n\t};\n\n}\n"],"names":["MicroPlugin","Interface","plugins","mixin","define","name","fn","initializePlugins","i","n","key","self","queue","names","settings","requested","loaded","Array","isArray","length","push","options","hasOwnProperty","require","shift","loadPlugin","plugin","Error","apply"],"mappings":"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"}