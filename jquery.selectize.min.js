/*! jquery.selectize.js | https://github.com/diy/jquery-selectize | Apache License (v2) */
(function(g,n,j){var q=function(a,b){if("string"!==typeof b||b.length){var c="string"===typeof b?RegExp(b,"i"):b,d=function(a){var b=0;if(3===a.nodeType){var h=a.data.search(c);if(0<=h&&0<a.data.length){var g=a.data.match(c),b=j.createElement("span");b.className="highlight";a=a.splitText(h);a.splitText(g[0].length);h=a.cloneNode(!0);b.appendChild(h);a.parentNode.replaceChild(b,a);b=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(h=0;h<a.childNodes.length;++h)h+=d(a.childNodes[h]);
return b};return a.each(function(){d(this)})}},k=function(a){return"undefined"!==typeof a},o=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},p=function(a){if("selectionStart"in a)return a.selectionStart;if(j.selection){a.focus();var b=j.selection.createRange(),c=j.selection.createRange().text.length;b.moveStart("character",-a.value.length);return b.text.length-c}};g.fn.selectize=function(a){a=a||{};return this.each(function(){var b=
g(this),c,d=b[0].tagName.toLowerCase();if("string"===typeof a)c=b.data("selectize"),c[a].apply(c,Array.prototype.splice.apply(arguments,1));else{c={};c.placeholder=b.attr("placeholder");c.options={};c.items=[];if("select"===d){c.maxItems=b.attr("multiple")?null:1;for(var e=b.children(),d=0;d<e.length;d++){var l=g(e[d]),h=l.attr("value")||"";if(h.length){var i=a.dataAttr&&l.attr(a.dataAttr)||{text:l.html(),value:h};"string"===typeof i&&(i=JSON.parse(i));c.options[h]=i;l.is(":selected")&&c.items.push(h)}}}else if(h=
g.trim(b.val()||""),h.length){e=h.split(a.delimiter||g.fn.selectize.defaults.delimiter);for(d=0;d<e.length;d++)c.options[e[d]]={text:e[d],value:e[d]};c.items=e}c=new f(b,g.extend(!0,{},g.fn.selectize.defaults,c,a));b.data("selectize",c);b.addClass("selectized")}})};var m={a:"[a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]",c:"[c\u00c7\u00e7]",e:"[e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb]",i:"[i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef]",n:"[n\u00d1\u00f1]",
o:"[o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8]",s:"[s\u0160\u0161]",u:"[u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc]",y:"[y\u0178\u00ff\u00fd]",z:"[z\u017d\u017e]"};g.fn.selectize.defaults={delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1E3,maxItems:null,scrollDuration:60,dataAttr:"data-data",sortField:"value",sortDirection:"asc",valueField:"value",labelField:"text",searchField:["text"],theme:"default",inputClass:"selectize-input",
dropdownClass:"selectize-dropdown",render:{item:null,option:null,option_create:null}};var f=function(a,b){this.$input=a;this.tagType="select"===a[0].tagName.toLowerCase()?1:2;this.settings=b;this.highlightedValue=null;this.hasOptions=this.isSetup=this.isInputFocused=this.isFocused=this.isFull=this.isOpen=!1;this.currentResults=null;this.lastValue="";this.$activeItem=this.$activeOption=null;this.options={};this.userOptions={};this.items=[];this.renderCache={};if(g.isArray(b.options))for(var c=b.valueField,
d=0;d<b.options.length;d++)b.options[d].hasOwnProperty(c)&&(this.options[b.options[d][c]]=b.options[d]);else"object"===typeof b.options&&(g.extend(this.options,b.options),delete this.settings.options);this.setup()};f.prototype.setup=function(){var a=this;(null===this.settings.maxItems||1<this.settings.maxItems)&&1===this.tagType&&this.$input.attr("multiple","multiple");var b=g("<div>").addClass(this.settings.inputClass).addClass(this.settings.theme).toggleClass("has-options",!g.isEmptyObject(this.options)),
c=g("<div>").addClass("items").appendTo(b),d=g('<input type="text">').appendTo(b),e=g("<div>").addClass(this.settings.dropdownClass).addClass(this.settings.theme).hide().appendTo("body");this.settings.placeholder&&d.attr("placeholder",this.settings.placeholder);this.$control=b;this.$control_items=c;this.$control_input=d;this.$dropdown=e;b.on("mousedown",function(b){a.$control_items.has(b.target).length||n.setTimeout(function(){d.trigger("focus")},10)});d.on("mousedown",function(a){a.stopPropagation()});
e.on("mouseenter",">*",function(){return a.onOptionHover.apply(a,arguments)});e.on("mousedown",">*",function(){return a.onOptionSelect.apply(a,arguments)});c.on("mousedown",function(){return a.onItemSelect.apply(a,arguments)});d.on("keydown",function(){return a.onKeyDown.apply(a,arguments)});d.on("keyup",function(){return a.onKeyUp.apply(a,arguments)});d.on("keypress",function(){return a.onKeyPress.apply(a,arguments)});d.on("blur",function(){return a.onBlur.apply(a,arguments)});d.on("focus",function(){return a.onFocus.apply(a,
arguments)});g(j).on("keydown",function(b){if(a.isFocused){var c=(b.target.tagName||"").toLowerCase();if(!("input"===c||"textarea"===c)&&-1!==[16,8,46,27,37,39,9].indexOf(b.keyCode))return a.onKeyDown.apply(a,arguments)}});g(j).on("mousedown",function(b){a.isFocused&&(!a.$control.has(b.target).length&&b.target!==a.$control[0])&&a.blur()});g(n).on("resize",function(){a.isOpen&&a.positionDropdown.apply(a,arguments)});this.$input.hide().after(this.$control);if(g.isArray(this.settings.items)){for(b=0;b<
this.settings.items.length;b++)this.addItem(this.settings.items[b]);delete this.settings.items}this.isSetup=!0};f.prototype.onKeyPress=function(a){var b=String.fromCharCode(a.keyCode||a.which);if(this.settings.create&&b===this.settings.delimiter)return this.createItem(),a.preventDefault(),!1};f.prototype.onKeyDown=function(a){var b=a.target===this.$control_input[0];switch(a.keyCode||a.which){case 27:this.blur();break;case 40:!this.isOpen&&this.hasOptions?this.open():this.$activeOption&&(b=this.$activeOption.next(),
b.length&&this.setActiveOption(b,!0,!0));a.preventDefault();break;case 38:this.$activeOption&&(b=this.$activeOption.prev(),b.length&&this.setActiveOption(b,!0,!0));a.preventDefault();break;case 13:if(this.$activeOption)this.onOptionSelect({currentTarget:this.$activeOption});a.preventDefault();break;case 37:this.$activeItem?(a=this.$activeItem.prev(),a.length&&this.setActiveItem(a)):b&&(this.items.length&&0===p(this.$control_input[0]))&&(this.setActiveItem(this.$control_items.children(":last-child")),
this.$control_input.trigger("blur"));break;case 9:case 39:this.$activeItem?(b=this.$activeItem.next(),b.length?this.setActiveItem(b):this.$control_input.trigger("focus"),a.preventDefault(),a.stopPropagation()):9===a.keyCode&&this.settings.create&&this.createItem();break;case 8:case 46:var c=8===a.keyCode?"prev":"next";this.$activeItem?(b=this.$activeItem[c](),this.removeItem(this.$activeItem.attr("data-value")),b.length?this.setActiveItem(b):(this.$activeItem=null,this.$control_input.trigger("focus")),
a.preventDefault(),a.stopPropagation()):b&&("prev"===c&&this.items.length&&0===p(this.$control_input[0]))&&this.removeItem(this.items[this.items.length-1]);break;default:this.isFull&&a.preventDefault()}};f.prototype.onKeyUp=function(){var a=this.$control_input.val();this.lastValue!==a&&(this.lastValue=a,this.refreshOptions())};f.prototype.onFocus=function(){this.isInputFocused=this.isFocused=!0;this.setActiveItem(null);this.$control.addClass("focus");this.refreshOptions(!!this.settings.openOnFocus)};
f.prototype.onBlur=function(){this.close();this.$control_input.val("");this.isInputFocused=!1;this.$activeItem||(this.$control.removeClass("focus"),this.isFocused=!1)};f.prototype.onOptionHover=function(a){this.setActiveOption(a.target,!1)};f.prototype.onOptionSelect=function(a){a=g(a.currentTarget);if(a.hasClass("create"))this.createItem();else if(a=a.attr("data-value"))this.addItem(a),this.$control_input.val("")};f.prototype.onItemSelect=function(a){this.$control_input.trigger("blur");this.setActiveItem(g(a.target))};
f.prototype.setActiveItem=function(a){this.$activeItem&&this.$activeItem.removeClass("active");this.$activeItem=a&&a.addClass("active");this.isFocused=!!a};f.prototype.setActiveOption=function(a,b,c){this.$activeOption&&this.$activeOption.removeClass("active");this.$activeOption=null;a=g(a);if(a.length&&(this.$activeOption=a.addClass("active"),b||!k(b))){var a=this.$dropdown.height(),d=this.$activeOption.outerHeight(!0),b=this.$dropdown.scrollTop()||0,e=this.$activeOption.offset().top-this.$dropdown.offset().top+
b,f=e-a+d;e+d>a-b?this.$dropdown.stop().animate({scrollTop:f},c?this.settings.scrollDuration:0):e<b&&this.$dropdown.stop().animate({scrollTop:e},c?this.settings.scrollDuration:0)}};f.prototype.blur=function(){this.isInputFocused&&this.$control_input.trigger("blur");this.setActiveItem(null)};f.prototype.parseSearchTokens=function(a){a=g.trim(String(a||"").toLowerCase());if(!a||!a.length)return[];for(var b=[],a=a.split(/ +/),c=0;c<a.length;c++){var d=(a[c]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");
if(this.settings.diacritics)for(var e in m)m.hasOwnProperty(e)&&(d=d.replace(RegExp(e,"g"),m[e]));b.push({string:a[c],regex:RegExp(d,"i")})}return b};f.prototype.search=function(a,b){var b=b||{},a=g.trim(String(a||"").toLowerCase()),c;if(a!==this.lastQuery){this.lastQuery=a;var d=this,e=this.parseSearchTokens(a);c={query:a,tokens:e,total:0,items:[]};var f=e.length?1===e.length?function(a){var a=String(a||"").toLowerCase(),b=a.search(e[0].regex);if(-1===b)return 0;a=e[0].string.length/a.length;0===
b&&(a+=0.5);return a}:function(a){for(var a=String(a||"").toLowerCase(),b=0,c=0;c<e.length;c++){var d=a.search(e[c].regex);if(-1===d)return 0;0===d&&(b+=0.5);b+=e[c].string.length/a.length}return b/e.length}:function(){return 0},h=function(){var a=d.settings.searchField;"string"===typeof a&&(a=[a]);if(!a||!a.length)return function(){return 0};if(1===a.length){var b=a[0];return function(a){return!a.hasOwnProperty(b)?0:f(a[b])}}return function(b){for(var c=0,d=0,e=0;e<a.length;e++)b.hasOwnProperty(a[e])&&
(d+=f(b[a[e]]),c++);return d/c}}();if(a.length){for(var i in this.options)if(this.options.hasOwnProperty(i)){var j=h(this.options[i]);0<j&&c.items.push({score:j,value:i})}c.items.sort(function(a,b){return b.score-a.score})}else for(i in this.options)this.options.hasOwnProperty(i)&&c.items.push({score:1,value:i});this.currentResults=c}else c=g.extend(!0,{},this.currentResults);return this.prepareResults(c,b)};f.prototype.prepareResults=function(a,b){for(var c=a.items.length-1;0<=c;c--)-1!==this.items.indexOf(String(a.items[c].value))&&
a.items.splice(c,1);a.total=a.items.length;"number"===typeof b.limit&&(a.items=a.items.slice(0,b.limit));return a};f.prototype.refreshOptions=function(a){"undefined"===typeof a&&(a=!0);var b=this.$control_input.val(),c=this.search(b,{}),d=[],e=c.items.length;"number"===typeof this.settings.maxOptions&&(e=Math.min(e,this.settings.maxOptions));for(var f=0;f<e;f++)d.push(this.render("option",this.options[c.items[f].value]));this.$dropdown.html(d.join(""));if(this.settings.highlight&&c.query.length&&
c.tokens.length)for(f=0;f<c.tokens.length;f++)q(this.$dropdown,c.tokens[f].regex);(d=this.settings.create&&c.query.length)&&this.$dropdown.prepend(this.render("option_create",{input:b}));(this.hasOptions=0<c.items.length||d)?(this.setActiveOption(this.$dropdown[0].childNodes[0]),a&&!this.isOpen&&this.open()):(this.setActiveOption(null),a&&this.isOpen&&this.close())};f.prototype.addOption=function(a,b){this.options.hasOwnProperty(a)||(a=String(a),this.userOptions[a]=!0,this.options[a]=b,this.lastQuery=
null)};f.prototype.removeOption=function(a){a=String(a);delete this.userOptions[a];delete this.options[a];this.lastQuery=null};f.prototype.addItem=function(a){a=String(a);if(!(null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems)&&-1===this.items.indexOf(a)){var b=this.render("item",this.options[a]);this.$control_items.append(b);this.items.push(a);this.isFull=null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems;this.$control.toggleClass("has-items",!0);this.$control.toggleClass("full",
this.isFull);if(this.isSetup){for(var b=this.$dropdown[0].childNodes,c=0;c<b.length;c++){var d=g(b[c]);if(d.attr("data-value")===a){d.remove();d[0]===this.$activeOption[0]&&this.setActiveOption(b.length?g(b[0]).addClass("active"):null);break}}b.length||this.close();this.positionDropdown();this.settings.placeholder&&this.$control_input.removeAttr("placeholder");null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems&&this.close();this.updateOriginalInput()}}};f.prototype.removeItem=
function(a){var a=String(a),b=this.items.indexOf(a);-1!==b&&(this.items.splice(b,1),b=g(this.$control_items[0].childNodes[b]),b.attr("data-value")===a&&b.remove(),this.$control.toggleClass("has-items",0<this.items.length),this.$control.removeClass("full"),this.isFull=!1,this.lastQuery=null,this.settings.persist||this.removeOption(a),this.positionDropdown(),this.refreshOptions(!1),this.hasOptions?this.isInputFocused&&this.open():this.close(),this.settings.placeholder&&!this.items.length&&this.$control_input.attr("placeholder",
this.settings.placeholder),this.updateOriginalInput())};f.prototype.createItem=function(){var a=this,b=g.trim(this.$control_input.val()||"");if(b.length){var c="function"===typeof this.settings.create?this.settings.create:function(b){var c={};c[a.settings.labelField]=b;c[a.settings.valueField]=b;return c},d,e=function(b){var c=b&&b[a.settings.valueField];k(c)&&(a.addOption(c,b),a.addItem(c),a.refreshOptions(),a.$control_input.val(""))},f=!1;d=function(){f||(f=!0,e.apply(this,arguments))};b=c(b,d);
"object"===typeof b&&d(b)}};f.prototype.updateOriginalInput=function(){if("select"===this.$input[0].tagName.toLowerCase()){for(var a=[],b=0;b<this.items.length;b++)a.push("<option value="+o(this.items[b])+' selected="selected"></option>');a.length||a.push('<option value="" selected="selected"></option>');this.$input.html(a.join(""))}else this.$input.val(this.serialize());this.$input.trigger("change")};f.prototype.open=function(){this.isOpen||null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems||
(this.isOpen=!0,this.positionDropdown(),this.$control.addClass("dropdown-active"),this.$dropdown.show())};f.prototype.positionDropdown=function(){var a=this.$control,b=a.offset();b.top+=a.outerHeight(!0);this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})};f.prototype.close=function(){this.$dropdown.hide();this.$control.removeClass("dropdown-active");this.isOpen=!1};f.prototype.render=function(a,b){k(e);var c,d="",e=!1;-1!==["option","item"].indexOf(a)&&(c=b[this.settings.valueField],
e=k(c));if(e&&(k(this.renderCache[a])||(this.renderCache[a]={}),this.renderCache[a].hasOwnProperty(c)))return this.renderCache[a][c];if(this.settings.render&&"function"===typeof this.settings.render[a])d=this.settings.render[a].apply(this,[b]);else{var f=b[this.settings.labelField];switch(a){case "option":d='<div class="option">'+f+"</div>";break;case "item":d='<div class="item">'+f+"</div>";break;case "option_create":d='<div class="create">Create <strong>'+o(b.input)+"</strong>&hellip;</div>"}}k(c)&&
(d=d.replace(/^[\\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i,'<$1 data-value="'+c+'"'));e&&(this.renderCache[a][c]=d);return d};f.prototype.serialize=function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)}})(jQuery,window,document);
